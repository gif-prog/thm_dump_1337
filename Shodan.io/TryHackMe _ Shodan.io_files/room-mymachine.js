const attackBoxEl=document['querySelector']('#room-attackbox'),attackBoxControlOpsEl=document['querySelector']('#attackbox-machine-options'),roomDetailsEl=document['querySelector']('#room-details'),roomContentEl=document['querySelector']('#room-content'),roomGridContentEl=document['querySelector']('#room-content-main'),roomGridAttackboxEl=document['querySelector']('#room-content-attackbox'),attackBoxLoadingEl=document['querySelector']('#room-attackbox-loading'),attackBoxVMViewEl=document['querySelector']('#room-attackbox-vm-view'),attackBoxInstanceEl=document['querySelector']('#attackbox-machine-instance'),attackBoxURLBtn=document['querySelector']('#room-attackbox-url'),attackBoxExpireTxt=document['querySelector']('#room-attackbox-expire-text'),attackBoxStartBtn=document['querySelector']('#browser-machine-start'),attackBoxOptions=document['querySelector']('#browser-machine-options'),attackBoxSplitScreenBtn=document['querySelector']('#browser-machine-split-view'),attackBoxTabs=document['querySelector']('#room-attackbox-tabs'),machinePrivIpEl=document['querySelector']('#browser-machine-privip'),machinePubIpEl=document['querySelector']('#browser-machine-pubip'),machineUsername=document['querySelector']('#browser-username'),machinePassword=document['querySelector']('#browser-password'),machineProtocol=document['querySelector']('#browser-protocol'),freeAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'freeattackbox','text':'Free\x20TryHackMe\x20AttackBox'},subAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'kali','text':'TryHackMe\x20AttackBox'},subKaliInfo={'uploadId':'5f3a9d6842e1ab8a6de7f291','roomCode':'kali','text':'Kali\x20Linux'};let myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo};subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo);let abConfig={'deploying':![],'deployed':![]},attackBoxExpireTimer,attackBoxInitCounter,webBasedInstances={},webBasedTab={'attackbox':![],'instanceId':null};function changeMyMachine(_0x2c5dfc){attackBoxStartBtn['disabled']=![];if(_0x2c5dfc=='kali-linux')myMachineSelected={'title':'Kali\x20Linux','id':'kali-linux','machineInfo':subKaliInfo};else _0x2c5dfc=='attackbox'&&(myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo},subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo));_0x2c5dfc!='loading'?attackBoxStartBtn['innerHTML']='<i\x20class=\x22far\x20fa-laptop\x22></i>\x20Start\x20'+myMachineSelected['title']:(attackBoxStartBtn['disabled']=!![],attackBoxStartBtn['innerHTML']='<div\x20class=\x27d-flex\x20align-items-center\x27>\x0a\x20\x20\x20\x20\x20\x20<span\x20class=\x22spinner-border\x20spinner-border-sm\x20mr-2\x22\x20role=\x22status\x22\x20aria-hidden=\x22true\x22></span>\x20Starting...\x0a\x20\x20\x20\x20</div>');}function addWebBasedMachine(_0x47f8c6){const _0x5c6af1=_0x47f8c6['instanceId'];webBasedInstances[_0x5c6af1]=_0x47f8c6,renderAttackBoxTabHTML();}function renderAttackBoxTabHTML(){attackBoxTabs['innerHTML']='';for(const [_0x592a54,_0xdd93a0]of Object['entries'](webBasedInstances)){const _0x57122e=Object['keys'](webBasedInstances)['length']==0x1?'tab-active':'';attackBoxTabs['innerHTML']+='<div\x20class=\x22'+_0x57122e+'\x22\x20data-id=\x22'+_0x592a54+'\x22\x20onclick=\x22switchWebBasedTab(\x27'+_0x592a54+'\x27)\x22>'+_0xdd93a0['title']+'<div>';}}function switchWebBasedTab(_0x36de16){attackBoxVMViewEl['style']['height']='',clearInterval(attackBoxExpireTimer),clearInterval(attackBoxInitCounter),switchWebBasedMachine(_0x36de16);}function initWebBasedMachine(_0x5d2b06){setAttackBoxDetails('online');if(_0x5d2b06['type']!='static-site'){attackBoxControlOpsEl['className']='',attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']='',renderAttackBox(_0x5d2b06['title'],_0x5d2b06['internalIP'],_0x5d2b06['remote']['privateIp'],_0x5d2b06['timeInSeconds'],_0x5d2b06['created'],_0x5d2b06['remote'],_0x5d2b06['username'],_0x5d2b06['password'],_0x5d2b06['waitTime']);_0x5d2b06['roomId']==myMachineSelected['machineInfo']['roomCode']?webBasedTab['attackbox']=!![]:webBasedTab['attackbox']=![];webBasedTab['instanceId']=_0x5d2b06['instanceId'];const _0x19b817=webBasedTab['attackbox']?'attackbox':'webbased';setNavConnStatus({'type':_0x19b817,'virtualIP':_0x5d2b06['remote']['privateIp']});}else renderiFrameHTML(_0x5d2b06['url']),attackBoxControlOpsEl['className']='rem-attackbox-machine-options',setNavConnStatus({'type':'hide'});const _0x2ed36b=document['querySelectorAll']('#room-attackbox-tabs\x20>\x20div');for(let _0x3f1269 of _0x2ed36b){_0x3f1269['className']='';if(_0x3f1269['dataset']['id']==_0x5d2b06['instanceId'])_0x3f1269['className']='tab-active';}}function switchWebBasedMachine(_0xcda6f3){const _0x847d98=webBasedInstances[_0xcda6f3];if(_0x847d98!=undefined)initWebBasedMachine(_0x847d98);}function startAttackBox(_0x2d13b3){if(!abConfig['deploying']){abConfig['deploying']=!![],changeMyMachine('loading'),$['post']('/account/dashboard/deploy-kali');if(_0x2d13b3['startingMsg'])displayMessages('','warning','Starting\x20your\x20machine..\x20please\x20wait!');$['post']('/material/deploy',{'id':myMachineSelected['machineInfo']['uploadId'],'roomCode':myMachineSelected['machineInfo']['roomCode']},async function(_0x5a168c){changeMyMachine(myMachineSelected['id']),_0x5a168c['success']?(addWebBasedMachine(_0x5a168c),initWebBasedMachine(_0x5a168c),attackboxEvent('room_page',myMachineSelected['machineInfo']['text']),displayMessages('Hooray!','success',_0x5a168c['msg']),showSplitScreenBtn('none'),showAttackStartBoxBtn('none'),abConfig['deployed']=!![],_0x2d13b3['tutorial']&&setTimeout(startIntroAttackBoxDeploy,0x1f4)):(displayMessages('Uh-oh!','danger',_0x5a168c['msg']),showAttackStartBoxBtn('show')),abConfig['deploying']=![];});}else displayMessages('','warning','Please\x20wait,\x20your\x20machine\x20is\x20still\x20loading..');}async function extendHourWebBasedVM(_0x60613){let _0xd016dd;if(webBasedTab['attackbox']&&_0x60613==null)_0xd016dd=extendAttackBox();else{_0xd016dd=await addRoomVMHour();if(_0xd016dd!=null)extendWebBasedTimer(_0xd016dd);}const _0x24c99d=_0x60613!=null?_0x60613:webBasedTab['instanceId'];if(_0xd016dd!=null){let _0x4f6cb9=webBasedInstances[_0x24c99d];_0x4f6cb9['timeInSeconds']=_0xd016dd;}}function terminateWebBasedVM(_0x4cfb8a){webBasedTab['attackbox']&&_0x4cfb8a==null?terminateAttackBox():terminateRoomVM(),remWebBasedTabData(_0x4cfb8a);}function remWebBasedTabData(_0x2e279e){const _0x3fdfe5=_0x2e279e!=null?_0x2e279e:webBasedTab['instanceId'];delete webBasedInstances[_0x3fdfe5],Object['keys'](webBasedInstances)['length']==0x0?(setAttackBoxDetails('offline'),getNavConnOpenVPN()):setTimeout(function(){const _0x54f91b=Object['keys'](webBasedInstances)[0x0];switchWebBasedTab(_0x54f91b),renderAttackBoxTabHTML();},0x64);}function terminateAttackBox(){displayMessages('','success','Your\x20machine\x20has\x20been\x20terminated.'),$['post']('/api/vm/terminate',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0x4c1353){clearInterval(attackBoxExpireTimer),_0x4c1353['success']?(showAttackStartBoxBtn('show'),abConfig['deployed']=![]):displayMessages('Uh-oh!','warning',_0x4c1353['msg']);});}function extendAttackBox(){return new Promise((_0x4826a1,_0x57195c)=>{$['post']('/api/vm/renew',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0x2476b2){return _0x2476b2['success']?(displayMessages('','success','Successfully\x20updated\x20your\x20machines\x20expiry\x20time.'),extendWebBasedTimer(_0x2476b2['timeInSeconds']),_0x4826a1(_0x2476b2['timeInSeconds'])):(displayMessages('Uh-oh!','warning',_0x2476b2['msg']),_0x4826a1());});});}function extendWebBasedTimer(_0x2e306b){clearInterval(attackBoxExpireTimer),attackBoxExpireTimer=startAttackBoxTimer(_0x2e306b,attackBoxExpireTxt,'my-machine',attackBoxExpireTimer);}async function getModalAttackBoxPubIP(){const _0x1a12b0=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0x1a12b0['success']?machinePubIpEl['textContent']=_0x1a12b0['data']['internalIP']:machinePubIpEl['textContent']='-';}async function getAttackBoxStatus(){const _0x682ab9=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0x682ab9['success']?(showAttackStartBoxBtn('none'),addWebBasedMachine(_0x682ab9['data']),userObj['splitScreen']==!![]?(initWebBasedMachine(_0x682ab9['data']),showSplitScreenBtn('none')):showSplitScreenBtn('show'),setNavConnStatus({'type':'attackbox','virtualIP':_0x682ab9['data']['remote']['privateIp']}),abConfig['deployed']=!![]):(showAttackStartBoxBtn('show'),await getNavConnOpenVPN());}function showAttackStartBoxBtn(_0x3aea70){_0x3aea70=='show'&&!roomSettings['remAttackBoxBtn']?attackBoxOptions['style']['display']='inline-flex':attackBoxOptions['style']['display']='none';}function showSplitScreenBtn(_0x6ec3f6){_0x6ec3f6=='show'?attackBoxSplitScreenBtn['style']['display']='inline-flex':attackBoxSplitScreenBtn['style']['display']='none';}attackBoxSplitScreenBtn['onclick']=function(){showSplitScreenView();},attackBoxStartBtn['onclick']=function(){setSplitScreenSetting(!![]),startAttackBox({'startingMsg':!![],'tutorial':![]});};function setSplitScreenSetting(_0x238097){setUserSetting('room','splitScreen',_0x238097),userObj['splitScreen']=_0x238097;}function exitViewAttackBox(){setSplitScreenSetting(![]),setAttackBoxDetails('offline'),showSplitScreenBtn('show');}function showSplitScreenView(){setSplitScreenSetting(!![]),setAttackBoxDetails('online'),showSplitScreenBtn('none'),switchWebBasedTab(Object['keys'](webBasedInstances)[0x0]);}function infoAttackBox(){$('#attackBoxInfoModal')['modal']('toggle');}function setAttackBoxDetails(_0x3be735){_0x3be735=='online'?(roomContentEl['className']='room-flex',roomGridContentEl['className']='room-splitscreen-content',roomGridAttackboxEl['className']='room-attackbox',attackBoxLoadingEl['style']['display']='block',attackBoxEl['style']['display']='grid',roomLite('lite')):(attackBoxEl['style']['display']='none',roomContentEl['className']='',roomGridContentEl['className']='',roomGridContentEl['style']='',roomGridAttackboxEl['className']='',attackBoxVMViewEl&&(attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']=''),roomLite('regular'));}function renderAttackBox(_0x5c118d,_0x1a18e5,_0x4b3a40,_0x53dd4e,_0x301fe6,_0xaa8fd5,_0x3f9df0,_0x20b4a6,_0x574c60){extendWebBasedTimer(_0x53dd4e),checkAttackBoxDeploy(_0x5c118d,_0x1a18e5,_0x53dd4e,_0x301fe6,_0xaa8fd5),machinePubIpEl['textContent']=_0x1a18e5!=null?_0x1a18e5:'-',machinePrivIpEl['textContent']=_0x4b3a40,machineUsername['textContent']=_0x3f9df0?_0x3f9df0:'N/a',machinePassword['textContent']=_0x20b4a6?_0x20b4a6:'N/a',machineProtocol['textContent']=_0xaa8fd5['protocol'];}async function checkAttackBoxDeploy(_0x292f6c,_0x252a48,_0x5d5490,_0x16068,_0x4f6f53){if(_0x4f6f53['active']){let _0x1cffda=0x1;_0x4f6f53['bootTime']&&(_0x1cffda=_0x4f6f53['bootTime']);const _0x176cc0=_0x4f6f53['remoteUrl'];attackBoxURLBtn['href']=_0x176cc0,attackBoxTimer(_0x16068,_0x1cffda,'deploy-browser',_0x176cc0,_0x252a48),attackBoxLoadingEl['innerHTML']='<div\x20id=\x22machine-loading-attackbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22loading-msg\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x27>Your\x20machine\x20is\x20initializing...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x20faded\x27>Use\x20the\x20AttackBox\x20to\x20attack\x20machines\x20you\x20start\x20on\x20tasks</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22machine-loading-attackbox-progress\x22\x20class=\x22progress-bar\x20bg-success\x22\x20style=\x22width:0%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>';}}function renderiFrameHTML(_0x342251){attackBoxVMViewEl['innerHTML']='<iframe\x20style=\x22position:\x20static;\x22\x20id=\x22remote-connection-2\x22\x20onmouseover=\x22setRemote2ConnectionFocus()\x22\x20src=\x22'+_0x342251+'\x22\x20width=\x22100%\x22\x20height=\x22100%\x22\x20frameBorder=\x220\x22\x20allow=\x22fullscreen\x22>Browser\x20not\x20compatible.</iframe>',attackBoxVMViewEl['style']['height']='100%',attackBoxLoadingEl['style']['display']='none';}let webBasedLoadingSecs;async function attackBoxTimer(_0x4b11a2,_0x4b85f4,_0x5cb9fa,_0x34af74,_0x17ae7b){var _0xba939a=new Date(_0x4b11a2);_0xba939a['setMinutes'](_0xba939a['getMinutes']()+_0x4b85f4);attackBoxInitCounter&&clearInterval(attackBoxInitCounter);const _0x530805=await getServerTime();webBasedLoadingSecs=((_0xba939a['getTime']()-_0x530805['getTime']())/0x3e8)['toFixed'](0x0),attackBoxLoadingScreen(_0x4b85f4,_0x17ae7b,_0x34af74),webBasedLoadingSecs>0x0&&(attackBoxInitCounter=setInterval(async function(){attackBoxLoadingScreen(_0x4b85f4,_0x17ae7b,_0x34af74);},0x3e8));}function attackBoxLoadingScreen(_0x1a8474,_0x2bd731,_0x34068e){webBasedLoadingSecs--;if(webBasedLoadingSecs<0x0){clearInterval(attackBoxInitCounter);const _0x4be763=document['querySelector']('#machine-loading-attackbox');if(_0x4be763)_0x4be763['outerHTML']='';attackBoxURLBtn['className']='clear-link',attackBoxURLBtn['innerHTML']='<div><i\x20class=\x22far\x20fa-expand-alt\x22></i></div>',machinePubIpEl['innerHTML']=_0x2bd731!=null?_0x2bd731:'<div\x20onclick=\x27getModalAttackBoxPubIP()\x27>Reveal\x20IP</div>',renderiFrameHTML(_0x34068e);}else{attackBoxURLBtn['className']='clear-link\x20disabled',attackBoxURLBtn['innerHTML']='<div\x20class=\x27faded\x27>Access\x20desktop\x20in\x20'+webBasedLoadingSecs+'s</div>';const _0x44fb1d=document['querySelector']('#machine-loading-attackbox-progress'),_0x5b8558=((0x1-(webBasedLoadingSecs/(_0x1a8474*0x3c))['toFixed'](0x2))*0x64)['toFixed'](0x0);_0x44fb1d&&(_0x44fb1d['style']['width']=_0x5b8558+'%',_0x44fb1d['textContent']=_0x5b8558+'%');}}function setRemote2ConnectionFocus(){document['querySelector']('#remote-connection-2')['contentWindow']['focus']();}function startAttackBoxTimer(_0x3bb795,_0x91808,_0x4b34eb,_0x184ed2){let _0x511ab8=parseInt(_0x3bb795),_0x3d91b8=_0x511ab8,_0x3180d7,_0x13eed7,_0x15f5aa;return _0x184ed2=setInterval(function(){_0x3180d7=parseInt(_0x3d91b8/0x3c,0xa)%0x3c,_0x13eed7=parseInt(_0x3d91b8%0x3c,0xa),_0x15f5aa=parseInt(_0x3d91b8/0xe10,0xa),_0x3180d7=_0x3180d7<0xa?'0'+_0x3180d7:_0x3180d7,_0x13eed7=_0x13eed7<0xa?'0'+_0x13eed7:_0x13eed7,_0x15f5aa=_0x15f5aa<0xa?'0'+_0x15f5aa:_0x15f5aa;let _0x2bc88f=parseInt(_0x15f5aa)['toFixed'](0x0)+'h\x20'+_0x3180d7+'m\x20'+_0x13eed7+'s';_0x15f5aa==0x0&&(_0x2bc88f=_0x3180d7+'m\x20'+_0x13eed7+'s'),_0x91808['textContent']=_0x2bc88f,--_0x3d91b8<0x0&&(_0x3d91b8=_0x511ab8);},0x3e8),_0x184ed2;}function roomLite(_0x170bc7){const _0x519e07=document['querySelector']('.navbar-main'),_0x1f6c74='navbar-lite';if(_0x170bc7=='lite'){if(_0x519e07&&!_0x519e07['className']['includes'](_0x1f6c74))_0x519e07['classList']['toggle'](_0x1f6c74);roomDetailsEl['className']='shorten-room-details';}else{if(_0x519e07&&_0x519e07['className']['includes'](_0x1f6c74))_0x519e07['classList']['toggle'](_0x1f6c74);roomDetailsEl['className']='';}}