const attackBoxEl=document['querySelector']('#room-attackbox'),attackBoxControlOpsEl=document['querySelector']('#attackbox-machine-options'),roomDetailsEl=document['querySelector']('#room-details'),roomContentEl=document['querySelector']('#room-content'),roomGridContentEl=document['querySelector']('#room-content-main'),roomGridAttackboxEl=document['querySelector']('#room-content-attackbox'),attackBoxLoadingEl=document['querySelector']('#room-attackbox-loading'),attackBoxVMViewEl=document['querySelector']('#room-attackbox-vm-view'),attackBoxInstanceEl=document['querySelector']('#attackbox-machine-instance'),attackBoxURLBtn=document['querySelector']('#room-attackbox-url'),attackBoxExpireTxt=document['querySelector']('#room-attackbox-expire-text'),attackBoxStartBtn=document['querySelector']('#browser-machine-start'),attackBoxOptions=document['querySelector']('#browser-machine-options'),attackBoxSplitScreenBtn=document['querySelector']('#browser-machine-split-view'),attackBoxTabs=document['querySelector']('#room-attackbox-tabs'),machinePrivIpEl=document['querySelector']('#browser-machine-privip'),machinePubIpEl=document['querySelector']('#browser-machine-pubip'),machineUsername=document['querySelector']('#browser-username'),machinePassword=document['querySelector']('#browser-password'),machineProtocol=document['querySelector']('#browser-protocol'),freeAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'freeattackbox','text':'Free\x20TryHackMe\x20AttackBox'},subAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'kali','text':'TryHackMe\x20AttackBox'},subKaliInfo={'uploadId':'5f3a9d6842e1ab8a6de7f291','roomCode':'kali','text':'Kali\x20Linux'};let myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo};subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo);let abConfig={'deploying':![],'deployed':![]},attackBoxExpireTimer,attackBoxInitCounter,webBasedInstances={},webBasedTab={'attackbox':![],'instanceId':null};function changeMyMachine(_0x4ea93c){attackBoxStartBtn['disabled']=![];if(_0x4ea93c=='kali-linux')myMachineSelected={'title':'Kali\x20Linux','id':'kali-linux','machineInfo':subKaliInfo};else _0x4ea93c=='attackbox'&&(myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo},subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo));_0x4ea93c!='loading'?attackBoxStartBtn['innerHTML']='<i\x20class=\x22far\x20fa-laptop\x22></i>\x20Start\x20'+myMachineSelected['title']:(attackBoxStartBtn['disabled']=!![],attackBoxStartBtn['innerHTML']='<div\x20class=\x27d-flex\x20align-items-center\x27>\x0a\x20\x20\x20\x20\x20\x20<span\x20class=\x22spinner-border\x20spinner-border-sm\x20mr-2\x22\x20role=\x22status\x22\x20aria-hidden=\x22true\x22></span>\x20Starting...\x0a\x20\x20\x20\x20</div>');}function addWebBasedMachine(_0x1a4992){const _0x44e666=_0x1a4992['instanceId'];webBasedInstances[_0x44e666]=_0x1a4992,renderAttackBoxTabHTML();}function renderAttackBoxTabHTML(){attackBoxTabs['innerHTML']='';for(const [_0x17dc7e,_0x519445]of Object['entries'](webBasedInstances)){const _0x47bfed=Object['keys'](webBasedInstances)['length']==0x1?'tab-active':'';attackBoxTabs['innerHTML']+='<div\x20class=\x22'+_0x47bfed+'\x22\x20data-id=\x22'+_0x17dc7e+'\x22\x20onclick=\x22switchWebBasedTab(\x27'+_0x17dc7e+'\x27)\x22>'+_0x519445['title']+'<div>';}}function switchWebBasedTab(_0x4d2798){attackBoxVMViewEl['style']['height']='',clearInterval(attackBoxExpireTimer),clearInterval(attackBoxInitCounter),switchWebBasedMachine(_0x4d2798);}function initWebBasedMachine(_0x362251){setAttackBoxDetails('online');if(_0x362251['type']!='static-site'){attackBoxControlOpsEl['className']='',attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']='',renderAttackBox(_0x362251['title'],_0x362251['internalIP'],_0x362251['remote']['privateIp'],_0x362251['timeInSeconds'],_0x362251['created'],_0x362251['remote'],_0x362251['username'],_0x362251['password'],_0x362251['waitTime']);_0x362251['roomId']==myMachineSelected['machineInfo']['roomCode']?webBasedTab['attackbox']=!![]:webBasedTab['attackbox']=![];webBasedTab['instanceId']=_0x362251['instanceId'];const _0x392262=webBasedTab['attackbox']?'attackbox':'webbased';setNavConnStatus({'type':_0x392262,'virtualIP':_0x362251['remote']['privateIp']});}else renderiFrameHTML(_0x362251['url']),attackBoxControlOpsEl['className']='rem-attackbox-machine-options',setNavConnStatus({'type':'hide'});const _0x59015f=document['querySelectorAll']('#room-attackbox-tabs\x20>\x20div');for(let _0x4f072c of _0x59015f){_0x4f072c['className']='';if(_0x4f072c['dataset']['id']==_0x362251['instanceId'])_0x4f072c['className']='tab-active';}}function switchWebBasedMachine(_0x1872c2){const _0x284623=webBasedInstances[_0x1872c2];if(_0x284623!=undefined)initWebBasedMachine(_0x284623);}function startAttackBox(_0x159c3f){if(!abConfig['deploying']){abConfig['deploying']=!![],changeMyMachine('loading'),$['post']('/account/dashboard/deploy-kali');if(_0x159c3f['startingMsg'])displayMessages('','warning','Starting\x20your\x20machine..\x20please\x20wait!');$['post']('/material/deploy',{'id':myMachineSelected['machineInfo']['uploadId'],'roomCode':myMachineSelected['machineInfo']['roomCode']},async function(_0x5771e4){changeMyMachine(myMachineSelected['id']),_0x5771e4['success']?(addWebBasedMachine(_0x5771e4),initWebBasedMachine(_0x5771e4),attackboxEvent('room_page',myMachineSelected['machineInfo']['text']),displayMessages('Hooray!','success',_0x5771e4['msg']),showSplitScreenBtn('none'),showAttackStartBoxBtn('none'),abConfig['deployed']=!![],_0x159c3f['tutorial']&&setTimeout(startIntroAttackBoxDeploy,0x1f4)):(displayMessages('Uh-oh!','danger',_0x5771e4['msg']),showAttackStartBoxBtn('show')),abConfig['deploying']=![];});}else displayMessages('','warning','Please\x20wait,\x20your\x20machine\x20is\x20still\x20loading..');}async function extendHourWebBasedVM(_0x1c38df){let _0x2d33e0;if(webBasedTab['attackbox']&&_0x1c38df==null)_0x2d33e0=extendAttackBox();else{_0x2d33e0=await addRoomVMHour();if(_0x2d33e0!=null)extendWebBasedTimer(_0x2d33e0);}const _0x36a7a4=_0x1c38df!=null?_0x1c38df:webBasedTab['instanceId'];if(_0x2d33e0!=null){let _0x25462d=webBasedInstances[_0x36a7a4];_0x25462d['timeInSeconds']=_0x2d33e0;}}function terminateWebBasedVM(_0x55b368){webBasedTab['attackbox']&&_0x55b368==null?terminateAttackBox():terminateRoomVM(),remWebBasedTabData(_0x55b368);}function remWebBasedTabData(_0x453061){const _0x98d98=_0x453061!=null?_0x453061:webBasedTab['instanceId'];delete webBasedInstances[_0x98d98],Object['keys'](webBasedInstances)['length']==0x0?(setAttackBoxDetails('offline'),getNavConnOpenVPN()):setTimeout(function(){const _0x18c32b=Object['keys'](webBasedInstances)[0x0];switchWebBasedTab(_0x18c32b),renderAttackBoxTabHTML();},0x64);}function terminateAttackBox(){displayMessages('','success','Your\x20machine\x20has\x20been\x20terminated.'),$['post']('/api/vm/terminate',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0xa1c9e3){clearInterval(attackBoxExpireTimer),_0xa1c9e3['success']?(showAttackStartBoxBtn('show'),abConfig['deployed']=![]):displayMessages('Uh-oh!','warning',_0xa1c9e3['msg']);});}function extendAttackBox(){return new Promise((_0x39e081,_0x56cdcc)=>{$['post']('/api/vm/renew',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0x1e0b30){return _0x1e0b30['success']?(displayMessages('','success','Successfully\x20updated\x20your\x20machines\x20expiry\x20time.'),extendWebBasedTimer(_0x1e0b30['timeInSeconds']),_0x39e081(_0x1e0b30['timeInSeconds'])):(displayMessages('Uh-oh!','warning',_0x1e0b30['msg']),_0x39e081());});});}function extendWebBasedTimer(_0x4ccfd5){clearInterval(attackBoxExpireTimer),attackBoxExpireTimer=startAttackBoxTimer(_0x4ccfd5,attackBoxExpireTxt,'my-machine',attackBoxExpireTimer);}async function getModalAttackBoxPubIP(){const _0x4d0dd0=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0x4d0dd0['success']?machinePubIpEl['textContent']=_0x4d0dd0['data']['internalIP']:machinePubIpEl['textContent']='-';}async function getAttackBoxStatus(){const _0xfbc0d4=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0xfbc0d4['success']?(showAttackStartBoxBtn('none'),addWebBasedMachine(_0xfbc0d4['data']),userObj['splitScreen']==!![]?(initWebBasedMachine(_0xfbc0d4['data']),showSplitScreenBtn('none')):showSplitScreenBtn('show'),setNavConnStatus({'type':'attackbox','virtualIP':_0xfbc0d4['data']['remote']['privateIp']}),abConfig['deployed']=!![]):(showAttackStartBoxBtn('show'),await getNavConnOpenVPN());}function showAttackStartBoxBtn(_0x403f7b){_0x403f7b=='show'&&!roomSettings['remAttackBoxBtn']?attackBoxOptions['style']['display']='inline-flex':attackBoxOptions['style']['display']='none';}function showSplitScreenBtn(_0x28a846){_0x28a846=='show'?attackBoxSplitScreenBtn['style']['display']='inline-flex':attackBoxSplitScreenBtn['style']['display']='none';}attackBoxSplitScreenBtn['onclick']=function(){showSplitScreenView();},attackBoxStartBtn['onclick']=function(){setSplitScreenSetting(!![]),startAttackBox({'startingMsg':!![],'tutorial':![]});};function setSplitScreenSetting(_0x574f42){setUserSetting('room','splitScreen',_0x574f42),userObj['splitScreen']=_0x574f42;}function exitViewAttackBox(){setSplitScreenSetting(![]),setAttackBoxDetails('offline'),showSplitScreenBtn('show');}function showSplitScreenView(){setSplitScreenSetting(!![]),setAttackBoxDetails('online'),showSplitScreenBtn('none'),switchWebBasedTab(Object['keys'](webBasedInstances)[0x0]);}function infoAttackBox(){$('#attackBoxInfoModal')['modal']('toggle');}function setAttackBoxDetails(_0x14c62a){_0x14c62a=='online'?(roomContentEl['className']='room-flex',roomGridContentEl['className']='room-splitscreen-content',roomGridAttackboxEl['className']='room-attackbox',attackBoxLoadingEl['style']['display']='block',attackBoxEl['style']['display']='grid',roomLite('lite')):(attackBoxEl['style']['display']='none',roomContentEl['className']='',roomGridContentEl['className']='',roomGridContentEl['style']='',roomGridAttackboxEl['className']='',attackBoxVMViewEl&&(attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']=''),roomLite('regular'));}function renderAttackBox(_0x50de1a,_0x38e7ad,_0x34bbe6,_0x3d8b39,_0x1a7fe0,_0x28a7eb,_0x58cf00,_0xc7fd10,_0x23e7d9){extendWebBasedTimer(_0x3d8b39),checkAttackBoxDeploy(_0x50de1a,_0x38e7ad,_0x3d8b39,_0x1a7fe0,_0x28a7eb),machinePubIpEl['textContent']=_0x38e7ad!=null?_0x38e7ad:'-',machinePrivIpEl['textContent']=_0x34bbe6,machineUsername['textContent']=_0x58cf00?_0x58cf00:'N/a',machinePassword['textContent']=_0xc7fd10?_0xc7fd10:'N/a',machineProtocol['textContent']=_0x28a7eb['protocol'];}async function checkAttackBoxDeploy(_0x3a5350,_0x8520f7,_0x420585,_0x4d65f0,_0x4eaaad){if(_0x4eaaad['active']){let _0x5453b0=0x1;_0x4eaaad['bootTime']&&(_0x5453b0=_0x4eaaad['bootTime']);const _0xf2b39b=_0x4eaaad['remoteUrl'];attackBoxURLBtn['href']=_0xf2b39b,attackBoxTimer(_0x4d65f0,_0x5453b0,'deploy-browser',_0xf2b39b,_0x8520f7),attackBoxLoadingEl['innerHTML']='<div\x20id=\x22machine-loading-attackbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22loading-msg\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x27>Your\x20machine\x20is\x20initializing...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x20faded\x27>Use\x20the\x20AttackBox\x20to\x20attack\x20machines\x20you\x20start\x20on\x20tasks</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22machine-loading-attackbox-progress\x22\x20class=\x22progress-bar\x20bg-success\x22\x20style=\x22width:0%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>';}}function renderiFrameHTML(_0x28118a){attackBoxVMViewEl['innerHTML']='<iframe\x20style=\x22position:\x20static;\x22\x20id=\x22remote-connection-2\x22\x20onmouseover=\x22setRemote2ConnectionFocus()\x22\x20src=\x22'+_0x28118a+'\x22\x20width=\x22100%\x22\x20height=\x22100%\x22\x20frameBorder=\x220\x22\x20allow=\x22fullscreen\x22>Browser\x20not\x20compatible.</iframe>',attackBoxVMViewEl['style']['height']='100%',attackBoxLoadingEl['style']['display']='none';}let webBasedLoadingSecs;async function attackBoxTimer(_0x35d700,_0x48c97a,_0x5e5f28,_0x591851,_0x5b7b5b){var _0x85fd35=new Date(_0x35d700);_0x85fd35['setMinutes'](_0x85fd35['getMinutes']()+_0x48c97a);attackBoxInitCounter&&clearInterval(attackBoxInitCounter);const _0x1d7422=await getServerTime();webBasedLoadingSecs=((_0x85fd35['getTime']()-_0x1d7422['getTime']())/0x3e8)['toFixed'](0x0),attackBoxLoadingScreen(_0x48c97a,_0x5b7b5b,_0x591851),webBasedLoadingSecs>0x0&&(attackBoxInitCounter=setInterval(async function(){attackBoxLoadingScreen(_0x48c97a,_0x5b7b5b,_0x591851);},0x3e8));}function attackBoxLoadingScreen(_0x2db17b,_0x4fd12e,_0x32a094){webBasedLoadingSecs--;if(webBasedLoadingSecs<0x0){clearInterval(attackBoxInitCounter);const _0x40fa54=document['querySelector']('#machine-loading-attackbox');if(_0x40fa54)_0x40fa54['outerHTML']='';attackBoxURLBtn['className']='clear-link',attackBoxURLBtn['innerHTML']='<div><i\x20class=\x22far\x20fa-expand-alt\x22></i></div>',machinePubIpEl['innerHTML']=_0x4fd12e!=null?_0x4fd12e:'<div\x20onclick=\x27getModalAttackBoxPubIP()\x27>Reveal\x20IP</div>',renderiFrameHTML(_0x32a094);}else{attackBoxURLBtn['className']='clear-link\x20disabled',attackBoxURLBtn['innerHTML']='<div\x20class=\x27faded\x27>Access\x20desktop\x20in\x20'+webBasedLoadingSecs+'s</div>';const _0x43da84=document['querySelector']('#machine-loading-attackbox-progress'),_0x545bd1=((0x1-(webBasedLoadingSecs/(_0x2db17b*0x3c))['toFixed'](0x2))*0x64)['toFixed'](0x0);_0x43da84&&(_0x43da84['style']['width']=_0x545bd1+'%',_0x43da84['textContent']=_0x545bd1+'%');}}function setRemote2ConnectionFocus(){document['querySelector']('#remote-connection-2')['contentWindow']['focus']();}function startAttackBoxTimer(_0x72f8e,_0x2d0d1c,_0x41161a,_0x2fcd3c){let _0xa8b180=parseInt(_0x72f8e),_0x321480=_0xa8b180,_0x230b31,_0x339f21,_0x3a6153;return _0x2fcd3c=setInterval(function(){_0x230b31=parseInt(_0x321480/0x3c,0xa)%0x3c,_0x339f21=parseInt(_0x321480%0x3c,0xa),_0x3a6153=parseInt(_0x321480/0xe10,0xa),_0x230b31=_0x230b31<0xa?'0'+_0x230b31:_0x230b31,_0x339f21=_0x339f21<0xa?'0'+_0x339f21:_0x339f21,_0x3a6153=_0x3a6153<0xa?'0'+_0x3a6153:_0x3a6153;let _0x191222=parseInt(_0x3a6153)['toFixed'](0x0)+'h\x20'+_0x230b31+'m\x20'+_0x339f21+'s';_0x3a6153==0x0&&(_0x191222=_0x230b31+'m\x20'+_0x339f21+'s'),_0x2d0d1c['textContent']=_0x191222,--_0x321480<0x0&&(_0x321480=_0xa8b180);},0x3e8),_0x2fcd3c;}function roomLite(_0x5ccf6e){const _0x1a601f=document['querySelector']('.navbar-main'),_0xb99420='navbar-lite';if(_0x5ccf6e=='lite'){if(_0x1a601f&&!_0x1a601f['className']['includes'](_0xb99420))_0x1a601f['classList']['toggle'](_0xb99420);roomDetailsEl['className']='shorten-room-details';}else{if(_0x1a601f&&_0x1a601f['className']['includes'](_0xb99420))_0x1a601f['classList']['toggle'](_0xb99420);roomDetailsEl['className']='';}}